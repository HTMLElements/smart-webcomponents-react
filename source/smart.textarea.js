
/* Smart UI v23.1.19 (2025-06-17) 
Copyright (c) 2011-2024 jQWidgets. 
License: https://htmlelements.com/license/ */ //

(()=>{Smart("smart-text-area",class extends Smart.Input{static get properties(){return{users:{value:[],type:"array",reflectToAttribute:!1},resize:{value:"none",type:"string"},richText:{value:!1,type:"boolean"},enableHTMLEncode:{value:!0,type:"boolean"},minWidth:{value:0,type:"number"},minHeight:{value:0,type:"number"},toolbarOnFocus:{value:!1,type:"boolean"},dataSource:{value:[],type:"array",reflectToAttribute:!1},uploadSettings:{value:{url:{value:"",type:"string",reflectToAttribute:!1},removeUrl:{value:"",type:"string",reflectToAttribute:!1},existsUrl:{value:"",type:"string",reflectToAttribute:!1},name:{value:"userfile[]",type:"string",reflectToAttribute:!1},uploadMaxCount:{value:5,type:"number",reflectToAttribute:!1},uploadMaxSize:{value:2097152,type:"number",reflectToAttribute:!1},data:{value:null,type:"object",reflectToAttribute:!1},onUploadStarted:{value:null,type:"any",reflectToAttribute:!1},onUploadCompleted:{value:null,type:"any",reflectToAttribute:!1},onUploadRemove:{value:null,type:"any",reflectToAttribute:!1},onUploadError:{value:null,type:"any",reflectToAttribute:!1},onChange:{value:null,type:"any",reflectToAttribute:!1},onProgress:{value:null,type:"any",reflectToAttribute:!1},onAbort:{value:null,type:"any",reflectToAttribute:!1},onError:{value:null,type:"any",reflectToAttribute:!1},onSetHeaders:{value:null,type:"any",reflectToAttribute:!1}},reflectToAttribute:!1,type:"object"},toolbarItems:{value:["bold","italic","underline","strikethrough","fontsize","fontname","fontcolor","backgroundcolor","alignment","orderedlist","unorderedlist","checklist","hyperlink","image","tableheader","undo","redo","clearformat"],reflectToAttribute:!1,type:"array"},emojis:{value:[{value:"😄",listValue:"😄 smile"},{value:"😆",listValue:"😆 laughing"},{value:"😊",listValue:"😊 blush"},{value:"😃",listValue:"😃 smiley"},{value:"😏",listValue:"😏 smirk"},{value:"😍",listValue:"😍 heart_eyes"},{value:"😘",listValue:"😘 kissing_heart"},{value:"😚",listValue:"😚 kissing_closed_eyes"},{value:"😳",listValue:"😳 flushed"},{value:"😌",listValue:"😌 relieved"},{value:"😆",listValue:"😆 satisfied"},{value:"😁",listValue:"😁 grin"},{value:"😉",listValue:"😉 wink"},{value:"😀",listValue:"😀 grinning"},{value:"😗",listValue:"😗 kissing"},{value:"😙",listValue:"😙 kissing_smiling_eyes"},{value:"😛",listValue:"😛 stuck_out_tongue"},{value:"😴",listValue:"😴 sleeping"},{value:"😟",listValue:"😟 worried"},{value:"😦",listValue:"😦 frowning"},{value:"😧",listValue:"😧 anguished"},{value:"😮",listValue:"😮 open_mouth"},{value:"😬",listValue:"😬 grimacing"},{value:"😕",listValue:"😕 confused"},{value:"😯",listValue:"😯 hushed"},{value:"😑",listValue:"😑 expressionless"},{value:"😒",listValue:"😒 unamused"},{value:"😅",listValue:"😅 sweat_smile"},{value:"😓",listValue:"😓 sweat"},{value:"😥",listValue:"😥 disappointed_relieved"},{value:"😩",listValue:"😩 weary"},{value:"😔",listValue:"😔 pensive"},{value:"😞",listValue:"😞 disappointed"},{value:"😖",listValue:"😖 confounded"},{value:"😨",listValue:"😨 fearful"},{value:"😰",listValue:"😰 cold_sweat"},{value:"😣",listValue:"😣 persevere"},{value:"😢",listValue:"😢 cry"},{value:"😭",listValue:"😭 sob"},{value:"😂",listValue:"😂 joy"},{value:"😲",listValue:"😲 astonished"},{value:"😱",listValue:"😱 scream"},{value:"😫",listValue:"😫 tired_face"},{value:"😠",listValue:"😠 angry"},{value:"😡",listValue:"😡 rage"},{value:"😤",listValue:"😤 triumph"},{value:"😪",listValue:"😪 sleepy"},{value:"😋",listValue:"😋 yum"},{value:"😷",listValue:"😷 mask"},{value:"😎",listValue:"😎 sunglasses"},{value:"😵",listValue:"😵 dizzy_face"},{value:"👿",listValue:"👿 imp"},{value:"😈",listValue:"😈 smiling_imp"},{value:"😐",listValue:"😐 neutral_face"},{value:"😶",listValue:"😶 no_mouth"},{value:"😇",listValue:"😇 innocent"},{value:"👽",listValue:"👽 alien"},{value:"💛",listValue:"💛 yellow_heart"},{value:"💙",listValue:"💙 blue_heart"},{value:"💜",listValue:"💜 purple_heart"},{value:"❤️",listValue:"❤️ heart"},{value:"💚",listValue:"💚 green_heart"},{value:"💔",listValue:"💔 broken_heart"},{value:"💓",listValue:"💓 heartbeat"},{value:"💗",listValue:"💗 heartpulse"},{value:"💕",listValue:"💕 two_hearts"},{value:"💞",listValue:"💞 revolving_hearts"},{value:"💘",listValue:"💘 cupid"},{value:"💖",listValue:"💖 sparkling_heart"},{value:"✨",listValue:"✨ sparkles"},{value:"⭐",listValue:"⭐ star"},{value:"🌟",listValue:"🌟 star2"},{value:"💫",listValue:"💫 dizzy"},{value:"💥",listValue:"💥 boom"},{value:"💥",listValue:"💥 collision"},{value:"💢",listValue:"💢 anger"},{value:"❗",listValue:"❗ exclamation"},{value:"❓",listValue:"❓ question"},{value:"💤",listValue:"💤 zzz"},{value:"💨",listValue:"💨 dash"},{value:"💦",listValue:"💦 sweat_drops"},{value:"🎶",listValue:"🎶 notes"},{value:"🎵",listValue:"🎵 musical_note"},{value:"🔥",listValue:"🔥 fire"},{value:"💩",listValue:"💩 hankey"},{value:"💩",listValue:"💩 poop"},{value:"💩",listValue:"💩 shit"},{value:"👍",listValue:"👍 +1"},{value:"👍",listValue:"👍 thumbsup"},{value:"👎",listValue:"👎 +1"},{value:"👎",listValue:"👎 thumbsdown"},{value:"👌",listValue:"👌 ok_hand"},{value:"👊",listValue:"👊 facepunch"},{value:"✊",listValue:"✊ fist"},{value:"✌️",listValue:"✌️ v"},{value:"👋",listValue:"👋 wave"},{value:"✋",listValue:"✋ raised_hand"},{value:"👐",listValue:"👐 open_hands"},{value:"☝️",listValue:"☝️ point_up"},{value:"👇",listValue:"👇 point_down"},{value:"👈",listValue:"👈 point_left"},{value:"👉",listValue:"👉 point_right"},{value:"🙌",listValue:"🙌 raised_hands"},{value:"🙏",listValue:"🙏 pray"},{value:"👆",listValue:"👆 point_up_2"},{value:"👏",listValue:"👏 clap"},{value:"💪",listValue:"💪 muscle"},{value:"🤘",listValue:"🤘 metal"},{value:"🖕",listValue:"🖕 fu"},{value:"🚶",listValue:"🚶 walking"},{value:"🏃",listValue:"🏃 runner"},{value:"🏃",listValue:"🏃 running"},{value:"👫",listValue:"👫 couple"},{value:"👪",listValue:"👪 family"},{value:"👬",listValue:"👬 two_men_holding_hands"},{value:"👭",listValue:"👭 two_women_holding_hands"},{value:"💃",listValue:"💃 dancer"},{value:"👯",listValue:"👯 dancers"},{value:"🙆‍♀️",listValue:"🙆‍♀️ ok_woman"},{value:"🙅",listValue:"🙅 no_good"},{value:"💁",listValue:"💁 information_desk_person"},{value:"🙋",listValue:"🙋 raising_hand"},{value:"👰‍♀️",listValue:"👰‍♀️ bride_with_veil"},{value:"🙇",listValue:"🙇 bow"},{value:"💏",listValue:"💏 couplekiss"},{value:"💑",listValue:"💑 couple_with_heart"},{value:"💆",listValue:"💆 massage"},{value:"💇",listValue:"💇 haircut"},{value:"💅",listValue:"💅 nail_care"},{value:"👦",listValue:"👦 boy"},{value:"👧",listValue:"👧 girl"},{value:"👩",listValue:"👩 woman"},{value:"👨",listValue:"👨 man"},{value:"👶",listValue:"👶 baby"},{value:"👵",listValue:"👵 older_woman"},{value:"👴",listValue:"👴 older_man"},{value:"👲",listValue:"👲 man_with_gua_pi_mao"},{value:"👳‍♂️",listValue:"👳‍♂️ man_with_turban"},{value:"👷",listValue:"👷 construction_worker"},{value:"👮",listValue:"👮 cop"},{value:"👼",listValue:"👼 angel"},{value:"👸",listValue:"👸 princess"},{value:"😺",listValue:"😺 smiley_cat"},{value:"😸",listValue:"😸 smile_cat"},{value:"😻",listValue:"😻 heart_eyes_cat"},{value:"😽",listValue:"😽 kissing_cat"},{value:"😼",listValue:"😼 smirk_cat"},{value:"🙀",listValue:"🙀 scream_cat"},{value:"😿",listValue:"😿 crying_cat_face"},{value:"😹",listValue:"😹 joy_cat"},{value:"😾",listValue:"😾 pouting_cat"},{value:"👹",listValue:"👹 japanese_ogre"},{value:"👺",listValue:"👺 japanese_goblin"},{value:"🙈",listValue:"🙈 see_no_evil"},{value:"🙉",listValue:"🙉 hear_no_evil"},{value:"🙊",listValue:"🙊 speak_no_evil"},{value:"💂‍♂️",listValue:"💂‍♂️ guardsman"},{value:"💀",listValue:"💀 skull"},{value:"🐾",listValue:"🐾 feet"},{value:"👄",listValue:"👄 lips"},{value:"💋",listValue:"💋 kiss"},{value:"💧",listValue:"💧 droplet"},{value:"👂",listValue:"👂 ear"},{value:"👀",listValue:"👀 eyes"},{value:"👃",listValue:"👃 nose"},{value:"👅",listValue:"👅 tongue"},{value:"🔔",listValue:"🔔 bell"},{value:"🔕",listValue:"🔕 no_bell"},{value:"🎋",listValue:"🎋 tanabata_tree"},{value:"🎉",listValue:"🎉 tada"},{value:"🎊",listValue:"🎊 confetti_ball"},{value:"🔮",listValue:"🔮 crystal_ball"},{value:"♻️",listValue:"♻️ recycle"},{value:"🔚",listValue:"🔚 end"},{value:"🔛",listValue:"🔛 on"},{value:"🔜",listValue:"🔜 soon"}],type:"array",reflectToAttribute:!1}}}template(){return'<div id="inputContainer" role="presentation"><textarea class="smart-input" id=\'input\' readonly=\'[[readonly]]\' placeholder=\'[[placeholder]]\'  name=\'[[name]]\' value=\'{{value::keyup}}\' disabled=\'[[disabled]]\' aria-label="[[placeholder]]"></textarea><div id="editor"></div><span class="smart-hidden smart-hint" inner-h-t-m-l="[[hint]]" id="span"></span><div id="dropDownButton" tabindex=-1 class="smart-drop-down-button" role="button" aria-label="Toggle popup"><div id="arrow" class="arrow" aria-hidden="true"></div></div></div>'}_blurHandler(){const e=this;e.richText?e.removeAttribute("focus"):super._blurHandler()}_focusHandler(){const e=this;e.richText&&(e.$.editor.component.focus(),setTimeout((()=>{const t=e.$.editor.value;e.$.editor.selectionStart=t.length}))),super._focusHandler()}setHTML(e){const t=this;if(t.richText)return t.$.editor.value=e;this.value=e.replaceAll("<","&lt;").replaceAll(">","&gt;")}getHTML(){const e=this;return e.richText?e.$.editor?e.$.editor.component.getHTML():"":e.value}propertyChangedHandler(e,t,o){const a=this;"value"===e&&a.richText&&(a.$.editor.value=o),"richText"===e&&a.render(),"users"===e?(delete a._initMenu,a._mentionMenu&&(a._mentionPlugin&&a._mentionPlugin.destroy(),a._mentionMenu.remove(),a._initUsersMention()),a._renderMentionTrigger()):"resize"===e&&(a.richText?a.$.editor.querySelector(".smart-editor-editable").style.resize=o:a.$.input.style.resize=o,a._mentionTrigger&&("none"!==a.resize?a._mentionTrigger.style.right="10px":a._mentionTrigger.style.right="5px"))}detached(){const e=this;delete e._initMenu,e._mentionMenu&&e._mentionMenu.remove()}findMatches(){const e=this.$.input.value.split("").concat([" "]),t=[];let o="";for(let a in e){let i=e[a],n=e[a-1]||" ",l=[" ","\\n"].indexOf(n)>-1||10===n.charCodeAt(0);("@"===i&&l||o.length)&&" "!==i&&(o+=i),o.length&&" "===i&&(t.push({word:o,index:Math.max(a-o.length,0)}),o="")}return t}getMentions(){const e=this,t=this.findMatches(),o=[];return t.forEach((t=>{e.users.forEach((e=>{const a=t.word.replace("@","");e.name===a&&o.push(e)}))})),o}_initUsersMention(){const e=this;if(e._initMenu)return;if(e.richText)return;e._initMenu=!0;const t=document.createElement("div");t.id=e.id+"_mention_menu",t.classList.add("smart-text-area-mention-menu","smart-hidden"),e._mentionMenu=t,document.body.appendChild(t),e._mentionPlugin=new Smart.Mention(e.richText?e.$.editor.querySelector(".smart-editor-editable"):e.$.input,t,(t=>""===t?e.users:e.users.filter((e=>e.name.startsWith(t)))),((e,t)=>e?`${t}${e.name} `:""),((e,t,o)=>{const a=document.createElement("div");return a.setAttribute("role","option"),a.className="smart-text-area-mention-menu-item",o&&(a.classList.add("selected"),a.setAttribute("aria-selected","")),a.textContent=e.name,a.onpointerdown=e=>{e.preventDefault(),t()},a}))}cleanWordHTML(e){let t=document.createElement("div");t.innerHTML=e;["o:p","w:","v:","xml"].forEach((e=>{let o=t.getElementsByTagName(e);for(;o.length>0;)o[0].remove()})),t.querySelectorAll("b").forEach((e=>e.outerHTML=e.outerHTML.replace("<b","<strong").replace("</b>","</strong>"))),t.querySelectorAll("i").forEach((e=>e.outerHTML=e.outerHTML.replace("<i","<em").replace("</i>","</em>"))),t.querySelectorAll("*[style]").forEach((e=>{const t=["color","background-color","font-weight","font-style"],o=e.getAttribute("style");if(o){let a="";o.split(";").forEach((e=>{let[o,i]=e.split(":");o=o&&o.trim(),i=i&&i.trim(),t.includes(o)&&(a+=`${o}: ${i}; `)})),a.trim()?e.setAttribute("style",a.trim()):e.removeAttribute("style")}})),t.innerHTML=t.innerHTML.replace(/(\r?\n|\r)/g,"<br>"),t.innerHTML=t.innerHTML.replace(/(<p>(\s|&nbsp;)*<\/p>\s*){2,}/g,"<p></p>"),t.innerHTML=t.innerHTML.replace(/([^\S\r\n]|&nbsp;){2,}/g," "),t.innerHTML=t.innerHTML.replace(/>\s+</g,"><"),t.innerHTML=t.innerHTML.replaceAll("·",""),t.innerHTML=t.innerHTML.replaceAll('class="MsoNormal"',""),t.innerHTML=t.innerHTML.replace(/<!--.*?-->/gs,""),["div","span"].forEach((e=>{let o=t.getElementsByTagName(e);Array.from(o).forEach((e=>{let t=e.parentNode;for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}))})),t.querySelectorAll("p, div, span").forEach((e=>{e.textContent.trim()||e.querySelector("img")||e.querySelector("a")||e.remove()}));let o=t.innerHTML;return o.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/\u2013/g,"-").replace(/\u2014/g,"--").replace(/\u2026/g,"...").replace(/\u00A0/g," ").replace(/\uFEFF/g,"").replace(/[\u200B-\u200D]/g,"").replace(/[\u202A-\u202E]/g,""),o}_handlePaste(e,t){const o=this,a=navigator.clipboard,i=a.read?"read":"readText",n=()=>{a[i]&&a[i]().then((a=>{if(Array.isArray(a)&&a.length){const i=a[0];let n=i.types.indexOf("text/html")>-1?"text/html":"text/plain";i.getType(n).then((a=>{a.text().then((a=>{(a.indexOf("<div>")>=0||a.indexOf("<span>")>=0||a.indexOf("<p>")>=0)&&(n="text/html"),o._handleTextPaste(a,e,n,t)}))}))}else if("string"==typeof a){let i="text/plain";(a.indexOf("<div>")>=0||a.indexOf("<span>")>=0||a.indexOf("<p>")>=0)&&(i="text/html"),o._handleTextPaste(a,e,i,t)}}))};if(navigator.permissions&&navigator.permissions.query&&!o._isFireFox)try{navigator.permissions.query({name:"clipboard-read"}).then((e=>{("granted"===e.state||"prompt"===e.state&&a[i])&&n()}))}catch(e){o.error(o.localize("permissionsRequired",{elementType:o.nodeName.toLowerCase(),actionName:"paste"}))}else if(a[i])return void n();e.getRootNode().execCommand("paste")}_handleTextPaste(e,t,o,a){const i=this;e=e.replace(/<!--StartFragment-->|<!--EndFragment-->/gi,"");let n;if(!o){const t=document.createElement("div");t.innerHTML=e,e=t.innerText}const l=e.toLocaleLowerCase();if(n=document.createElement("span"),e=i.cleanWordHTML(e),n.innerHTML=e,l.indexOf("<video")>-1||l.indexOf("<iframe")>-1||l.indexOf("smart-editor-image-caption")>-1){const e=n.querySelectorAll("video, iframe"),t=n.querySelector(".smart-editor-image-caption"),o=e.length>0;let a=document.createDocumentFragment();for(let t=0,o=e.length;t<o;t+=1)a.appendChild(e[t]);if(t&&(t.removeAttribute("style"),a.appendChild(t)),o||t){const e=document.createElement("span");n.classList.add("smart-editor-image-container"),o&&n.classList.add("smart-editor-video-container"),n.setAttribute("contenteditable",!1),a.childElementCount&&(n.innerHTML="",n.appendChild(a)),e.appendChild(n),n=e}}const r=a._getSelectionRange(),[s,d]=[window,document];if(r instanceof s.Range){if(r.deleteContents(),n.childNodes.length)for(;n.lastChild;)r.insertNode(n.lastChild);else r.insertNode(n);r.collapse()}else d.execCommand("paste")}_initRichText(e,t,o){const a=this,i=a,n={};if(!e)return;o||(o={undo:"Undo",redo:"Redo",bold:"Bold",italic:"Italic",underline:"Underline",striketrhough:"Strikethrough",fontname:"Font Name",fontsize:"Font Size",alignment:"Alignment",unorderedlist:"Bulleted list",orderedlist:"Numbered list",checklist:"Checklist",paragraph:"Paragraph",format:"Format",image:"Image",h1:"Large Heading",h2:"Medium Heading",h3:"Small Heading",link:"Create link",code:"Code",openLink:"Ctrl + Click to go to link: ",clearformat:"Clear format",backgroundcolor:"Background Color",fontcolor:"Font Color",okButton:"Ok",cancelButton:"Cancel"});const l=`\n            <div class="smart-container">\n                <div class="smart-editor-toolbar"> \n                    <div style="height: auto;" class="smart-editor-toolbar-items-primary">\n                         <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.bold}" command="bold" item-name="bold"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.italic}" command="italic" item-name="italic"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.underline}" command="underline" item-name="underline"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.striketrhough}" command="strikethrough" item-name="strikethrough"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center smart-arrow-down" item-value="Roboto" item-type="drop-down" item-name="fontname" tooltip="${o.fontname}"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center smart-arrow-down" item-value="14" item-type="drop-down" item-name="fontsize" tooltip="${o.fontsize}"></div>\n                        <div style="--item-value: var(--smart-primary);" class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="color-input" tooltip="${o.fontcolor}" command="fontcolor" item-name="fontcolor"><span item-name="fontcolor" class="smart-editor-item-action-button"></span></div>\n                        <div style="--item-value: var(--smart-secondary);" class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="color-input" tooltip="${o.backgroundcolor}" command="backgroundcolor" item-name="backgroundcolor"><span item-name="backgroundcolor" class="smart-editor-item-action-button"></span></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center smart-arrow-down" item-type="button" item-value="left" item-name="alignment" command="justify" tooltip="${o.alignment}"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.unorderedlist}" command="insertUnorderedList" item-name="unorderedlist"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.orderedlist}" command="insertOrderedList" item-name="orderedlist"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.checklist}" command="insertUnorderedList" item-name="checklist"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.link}" command="hyperlink" item-name="hyperlink"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.image}" command="image" item-name="image"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center smart-arrow-down" item-type="button" item-name="tableheader" tooltip="${o.format}"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.undo}" command="undo" item-name="undo"></div>\n                         <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.redo}" command="redo" item-name="redo"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.clearformat}" command="removeformat" item-name="clearformat"></div>\n                        </div>\n                </div>\n            <div class="smart-editor-content-container">\n                <div class="smart-editor-editable" contenteditable="true"></div>\n            </div>\n        </div>\n        `,r=e;r.className="smart-editor smart-rich-textarea",r.style.borderLeftWidth=r.style.borderTopWidth=r.style.borderRightWidth=r.style.borderBottomWidth="0px",r.innerHTML=l;const s=r.querySelector(".smart-editor-editable");s.style.resize=a.resize,r.addEventListener("drop",(t=>{if(t.dataTransfer.items){let o=0;const i=5,n=["image/apng","image/bmp","image/gif","image/jpeg","image/jpg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon","video/x-msvideo","text/csv","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-fontobject","image/gif","application/json","text/plain","application/xml","application/zip","application/gzip","application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/x-7z-compressed","application/vnd.rar","application/rtf","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/x-zip-compressed","audio/mpeg","video/mp4","video/mpeg","video/x-msvideo","video/quicktime"];for(let l=0;l<t.dataTransfer.items.length;l++)if("file"===t.dataTransfer.items[l].kind){const r=t.dataTransfer.items[l].getAsFile();if(n.indexOf(r.type)>=0&&(o++,o<=i&&null!==r)){let o=new FileReader;return o.onload=function(t){if(s.getRootNode().execCommand("insertHTML",!1,`<img id="targetImage" src="${t.target.result}"/>`),a.uploadSettings.uploadUrl){const t=s.getRootNode().querySelector("#targetImage");t&&(t.id=""),m(t,r,(o=>{t&&o&&o.length&&(t.src=o[0].medium||o[0].value,t.classList.remove("smart-hidden"),e.imgArray||(e.imgArray=[]),e.imgArrayId||(e.imgArrayId=[]),e.imgArray.push(t.src),e.imgArrayId[t.src]=o[0])}))}},o.readAsDataURL(r),void t.preventDefault()}}}})),r.addEventListener("paste",(t=>{const o=t.clipboardData;if(o&&o.types.length){t.preventDefault();let o=(t.clipboardData||t.originalEvent.clipboardData).items,i=null;for(let e=0;e<o.length;e++)0===o[e].type.indexOf("image")&&(i=o[e].getAsFile());if(null!==i){let t=new FileReader;return t.onload=function(t){if(s.getRootNode().execCommand("insertHTML",!1,`<img id="targetImage" src="${t.target.result}"/>`),a.uploadSettings.uploadUrl){const t=s.getRootNode().querySelector("#targetImage");t&&(t.id=""),m(t,i,(o=>{t&&o&&o.length&&(t.src=o[0].medium||o[0].value,t.classList.remove("smart-hidden"),e.imgArray||(e.imgArray=[]),e.imgArrayId||(e.imgArrayId=[]),e.imgArray.push(t.src),e.imgArrayId[t.src]=o[0])}))}},void t.readAsDataURL(i)}}this._handlePaste(s,n),t.preventDefault()})),a.style.minHeight=a.minHeight+"px",s.style.minHeight=a.minHeight+"px",s.style.minWidth=a.minWidth+"px",e.style.minHeight=a.minHeight+"px",e.style.minWidth=a.minWidth+"px";const d=r.querySelectorAll(".smart-editor-toolbar-item");for(let e=0;e<d.length;e++){const t=d[e],o=t.getAttribute("item-name");-1===a.toolbarItems.indexOf(o)&&t.classList.add("smart-hidden")}if(n.textarea=t,n.tools=[],n.toolbar=r.querySelector(".smart-editor-toolbar"),a.toolbarOnFocus){n.toolbar.id=a.id+"_toolbar";const e=document.createElement("div");e.classList.add("smart-editor"),e.classList.add("smart-editor-toolbar-float"),e.setAttribute("focus",""),e.appendChild(n.toolbar),r.querySelector(".smart-container").setAttribute("toolbar-on-focus",""),a.appendChild(e)}n.contentContainer=r.querySelector(".smart-editor-content-container");const u=document.createElement("div");u.className="smart-editor-tooltip",u.setAttribute("tooltip-position","bottom"),document.body.appendChild(u),n.tooltip=document.querySelector(".smart-editor-tooltip");new ResizeObserver((()=>{if("none"!==a.resize){if(a.style.width=parseInt(s.offsetWidth)+2+"px",a.toolbarOnFocus)return void(a.style.height=parseInt(s.offsetHeight)+2+"px");a.style.height=parseInt(s.offsetHeight)+n.toolbar.offsetHeight+2+"px"}})).observe(s);const c=[],m=(e,t,o)=>{const a=this;if(!e)return;const i=new FormData,n=a.uploadSettings.url;let l=!1;const r=t,s=t.type,d=a.uploadSettings.data;d&&""!==d&&("string"==typeof d?i.append("postData",d):i.append("postData",JSON.stringify(d))),i.append("fileType",s),i.append(a.uploadSettings.name,t),l=!0;let u=new XMLHttpRequest;u.open("POST",n),a.uploadSettings.onSetHeaders&&"function"==typeof a.uploadSettings.onSetHeaders&&a.uploadSettings.onSetHeaders(u,r),a.uploadSettings.onUploadStarted&&a.uploadSettings.onUploadStarted({files:[t],status:u.status}),u.upload.onprogress=function(e){a.uploadSettings.onProgress&&a.uploadSettings.onProgress(e)},u.onabort=function(e){a.uploadSettings.onAbort&&a.uploadSettings.onAbort(e)},u.onerror=function(e){a.uploadSettings.onError&&a.uploadSettings.onError(e)},u.onload=function(){let e=!1;if(u.response&&("string"==typeof u.response?(e=u.response,e.indexOf("[{")>=0&&(e=JSON.parse(u.response))):e=JSON.parse(u.response)),u.status>=200&&u.status<=299){const i=(e,t)=>{if(e.response&&e.response.response&&"success"!==e.response.response)return null;let o=!1;u.fileURL&&(o=u.file_url);let a={};e&&e.file_url?o=e.file_url:e&&e[0]&&e[0].file_url&&(o=e[0].file_url);let i=!1;e&&e.file_url_small?i=e.file_url_small:e&&e[0]&&e[0].file_url_small&&(i=e[0].file_url_small);let n=!1;e&&e.file_url_medium?n=e.file_url_medium:e&&e[0]&&e[0].file_url_medium&&(n=e[0].file_url_medium);let l=!1;return e&&e.file_url_large?l=e.file_url_large:e&&e[0]&&e[0].file_url_large&&(l=e[0].file_url_large),o&&(a.value=o),i&&(a.small=i),n&&(a.medium=n),l&&(a.large=l),a.label=t,a},n=[t];for(let t=0;t<n.length;t++){const o=n[t].name?[]:n[t].split("/"),l="url"===s?o[o.length-1]:n[t].name;a.uploadSettings.url;const r=i((e.files||e[0]&&e[0].files||[e[0]])[t],l);r&&c.push(r)}o(c,e)}else o(c,e)},u.onreadystatechange=function(){},u.send(i)};d.forEach((t=>{const l=t.getAttribute("item-name");n.tools[l]={element:t,type:"button"},t.onmouseenter=e=>{setTimeout((()=>{const t=e.target.getAttribute("tooltip"),o=e.target.getBoundingClientRect(),i=(n.toolbar.getBoundingClientRect(),e=>e?e.offsetTop+i(e.offsetParent):0),l=e=>e?e.offsetLeft+l(e.offsetParent):0,r=(s=e.target,{left:l(s),top:i(s)});var s;n.tooltip.style.top=5+r.top+o.height+"px",n.tooltip.setAttribute("hover-tooltip",t),n.tooltip.classList.add("open"),n.tooltip.style.left=r.left+o.width/2-n.tooltip.offsetWidth/2+"px",a._tooltipTimer&&clearTimeout(a._tooltipTimer),a._tooltipTimer=setTimeout((()=>{n.tooltip.classList.remove("open")}),1e3)}),150)},t.onmouseleave=()=>{n.tooltip.classList.remove("open")},t.onpointerup=e=>(e.preventDefault(),e.stopPropagation(),!1),t.onpointerdown=t=>{const l=t.target.getAttribute("item-name"),s=(t.target.getAttribute("item-value"),t.target.getAttribute("command")),d=t.target.getAttribute("command-value"),u=r.querySelector(".smart-editor-editable"),c=e=>{if(!e||"tableheader"===e){const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="tableheader"]'):r.querySelector('[item-name="tableheader"]');e._popup&&(e._popup.remove(),delete e._popup)}if(!e||"alignment"===e){const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="alignment"]'):r.querySelector('[item-name="alignment"]');e._popup&&(e._popup.remove(),delete e._popup)}if(!e||"fontsize"===e){const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="fontsize"]'):r.querySelector('[item-name="alignment"]');e._popup&&(e._popup.remove(),delete e._popup)}if(!e||"fontname"===e){const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="fontname"]'):r.querySelector('[item-name="alignment"]');e._popup&&(e._popup.remove(),delete e._popup)}if(!e||"fontcolor"===e){const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="fontcolor"]'):r.querySelector('[item-name="fontcolor"]');e._popup&&(e._popup.remove(),delete e._popup)}if(!e||"backgroundcolor"===e){const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="backgroundcolor"]'):r.querySelector('[item-name="backgroundcolor"]');e._popup&&(e._popup.remove(),delete e._popup)}};if("tableheader"!==l)if("fontcolor"!==l&&"backgroundcolor"!==l)if("alignment"!==l)if("fontsize"!==l)if("fontname"!==l){switch(c(),t.target.hasAttribute("checked")?t.target.removeAttribute("checked"):t.target.setAttribute("checked",""),l){case"bold":case"italic":case"underline":case"strikethrough":case"unorderedlist":case"checklist":case"orderedlist":case"undo":case"redo":u.getRootNode().execCommand(s,!1,null);break;case"removeformat":case"clearformat":u.getRootNode().execCommand("removeformat",!1,null);break;case"image":{const t=document.createElement("input");t.type="file",t.accept="image/jpeg, image/png, image/gif",t.hidden=!0,document.body.appendChild(t);n._getSelectionRange();u.getRootNode().execCommand("insertHTML",!1,'<img style="max-width: 100%;" class="smart-hidden" id="targetImage"/>'),t.click(),t.onchange=()=>{const o=u.getRootNode().getElementById("targetImage"),i=t.files[0];o.id="",o.classList.add("smart-hidden");const n=new FileReader;n.addEventListener("load",(function(){o.src=n.result,o.classList.remove("smart-hidden")})),i&&n.readAsDataURL(i),a.uploadSettings.uploadUrl&&m(o,i,(t=>{t&&t.length&&(o.src=t[0].medium||t[0].value,o.classList.remove("smart-hidden"),e.imgArray||(e.imgArray=[]),e.imgArrayId||(e.imgArrayId=[]),e.imgArray.push(o.src),e.imgArrayId[o.src]=t[0])}))};break}case"hyperlink":{if(i._activeAnchorMenu)return t.preventDefault(),void t.stopPropagation();const e=n._getSelectionRange();let l,r=e.startContainer;r&&"a"!==r.nodeName.toLowerCase()&&(r=r.parentElement);let s=!1;if(r&&"a"===r.nodeName.toLowerCase()?(l=r.textContent,s=!0):l=e.toString(),s){if(void 0!==l){const e=h(a.id+"_anchor",l,r);i._activeAnchorMenu=e;const t=f(document),s=t.getRange();e.onselectitem=(e,a,i)=>{if(u.focus(),t.selectRange(s),e=(e=e.replace("https://","")).replace("http://",""),i)return r.remove(),void u.getRootNode().execCommand("insertHTML",!1,a);r.innerHTML=a,r.href="https://"+e.trim()+'"',r.title=o.openLink+"https://"+e.trim(),setTimeout((()=>{let e=n._getSelectionRange().startContainer;e&&"a"!==e.nodeName.toLowerCase()&&(e=e.parentElement),e&&"a"===e.nodeName.toLowerCase()&&(e.onmouseenter=t=>{t.ctrlKey&&e.classList.add("ctrl")},e.onmousemove=t=>{t.ctrlKey&&e.classList.add("ctrl")},e.onmouseleave=()=>{e.classList.remove("ctrl")})}),50)}}}else if(void 0!==l){const e=h(a.id+"_anchor",l);i._activeAnchorMenu=e;const t=f(document),r=t.getRange();e.onselectitem=(e,a)=>{u.focus(),t.selectRange(r),e=(e=e.replace("https://","")).replace("http://",""),u.getRootNode().execCommand("insertHTML",!1,'<a title="'+o.openLink+"https://"+e.trim()+'" href="https://'+e.trim()+'">'+a+"</a>"),setTimeout((()=>{let e=n._getSelectionRange().startContainer;e&&"a"!==e.nodeName.toLowerCase()&&(e=e.parentElement),e&&"a"===e.nodeName.toLowerCase()&&(e.onmouseenter=t=>{t.ctrlKey&&e.classList.add("ctrl")},e.onmousemove=t=>{t.ctrlKey&&e.classList.add("ctrl")},e.onmouseleave=()=>{e.classList.remove("ctrl")})}),50)}}break}case"h1":case"h2":case"h3":case"p":case"pre":case"justify":case"formats":u.getRootNode().execCommand(s,!1,d)}if("checklist"===l){const e=window.getSelection();if(e.focusNode){const t=e.focusNode.parentElement.closest("ul");t&&t.setAttribute("checklist","")}}t.preventDefault(),t.stopPropagation()}else{t.preventDefault(),t.stopPropagation(),c("fontcolor"),c("backgroundcolor"),c("tableheader"),c("alignment"),c("fontsize");const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="fontname"]'):r.querySelector('[item-name="fontname"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="auto",t.style.paddingLeft=t.style.paddingLeft=t.style.paddingRight=t.style.paddingBottom=t.style.paddingTop="5px",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const o=e.getBoundingClientRect();t.style.top=o.bottom+"px",t.style.left=o.left+"px",t.innerHTML='\n                     <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'Roboto\'" command="fontname" command-value="roboto" item-name="fontname" item-value="roboto">Roboto</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'Segoe UI\'" command="fontname" command-value="segoeUi" item-name="fontname" item-value="segoeUi">Segoe UI</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'Arial\'" command="fontname" command-value="arial" item-name="fontname" item-value="arial">Arial</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'georgia\'" command="fontname" command-value="georgia" item-name="fontname" item-value="georgia">Georgia</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'impact\'" command="fontname" command-value="impact" item-name="fontname" item-value="impact">Impact</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'tahoma\'" command="fontname" command-value="tahoma" item-name="fontname" item-value="tahoma">Tahoma</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'timesNewRoman\'" command="fontname" command-value="timesNewRoman" item-name="timesNewRoman" item-value="timesNewRoman">Times New Roman</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-family: \'verdana\'" command="fontname" command-value="verdana" item-name="fontname" item-value="verdana">Verdana</div>\n                    ',t.querySelectorAll(".smart-button").forEach((t=>{t.onpointerup=t=>(t.preventDefault(),t.stopPropagation(),e._popup.remove(),delete e._popup,!1),t.onpointerdown=e=>{e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("command"),o=e.target.getAttribute("command-value");r.querySelector(".smart-editor-editable").getRootNode().execCommand(t,!1,o)}}))}}else{t.preventDefault(),t.stopPropagation(),c("fontcolor"),c("backgroundcolor"),c("tableheader"),c("alignment"),c("fontname");const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="fontsize"]'):r.querySelector('[item-name="fontsize"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="50px",t.style.paddingLeft=t.style.paddingLeft=t.style.paddingRight=t.style.paddingBottom=t.style.paddingTop="5px",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const o=e.getBoundingClientRect();t.style.top=o.bottom+"px",t.style.left=o.left+"px",t.innerHTML='\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 8;" command="fontSize" command-value="8" item-name="8" item-value="8">8</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 10;" command="fontSize" command-value="10" item-name="10" item-value="10">10</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 12;" command="fontSize" command-value="12" item-name="12" item-value="12">12</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 14;" command="fontSize" command-value="14" item-name="14" item-value="14">14</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 16;" command="fontSize" command-value="16" item-name="16" item-value="16">16</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 18;" command="fontSize" command-value="18" item-name="18" item-value="18">18</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 24;" command="fontSize" command-value="24" item-name="24" item-value="24">24</div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" style="padding-left: 5px; padding-right: 5px; justify-content: flex-start; font-size: 36;" command="fontSize" command-value="36" item-name="36" item-value="36">36</div>\n                       ',t.querySelectorAll(".smart-button").forEach((t=>{t.onpointerup=t=>(t.preventDefault(),t.stopPropagation(),e._popup.remove(),delete e._popup,!1),t.onpointerdown=e=>{e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("command"),o=e.target.getAttribute("command-value");r.querySelector(".smart-editor-editable").getRootNode().execCommand(t,!1,3),function(){const e=n._getSelectionRange();if(e.commonAncestorContainer.closest){const t=e.commonAncestorContainer.querySelectorAll("font[size]");for(let e=0,a=t.length;e<a;e+=1){const a=t[e];a.removeAttribute("size"),a.style.fontSize=o+"px"}}else{const e=window.getSelection().focusNode;if(!e)return;const t=e.closest?e.closest(".smart-editor-editable font"):e.parentElement;"font"===t.nodeName.toLowerCase()&&(t.removeAttribute("size"),t.style.fontSize=o+"px")}}()}}))}}else{t.preventDefault(),t.stopPropagation(),c("fontcolor"),c("backgroundcolor"),c("tableheader"),c("fontsize"),c("fontname");const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="alignment"]'):r.querySelector('[item-name="alignment"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="30px",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const a=e.getBoundingClientRect();t.style.top=a.bottom+"px",t.style.left=a.left+"px",t.innerHTML=`\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignLeft}" command="justify" command-value="Left" item-name="alignment" item-value="left"></div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignCenter}" command="justify" command-value="Center" item-name="alignment" item-value="center"></div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignRight}" command="justify" command-value="Right" item-name="alignment" item-value="right"></div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignJustify}" command="justify" command-value="Full" item-name="alignment" item-value="justify"></div>\n                    `,t.querySelectorAll(".smart-button").forEach((t=>{t.onpointerup=t=>(t.preventDefault(),t.stopPropagation(),e._popup.remove(),delete e._popup,!1),t.onpointerdown=e=>{e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("command"),o=e.target.getAttribute("command-value");r.querySelector(".smart-editor-editable").getRootNode().execCommand(t+o,!1,null)}}))}}else{t.preventDefault(),t.stopPropagation(),c();const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="'+l+'"]'):r.querySelector('[item-name="'+l+'"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="auto",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const o=e.getBoundingClientRect();t.style.top=o.bottom+"px",t.style.left=o.left+"px",t.innerHTML="<style>\n                        \n.smart-editor-color-picker table {\n    margin: 0;\n    padding: 4px 4px 4px;\n    empty-cells: show;\n    border-collapse: separate;\n}\n\n.smart-editor-color-picker td {\n    border-collapse: separate;\n    border: 1px solid transparent;\n    cursor: pointer;\n    margin: 0;\n    position: relative;\n}\n\n.smart-editor-color-picker td:hover {\n    border: 1px solid #000;\n}\n\n.smart-editor-color-picker-selected-cell {\n    outline: 1px solid #000;\n}\n\n.smart-editor-color-picker td div {\n    width: 16px;\n    height: 16px;\n}\n                        </style>",t.innerHTML+='<div tool-name="'+l+'" class="smart-editor-color-picker"><div role="grid"><table class="smart-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (0, 0, 0)"><div title="RGB (0, 0, 0)" style="background-color: rgb(0, 0, 0);"></div></td><td aria-label="RGB (68, 68, 68)"><div title="RGB (68, 68, 68)" style="background-color: rgb(68, 68, 68);"></div></td><td aria-label="RGB (102, 102, 102)"><div title="RGB (102, 102, 102)" style="background-color: rgb(102, 102, 102);"></div></td><td aria-label="RGB (153, 153, 153)"><div title="RGB (153, 153, 153)" style="background-color: rgb(153, 153, 153);"></div></td><td aria-label="RGB (204, 204, 204)"><div title="RGB (204, 204, 204)" style="background-color: rgb(204, 204, 204);"></div></td><td aria-label="RGB (238, 238, 238)"><div title="RGB (238, 238, 238)" style="background-color: rgb(238, 238, 238);"></div></td><td aria-label="RGB (243, 243, 243)"><div title="RGB (243, 243, 243)" style="background-color: rgb(243, 243, 243);"></div></td><td aria-label="RGB (255, 255, 255)"><div title="RGB (255, 255, 255)" style="background-color: rgb(255, 255, 255);"></div></td></tr></tbody></table></div><div role="grid"><table class="smart-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (255, 0, 0)"><div title="RGB (255, 0, 0)" style="background-color: rgb(255, 0, 0);"></div></td><td aria-label="RGB (255, 153, 0)"><div title="RGB (255, 153, 0)" style="background-color: rgb(255, 153, 0);"></div></td><td aria-label="RGB (255, 255, 0)"><div title="RGB (255, 255, 0)" style="background-color: rgb(255, 255, 0);"></div></td><td aria-label="RGB (0, 255, 0)"><div title="RGB (0, 255, 0)" style="background-color: rgb(0, 255, 0);"></div></td><td aria-label="RGB (0, 255, 255)"><div title="RGB (0, 255, 255)" style="background-color: rgb(0, 255, 255);"></div></td><td aria-label="RGB (0, 0, 255)"><div title="RGB (0, 0, 255)" style="background-color: rgb(0, 0, 255);"></div></td><td aria-label="RGB (153, 0, 255)"><div title="RGB (153, 0, 255)" style="background-color: rgb(153, 0, 255);"></div></td><td aria-label="RGB (255, 0, 255)"><div title="RGB (255, 0, 255)" style="background-color: rgb(255, 0, 255);"></div></td></tr></tbody></table></div><div role="grid"><table class="smart-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (244, 204, 204)"><div title="RGB (244, 204, 204)" style="background-color: rgb(244, 204, 204);"></div></td><td aria-label="RGB (252, 229, 205)"><div title="RGB (252, 229, 205)" style="background-color: rgb(252, 229, 205);"></div></td><td aria-label="RGB (255, 242, 204)"><div title="RGB (255, 242, 204)" style="background-color: rgb(255, 242, 204);"></div></td><td aria-label="RGB (217, 234, 211)"><div title="RGB (217, 234, 211)" style="background-color: rgb(217, 234, 211);"></div></td><td aria-label="RGB (208, 224, 227)"><div title="RGB (208, 224, 227)" style="background-color: rgb(208, 224, 227);"></div></td><td aria-label="RGB (207, 226, 243)"><div title="RGB (207, 226, 243)" style="background-color: rgb(207, 226, 243);"></div></td><td aria-label="RGB (217, 210, 233)"><div title="RGB (217, 210, 233)" style="background-color: rgb(217, 210, 233);"></div></td><td aria-label="RGB (234, 209, 220)"><div title="RGB (234, 209, 220)" style="background-color: rgb(234, 209, 220);"></div></td></tr><tr><td id="T-Kw-Jn88" aria-label="RGB (234, 153, 153)"><div title="RGB (234, 153, 153)" style="background-color: rgb(234, 153, 153);"></div></td><td aria-label="RGB (249, 203, 156)"><div title="RGB (249, 203, 156)" style="background-color: rgb(249, 203, 156);"></div></td><td aria-label="RGB (255, 229, 153)"><div title="RGB (255, 229, 153)" style="background-color: rgb(255, 229, 153);"></div></td><td aria-label="RGB (182, 215, 168)"><div title="RGB (182, 215, 168)" style="background-color: rgb(182, 215, 168);"></div></td><td aria-label="RGB (162, 196, 201)"><div title="RGB (162, 196, 201)" style="background-color: rgb(162, 196, 201);"></div></td><td aria-label="RGB (159, 197, 232)"><div title="RGB (159, 197, 232)" style="background-color: rgb(159, 197, 232);"></div></td><td aria-label="RGB (180, 167, 214)"><div title="RGB (180, 167, 214)" style="background-color: rgb(180, 167, 214);"></div></td><td aria-label="RGB (213, 166, 189)"><div title="RGB (213, 166, 189)" style="background-color: rgb(213, 166, 189);"></div></td></tr><tr><td aria-label="RGB (224, 102, 102)"><div title="RGB (224, 102, 102)" style="background-color: rgb(224, 102, 102);"></div></td><td aria-label="RGB (246, 178, 107)"><div title="RGB (246, 178, 107)" style="background-color: rgb(246, 178, 107);"></div></td><td aria-label="RGB (255, 217, 102)"><div title="RGB (255, 217, 102)" style="background-color: rgb(255, 217, 102);"></div></td><td aria-label="RGB (147, 196, 125)"><div title="RGB (147, 196, 125)" style="background-color: rgb(147, 196, 125);"></div></td><td aria-label="RGB (118, 165, 175)"><div title="RGB (118, 165, 175)" style="background-color: rgb(118, 165, 175);"></div></td><td aria-label="RGB (111, 168, 220)"><div title="RGB (111, 168, 220)" style="background-color: rgb(111, 168, 220);"></div></td><td aria-label="RGB (142, 124, 195)"><div title="RGB (142, 124, 195)" style="background-color: rgb(142, 124, 195);"></div></td><td aria-label="RGB (194, 123, 160)"><div title="RGB (194, 123, 160)" style="background-color: rgb(194, 123, 160);"></div></td></tr><tr><td id="T-Kw-Jn104" aria-label="RGB (204, 0, 0)"><div title="RGB (204, 0, 0)" style="background-color: rgb(204, 0, 0);"></div></td><td aria-label="RGB (230, 145, 56)"><div title="RGB (230, 145, 56)" style="background-color: rgb(230, 145, 56);"></div></td><td aria-label="RGB (241, 194, 50)"><div title="RGB (241, 194, 50)" style="background-color: rgb(241, 194, 50);"></div></td><td aria-label="RGB (106, 168, 79)"><div title="RGB (106, 168, 79)" style="background-color: rgb(106, 168, 79);"></div></td><td aria-label="RGB (69, 129, 142)"><div title="RGB (69, 129, 142)" style="background-color: rgb(69, 129, 142);"></div></td><td aria-label="RGB (61, 133, 198)"><div title="RGB (61, 133, 198)" style="background-color: rgb(61, 133, 198);"></div></td><td aria-label="RGB (103, 78, 167)"><div title="RGB (103, 78, 167)" style="background-color: rgb(103, 78, 167);"></div></td><td aria-label="RGB (166, 77, 121)"><div title="RGB (166, 77, 121)" style="background-color: rgb(166, 77, 121);"></div></td></tr><tr><td aria-label="RGB (153, 0, 0)"><div title="RGB (153, 0, 0)" style="background-color: rgb(153, 0, 0);"></div></td><td aria-label="RGB (180, 95, 6)"><div title="RGB (180, 95, 6)" style="background-color: rgb(180, 95, 6);"></div></td><td aria-label="RGB (191, 144, 0)"><div title="RGB (191, 144, 0)" style="background-color: rgb(191, 144, 0);"></div></td><td aria-label="RGB (56, 118, 29)"><div title="RGB (56, 118, 29)" style="background-color: rgb(56, 118, 29);"></div></td><td aria-label="RGB (19, 79, 92)"><div title="RGB (19, 79, 92)" style="background-color: rgb(19, 79, 92);"></div></td><td aria-label="RGB (11, 83, 148)"><div title="RGB (11, 83, 148)" style="background-color: rgb(11, 83, 148);"></div></td><td aria-label="RGB (53, 28, 117)"><div title="RGB (53, 28, 117)" style="background-color: rgb(53, 28, 117);"></div></td><td aria-label="RGB (116, 27, 71)"><div title="RGB (116, 27, 71)" style="background-color: rgb(116, 27, 71);"></div></td></tr><tr><td aria-label="RGB (102, 0, 0)"><div title="RGB (102, 0, 0)" style="background-color: rgb(102, 0, 0);"></div></td><td aria-label="RGB (120, 63, 4)"><div title="RGB (120, 63, 4)" style="background-color: rgb(120, 63, 4);"></div></td><td aria-label="RGB (127, 96, 0)"><div title="RGB (127, 96, 0)" style="background-color: rgb(127, 96, 0);"></div></td><td aria-label="RGB (39, 78, 19)"><div title="RGB (39, 78, 19)" style="background-color: rgb(39, 78, 19);"></div></td><td aria-label="RGB (12, 52, 61)"><div title="RGB (12, 52, 61)" style="background-color: rgb(12, 52, 61);"></div></td><td aria-label="RGB (7, 55, 99)"><div title="RGB (7, 55, 99)" style="background-color: rgb(7, 55, 99);"></div></td><td aria-label="RGB (32, 18, 77)"><div title="RGB (32, 18, 77)" style="background-color: rgb(32, 18, 77);"></div></td><td aria-label="RGB (76, 17, 48)"><div title="RGB (76, 17, 48)" style="background-color: rgb(76, 17, 48);"></div></td></tr></tbody></table></div></div>',t.querySelectorAll("td div").forEach((t=>{t.onpointerup=t=>(t.preventDefault(),t.stopPropagation(),e._popup.remove(),delete e._popup,!1),t.onpointerdown=e=>{const t=e.target.closest(".smart-editor-color-picker").getAttribute("tool-name"),o=(e=>{if(e){if("#"===e.substr(0,1))return 4===e.length?"#"+(o=e.substr(1,1))+o+(a=e.substr(2,1))+a+(i=e.substr(3,1))+i:e;var t=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(e);if(!t)return null;var o=parseInt(t[2],10).toString(16),a=parseInt(t[3],10).toString(16),i=parseInt(t[4],10).toString(16);return"#"+((1===o.length?"0"+o:o)+(1===a.length?"0"+a:a)+(1===i.length?"0"+i:i))}return null})(e.target.style.backgroundColor),a=r.querySelector(".smart-editor-editable");"fontcolor"===t?a.getRootNode().execCommand("forecolor",!1,o):a.getRootNode().execCommand("backcolor",!1,o),e.preventDefault(),e.stopPropagation()}}))}}else{t.stopPropagation(),t.preventDefault(),c("alignment"),c("fontcolor"),c("backgroundcolor"),c("fontsize"),c("fontname");const e=a.toolbarOnFocus?document.querySelector("#"+a.id+'_toolbar [item-name="tableheader"]'):r.querySelector('[item-name="tableheader"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="70px",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const a=e.getBoundingClientRect();t.style.top=a.bottom+"px",t.style.left=a.left-20+"px",t.innerHTML=`\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.paragraph}" command="insertParagraph" command-value="p" item-name="p">P</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.h1}" command="formatBlock" command-value="H1" item-name="h1">H1</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.h2}" command="formatBlock" command-value="H2" item-name="h2">H2</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.h3}" command="formatBlock" command-value="H3" item-name="h3">H3</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.code}" command="formatBlock" command-value="pre" item-name="pre">Code</div>       \n                    `,t.querySelectorAll(".smart-button").forEach((t=>{t.onpointerup=t=>(t.preventDefault(),t.stopPropagation(),e._popup.remove(),delete e._popup,!1),t.onpointerdown=e=>{e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("command"),o=e.target.getAttribute("command-value");r.querySelector(".smart-editor-editable").getRootNode().execCommand(t,!1,o)}}))}}}}));const p=r.querySelector(".smart-editor-editable");n.content=p,n.content.innerHTML="<div>"+t.value+"&#8203;</div>";const g=(e,o)=>{const a=n;return void 0===e&&(e=t.value),e=!o&&a.enableHtmlEncode?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e.replaceAll("&lt;","<").replaceAll("&gt;",">")};e.component=n;const v=(e,t)=>{var o=t(e);for(e=e.firstChild;!1!==o&&e;e=e.nextSibling)o=v(e,t);return o};n.getCaretPosition=e=>{var t=window.getSelection(),o=[0,0];if(t.anchorNode===e)o=[t.anchorOffset,t.extentOffset];else{var a=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var i,n=[0,0];v(e,(function(e){for(i=0;i<2;i++)if(e==a[i]&&(n[i]=!0,n[0==i?1:0]))return!1;if(e.textContent&&!e.firstChild)for(i=0;i<2;i++)n[i]||(o[i]+=e.textContent.length)})),o[0]+=t.anchorOffset,o[1]+=t.extentOffset}return o[0]<=o[1]?o:[o[1],o[0]]},n.setCaretPosition=e=>{if(e>=0){const t=window.getSelection(),o=(e,t,a)=>{if(a||((a=document.createRange()).selectNode(e),a.setStart(e,0)),0===t.count)a.setEnd(e,t.count);else if(e&&t.count>0)if(e.nodeType===Node.TEXT_NODE)e.textContent.length<t.count?t.count-=e.textContent.length:(a.setEnd(e,t.count),t.count=0);else for(var i=0;i<e.childNodes.length&&(a=o(e.childNodes[i],t,a),0!==t.count);i++);return a},a=o(r.querySelector(".smart-editor-editable"),{count:e});a&&(a.collapse(!1),t.removeAllRanges(),t.addRange(a))}},n.execCommand=(e,t)=>{const o=p.getRootNode();o&&o.execCommand(e,!1,t)},Object.defineProperty(e,"selectionStart",{configurable:!1,enumerable:!0,get(){t.value=n.content.textContent;const e=n.getCaretPosition(n.content);return void 0!==e?e[1]:0},set(e){n.setCaretPosition(e)}}),Object.defineProperty(e,"value",{configurable:!1,enumerable:!0,get:()=>(t.value=n.content.textContent,n._getInputValue()),set(e){if(n.content.innerHTML!==e){if(n.content.innerHTML="<div>"+e+"&#8203;</div>",t.value=e,i.set("value",t.value,!1),i.disableSetCaretPosition)return;n.setCaretPosition(n.content.textContent.length-1)}}});const b=e=>{const t=n.content;for(;e&&e!==t;){const t=e.style.backgroundColor;if(t)return t;e=e.parentElement}};n._getSelectionRange=()=>{const e=n;return e._selectionRange||e._setSelectionRange(),e._selectionRange},n._setSelectionRange=(e,t,o)=>{const a=n;let i=r.querySelector(".smart-editor-editable");const l=window.getSelection();let s;if(e){if(s=document.createRange(),"number"==typeof t&&"number"==typeof o)try{s.setStart(e,parseInt(t)),s.setEnd(e,parseInt(o))}catch(t){s.selectNodeContents(e)}else"img"===e.nodeName.toLowerCase()||e.classList.contains("smart-editor-video-container")?(s.setStartBefore(e),s.setEndAfter(e),s.selectNode(e)):s.selectNodeContents(e);l.removeAllRanges(),l.addRange(s)}else l.rangeCount&&(s=l.getRangeAt(0));try{s&&s.startContainer&&i.contains(s.startContainer)&&(n._selectionRange=s)}catch(e){}a._selectionRange||(s=document.createRange(),s.selectNodeContents(i),s.collapse(!0),n._selectionRange=s)},n._getNodeFromList=(e,t)=>{const o=n.content;if(e&&t)for(;e&&e!==o;){const o=e.nodeName.toLocaleLowerCase();if(t.indexOf(o)>-1)return o;e=e.parentElement}},n._setItemValue=(e,t)=>{let o=t.value;if(e&&t)if("button"===t.type)o?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1));else{if(o||"color-input"!==t.type){if(["fontname","formats"].indexOf(t.name)>-1&&(o=t.value,"fontname"===t.name)){const e={segoeUI:"Segoe UI",arial:"Arial",georgia:"Georgia",impact:"Impact",tahoma:"Tahoma",timesNewRoman:"Times New Roman",verdana:"Verdana",roboto:"Roboto"};e[o]&&(o=e[o])}}else o="transparent";o?(e.setAttribute("item-value",o),e.style.setProperty("--item-value",o)):(e.removeAttribute("item-value"),e.style.removeProperty("--item-value"))}},n._getInputValue=g,n._updateToolbarItems=e=>{const t=n,o=t._getSelectionRange();if(!o)return;const a=t.content;let i,l=o.startOffset>o.endOffset?o.endContainer:o.startContainer;if(l&&(l.closest||(l=l.parentElement),l&&l.closest)){e||(e=["alignment","bold","hyperlink","italic","strikethrough","underline","fontsize","fontname","formats","fontcolor","backgroundcolor","orderedlist","unorderedlist","image","checklist","subscript","superscript","h1","h2","h3","code","pre","undo","redo","clearformat"]);for(let o=0,n=e.length;o<n;o+=1){const n=e[o],r=t.tools[n];if(r){let e;if("alignment"===n)e=l.style.textAlign;else if("bold"===n)e=!!t._getNodeFromList(l,["b","strong","h4","h5","h6"]);else if("hyperlink"===n)e=!!t._getNodeFromList(l,["a"]);else if("h1"===n)e=!!t._getNodeFromList(l,["h1"]);else if("h2"===n)e=!!t._getNodeFromList(l,["h2"]);else if("h3"===n)e=!!t._getNodeFromList(l,["h3"]);else if("pre"===n)e=!!t._getNodeFromList(l,["pre"]);else if("p"===n)e=!!t._getNodeFromList(l,["p"]);else if("italic"===n)e=!!t._getNodeFromList(l,["i"]);else if("underline"===n)e=!!t._getNodeFromList(l,["u"]);else if("strikethrough"===n)e=!!t._getNodeFromList(l,["strike"]);else if("fontsize"===n){const t=l.closest(".smart-editor-editable font");t&&(e=t.style.fontSize),e||(i||(i=window.getComputedStyle(l)),e=i.fontSize),e=parseInt(e),isNaN(e)&&(e=""),r.name="fontsize",r.type="dropDown"}else if("fontname"===n){const t=l.closest(".smart-editor-editable font");t&&t.hasAttribute("face")?e=t.getAttribute("face"):(i||(i=window.getComputedStyle(l)),e=i.fontFamily.split(",")[0]),r.name="fontname",r.type="dropDown"}else if("formats"===n&&l!==a){const o=["h1","h2","h3","p","pre"];if(e="",o){const a=o;e=t._getNodeFromList(l,a)||""}}else if("fontcolor"===n){const t=l.closest(".smart-editor-editable font");t?e=t.color:(i||(i=window.getComputedStyle(l)),e=i.color),r.type="colorInput"}else if("backgroundcolor"===n)e=b(l),e||(i||(i=window.getComputedStyle(l)),e=i.backgroundColor),r.type="colorInput";else if("orderedlist"===n||"unorderedlist"===n){e=!!l.closest(`.smart-editor-editable ${"orderedlist"===n?"ol":"ul"} li`);const t=l.closest(`.smart-editor-editable ${"orderedlist"===n?"ol":"ul"} li`);t&&t.parentElement&&t.parentElement.hasAttribute("checklist")&&(e=!1)}else if("checklist"===n){const t=l.closest(`.smart-editor-editable ${"orderedlist"===n?"ol":"ul"} li`);t&&t.parentElement.hasAttribute("checklist")&&(e=!0)}else"subscript"===n?e=!!l.closest(".smart-editor-editable sub"):"superscript"===n?e=!!l.closest(".smart-editor-editable sup"):"clearformat"===n&&(e=!1);if(!e&&r.dataSource){const t=r.dataSource[0];t&&(e=t.value||t)}null!==e&&(r.value=e,t._setItemValue(t.toolbar.querySelector(`.smart-editor-toolbar-item[item-name=${n}]`),r))}}}},n._getTextFromCarret=()=>{const e=n._getSelectionRange(),t=e.startContainer,o=t.textContent;let a,i;if(!e.toString()&&o.length>0&&o.indexOf(" ")>-1){const t=o.slice(0,e.startOffset).lastIndexOf(" ")+1;let n=o.slice(e.endOffset).indexOf(" ");n<0&&(n=o.length-1),a=t>-1?t:e.startOffset,i=Math.max(e.endOffset,e.endOffset+n)}else a=0,i=t.length;return{selectionStartIndex:a,selectionEndIndex:i}},n.focus=()=>{p.focus()},n.blur=()=>{p.blur()},n.getHTML=()=>g(n.content.innerHTML),p.onpointerup=e=>{const t=n,o=e.target;if(t._setSelectionRange(),t._updateToolbarItems(),e.ctrlKey){let e=t._getSelectionRange().startContainer;e&&"a"!==e.nodeName.toLowerCase()&&(e=e.parentElement),e&&"a"===e.nodeName.toLowerCase()&&window.open(e.href,"_blank")}if(o&&"LI"===o.nodeName&&o.closest("UL[checklist]")){const e=t._getSelectionRange();e&&0===e.startOffset&&0===e.endOffset&&(o.hasAttribute("checked")?o.removeAttribute("checked"):o.setAttribute("checked",""))}},p.onpaste=()=>{const e=n;e._setSelectionRange(),e._updateToolbarItems(),t.value=e.content.textContent,i.set("value",t.value,!1)},p.oninput=e=>{const o=n;o._setSelectionRange(),o._updateToolbarItems();const a=t.value;t.value=o.content.textContent,i.set("value",t.value,!1),i.$.fireEvent("input",{value:t.value,oldValue:a,html:n.getHTML()}),e.stopPropagation()};const f=e=>{var t={initialize:function(e){this.document=e},getSelection:function(){return this.document.getSelection?this.document.getSelection():this.document.selection},getRange:function(){var e=this.getSelection();if(!e)return null;try{return e.rangeCount>0?e.getRangeAt(0):this.document.createRange?this.document.createRange():this.document.selection.createRange()}catch(e){return this.document.body.createTextRange()}},selectRange:function(e){if(e.select)e.select();else{var t=this.getSelection();t.addRange&&(t.removeAllRanges(),t.addRange(e))}},selectNode:function(e,t){var o=this.getRange(),a=this.getSelection();if(o.moveToElementText)o.moveToElementText(e),o.select();else if(a.addRange)try{t?o.selectNodeContents(e):o.selectNode(e),a.removeAllRanges(),a.addRange(o)}catch(e){}else a.setBaseAndExtent(e,0,e,1);return e},isCollapsed:function(){var e=this.getRange();return!e.item&&(0==e.boundingWidth||this.getSelection().isCollapsed)},collapse:function(e){var t=this.getRange(),o=this.getSelection();t.select?(t.collapse(e),t.select()):e?o.collapseToStart():o.collapseToEnd()},getContent:function(){var t=this.getRange(),o=e.createElement("div");return this.isCollapsed()?"":(t.cloneContents&&o.appendChild(t.cloneContents()),o.outerHTML)},getText:function(){var e=this.getRange(),t=this.getSelection();return this.isCollapsed()?"":e.text||(t.toString?t.toString():"")},insertContent:function(e){var t=this.getRange();if(t.pasteHTML)t.pasteHTML(e),t.collapse(!1),t.select();else if(t.insertNode)if(t.deleteContents(),t.createContextualFragment)t.insertNode(t.createContextualFragment(e));else{var o=this.document,a=o.createDocumentFragment(),i=o.createElement("div");a.appendChild(i),i.outerHTML=e,t.insertNode(a)}}};return t.initialize(e),t},h=(e,t,o)=>{document.getElementById(e)&&document.getElementById(e).remove();const a=document.createElement("div");a.id=e,a.classList.add("smart-text-area-mention-menu");const l=document.createElement("div");l.setAttribute("role","option"),l.className="smart-text-area-mention-menu-item",l.innerHTML='<input autocomplete="off" spellcheck="false" placeholder="Text to Display" class="smart-input"/>';const r=l.firstElementChild;r.value=t,r.style.width="100%",a.style.minWidth="250px";const s=document.createElement("div");s.setAttribute("role","option"),s.className="smart-text-area-mention-menu-item";const d=t;s.innerHTML='<input autocomplete="off" spellcheck="false" placeholder="URL" class="smart-input"/>';const u=s.firstElementChild;u.style.width="100%",o&&(u.value=o);let c=!1;""===r.value&&(c=!0),r.onchange=()=>{""===r.value?c=!0:r.value!==u.value&&(c=!1)},u.oninput=()=>{c&&(r.value=u.value)},setTimeout((()=>{u.focus()}),50),s.label=d,a.appendChild(l),a.appendChild(s);const m=document.createElement("div");m.classList.add("smart-flex","middle","center");const g=document.createElement("div");g.innerHTML="CANCEL",g.style.cursor="pointer",g.style.paddingLeft=g.style.paddingTop=g.style.paddingRight=g.style.paddingBottom="5px",g.onmouseenter=()=>{g.style.backgroundColor="var(--smart-surface)",g.style.color="var(--smart-surface-color)"},g.onmouseleave=()=>{g.style.backgroundColor="",g.style.color=""};const v=document.createElement("div");v.innerHTML="REMOVE",v.style.cursor="pointer",v.style.paddingLeft=v.style.paddingTop=v.style.paddingRight=v.style.paddingBottom="5px",v.onmouseenter=()=>{v.style.backgroundColor="var(--smart-surface)",v.style.color="var(--smart-surface-color)"},g.onmouseleave=()=>{g.style.backgroundColor="",g.style.color=""};const b=document.createElement("div");b.innerHTML="OK",b.classList.add("smart-button"),b.style.paddingLeft=b.style.paddingTop=b.style.paddingRight=b.style.paddingBottom="5px",b.style.cursor="pointer",b.style.marginLeft="5px",b.style.color="var(--smart-primary)",b.onmouseenter=()=>{b.style.backgroundColor="var(--smart-surface)",b.style.color="var(--smart-surface-color)"},b.onmouseleave=()=>{b.style.backgroundColor="",b.style.color="var(--smart-primary)"},b.onclick=()=>{f(),a.onselectitem(u.value,r.value)},u.onkeydown=e=>{"Enter"===e.key&&b.click()},m.appendChild(g),o&&m.appendChild(v),m.appendChild(b),a.appendChild(m),document.body.appendChild(a);(function(){const e=document.createElement("div");return e.className="smart-overlay-anchor",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.style.zIndex="9999",e.style.display="none",document.body.appendChild(e),e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("onpointerdown",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("onpointerup",(e=>{e.preventDefault(),e.stopPropagation()})),{showOverlay:function(){e.style.display="block"},hideOverlay:function(){e.style.display="none"}}})().showOverlay(),g.onclick=()=>{f()},v.onclick=()=>{f(),a.onselectitem(u.value,r.value,o)};const f=()=>{a.remove();const e=document.querySelector(".smart-overlay-anchor");e&&e.remove(),delete i._activeAnchorMenu};a.onKey=e=>{switch(e.key){case"Escape":f();break;case"Enter":case"Tab":{const t=a.options[a.active];let o=t.name||t.label;if(f(),a.query&&a.query.length>=1){const e=window.getSelection(),t=e.focusNode;t.nodeValue=t.nodeValue.replace(a.query,""),e.getRangeAt(0).setStartAfter(t)}p.getRootNode().execCommand("insertHTML",!1,o),e.preventDefault(),e.stopPropagation();break}}};const h=n._getSelectionRange();let y=h.getClientRects()[0];if(y){let e=y.left,t=y.top;a.style.top=t+10+"px",a.style.left=e+15+"px"}else if(h.startContainer.nodeType!==Node.TEXT_NODE){const e=t=>t?t.offsetTop+e(t.offsetParent):0,t=e=>e?e.offsetLeft+t(e.offsetParent):0,o=(o=>({left:t(o),top:e(o)}))(h.startContainer);let i=o.left,n=o.top;a.style.top=n+10+"px",a.style.left=i+15+"px"}return a};return p.onkeydown=e=>{const o=n,a=e.key;if(i._activeMenu&&("ArrowDown"===a||"ArrowUp"===a||"Enter"===a||"Tab"===a))return i._activeMenu.onKey(e),e.preventDefault(),void e.stopPropagation();if(i._activeAnchorMenu&&("Escape"===a||"Enter"===a||"Tab"===a))return i._activeAnchorMenu.onKey(e),e.preventDefault(),void e.stopPropagation();if("Tab"===a&&e.shiftKey){const e=(e=>{const t=Array.from(document.querySelectorAll(["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","))).filter((e=>e.offsetWidth>0&&e.offsetHeight>0&&"hidden"!==getComputedStyle(e).visibility)),o=t.indexOf(e);return o>0?t[o-1]:null})(t);e&&setTimeout((()=>{e.focus(),p.blur()}),100)}if(o._setSelectionRange(),o._updateToolbarItems(),"@"===e.key&&i.users.length){const e=((e,t)=>{if(0===t.length)return;document.getElementById(e)&&document.getElementById(e).remove();const o=document.createElement("div");o.id=e,o.classList.add("smart-text-area-mention-menu"),o.query="";const a=e=>{0===e.length?o.classList.add("smart-hidden"):o.classList.remove("smart-hidden"),e.forEach(((e,t)=>{const a=document.createElement("div");a.setAttribute("role","option"),a.className="smart-text-area-mention-menu-item",o.appendChild(a);const i=e.name||e.label;a.textContent=i,a.label=i,t===o.active&&(a.classList.add("selected"),a.setAttribute("aria-selected","")),a.onpointerdown=e=>{l(),p.getRootNode().execCommand("insertHTML",!1,i),e.preventDefault(),e.stopPropagation()}}))};document.body.appendChild(o);const l=()=>{o.remove(),delete i._activeMenu};o.onKeyUp=e=>{if(i=e.key,!/^[a-zA-Z]$/.test(i)&&!function(e){return/^[0-9]$/.test(e)}(e.key))return;var i;o.query+=e.key;const n=o.query;if(n.length>=1){const e=t.filter((e=>(e.label||e.name).toLowerCase().startsWith(n)?(e.hidden=!1,!0):(e.hidden=!0,!1)));o.innerHTML="",o.active=0,o.options=e,a(e)}else o.innerHTML="",o.active=0,o.options=t,a(t)},o.onKey=e=>{switch(e.key){case"ArrowDown":o.active=Math.min(o.active+1,o.options.length-1),[...o.children].forEach(((e,t)=>{e.classList.remove("selected"),e.removeAttribute("aria-selected"),t===o.active&&(e.classList.add("selected"),e.setAttribute("aria-selected",""))}));break;case"ArrowUp":o.active=Math.max(o.active-1,0),[...o.children].forEach(((e,t)=>{e.classList.remove("selected"),e.removeAttribute("aria-selected"),t===o.active&&(e.classList.add("selected"),e.setAttribute("aria-selected",""))}));break;case"Enter":case"Tab":{const t=o.options[o.active];let a=t.name||t.label;if(l(),o.query&&o.query.length>=1){const e=window.getSelection(),t=e.focusNode;t.nodeValue=t.nodeValue.replace(o.query,""),e.getRangeAt(0).setStartAfter(t)}p.getRootNode().execCommand("insertHTML",!1,a),e.preventDefault(),e.stopPropagation();break}}};const r=n._getSelectionRange();o.active=0,o.options=t,a(t);let s=r.getClientRects()[0];if(s){let e=s.left,t=s.top;o.style.top=t+10+"px",o.style.left=e+15+"px"}else if(r.startContainer.nodeType!==Node.TEXT_NODE){const e=t=>t?t.offsetTop+e(t.offsetParent):0,t=e=>e?e.offsetLeft+t(e.offsetParent):0,a=(d=r.startContainer,{left:t(d),top:e(d)});let i=a.left,n=a.top;o.style.top=n+10+"px",o.style.left=i+15+"px"}var d;return o})(o.id+"_users",i.users);i._activeMenu=e}let l=n._getSelectionRange().startContainer;l&&"a"!==l.nodeName.toLowerCase()&&(l=l.parentElement),l&&"a"===l.nodeName.toLowerCase()&&e.ctrlKey&&l.classList.add("ctrl")},p.onkeyup=e=>{const o=n;o._setSelectionRange(),o._updateToolbarItems(),t.value=o.content.textContent,i.set("value",t.value,!1),i._activeMenu&&i._activeMenu.onKeyUp(e)},p.onfocus=()=>{r.setAttribute("focus",""),i.toolbarOnFocus&&n.toolbar.parentElement.classList.add("show")},p.onblur=()=>{const o=n;if(i._activeAnchorMenu)return;r.removeAttribute("focus");const a=t.value;t.value=o.content.textContent,i.set("value",t.value,!1),i.toolbarOnFocus&&n.toolbar.parentElement.classList.remove("show"),n.tooltip.classList.remove("open"),i.$.fireEvent("change",{value:t.value,oldValue:a,html:n.getHTML()}),o.content.querySelector("img")&&i.uploadSettings.uploadUrl&&i.uploadSettings.removeUrl&&o.content.querySelectorAll("img").forEach((t=>{if(e.imgArray&&-1===e.imgArray.indexOf(t.src)&&e.uploadSettings.removeUrl){let o=new FormData,a=new XMLHttpRequest;if(o.append(e.uploadSettings.name,t.src),e.imgArrayId[t.src]){const a=e.imgArrayId[t.src].small,i=e.imgArrayId[t.src].medium,n=e.imgArrayId[t.src].large,l=e.imgArrayId[t.src].value;a&&o.append(e.uploadSettings.name+"_small",a),i&&o.append(e.uploadSettings.name+"_medium",i),n&&o.append(e.uploadSettings.name+"_large",n),l&&o.append(e.uploadSettings.name+"_value",l)}a.open("POST",e.uploadSettings.removeUrl),a.send(o)}}))},document.addEventListener("selectionchange",(e=>{const t=n;if(!e.target.getSelection)return;const o=e.target.getSelection().focusNode;t.contentContainer.contains(o)&&(t._setSelectionRange(),t._updateToolbarItems())})),n}render(){const e=this;if(super.render(),e.richText)e._initRichText(e.$.editor,e.$.input);else{new ResizeObserver((()=>{"none"!==e.resize&&(e.style.width=parseInt(e.$.input.offsetWidth)+2+"px",e.style.height=parseInt(e.$.input.offsetHeight)+2+"px")})).observe(e.$.input),e.$.input.style.resize=e.resize}e._initUsersMention(),e._renderMentionTrigger(),e.classList.add("smart-input")}_renderMentionTrigger(){const e=this;if(!this.richText&&e.users&&e.users.length){e.setAttribute("has-users","");const t=document.createElement("span");t.innerHTML="@",t.style.position="absolute",t.classList.add("smart-hidden"),t.classList.add("smart-mention-trigger"),t.style.bottom="3px","none"!==e.resize?t.style.right="10px":t.style.right="5px",t.style.cursor="pointer",t.onpointerdown=t=>{const o=this.$.input.selectionEnd,a=this.$.input.value.slice(0,o),i=this.$.input.value.substring(o);return e.richText?(e.$.editor.component.execCommand("insertHTML","@"),this.$.editor.dispatchEvent(new Event("input")),void t.preventDefault()):a.length>1&&a.substring(a.length-2).indexOf("@")>=0?(this.$.input.dispatchEvent(new Event("input")),void t.preventDefault()):(a.length>0?(this.$.input.value=a+" @"+i,this.$.input.selectionStart=this.$.input.selectionEnd=o+2):0===e.$.input.selectionStart&&(this.$.input.value=a+"@ "+i,this.$.input.selectionStart=this.$.input.selectionEnd=1),this.$.input.dispatchEvent(new Event("input")),void t.preventDefault())},e._mentionTrigger=t,e.addEventListener("focus",(()=>{t.classList.remove("smart-hidden"),e._mentionPlugin&&e._mentionPlugin.refreshMenu()})),e.addEventListener("blur",(()=>{t.classList.add("smart-hidden"),e._mentionPlugin&&e._mentionPlugin.refreshMenu()})),e.onmouseenter=()=>{t.classList.remove("smart-hidden")},e.onmouseleave=()=>{t.classList.add("smart-hidden")},e.$.inputContainer.appendChild(t)}}});const e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"];function t(t,o){const a=document.createElement("div");document.body.appendChild(a);const i=a.style;let n=getComputedStyle(t);if(t.className.indexOf("smart-editor")>=0){const e=t.querySelector(".smart-editor-editable");n=getComputedStyle(e)}i.whiteSpace="pre-wrap",i.wordWrap="break-word",i.position="absolute",i.visibility="hidden",e.forEach((e=>{i[e]=n[e]})),i.overflow="hidden",a.textContent=t.value.substring(0,o);const l=document.createElement("span");l.textContent=t.value.substring(o)||".",a.appendChild(l);const r={top:l.offsetTop+parseInt(n.borderTopWidth),left:l.offsetLeft+parseInt(n.borderLeftWidth),height:l.offsetHeight};if(t.className.indexOf("smart-editor")>=0){const e=t.getBoundingClientRect(),o=window.getSelection().getRangeAt(0).getClientRects()[0];o&&e&&(r.left=o.left-e.left,r.top=o.top-e.top)}return a.remove(),r}Smart.Mention=class{constructor(e,t,o,a,i){this.ref=e,this.menuRef=t,this.resolveFn=o,this.replaceFn=a,this.menuItemFn=i,this.options=[],this.makeOptions=this.makeOptions.bind(this),this.closeMenu=this.closeMenu.bind(this),this.selectItem=this.selectItem.bind(this),this.onInput=this.onInput.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.renderMenu=this.renderMenu.bind(this),this.ref.addEventListener("input",this.onInput),this.ref.addEventListener("keydown",this.onKeyDown)}destroy(){this.ref.removeEventListener("input",this.onInput),this.ref.removeEventListener("keydown",this.onKeyDown)}async makeOptions(e){const t=await this.resolveFn(e);0!==t.lenght?(this.options=t,this.renderMenu()):this.closeMenu()}closeMenu(){setTimeout((()=>{this.options=[],this.left=void 0,this.top=void 0,this.triggerIdx=void 0,this.renderMenu()}),0)}selectItem(e){return()=>{const t=this.ref.value.substr(0,this.triggerIdx),o=this.options[e],a=this.replaceFn(o,this.ref.value[this.triggerIdx]),i=this.ref.value.substr(this.ref.selectionStart),n=`${t}${a}${i}`;-1!==this.ref.className.indexOf("smart-editor")?this.ref.component.execCommand("insertHTML",o.name):(this.ref.value=n,this.ref.ownerElement&&(this.ref.ownerElement.value=n));const l=this.ref.value.length-i.length;-1===this.ref.className.indexOf("smart-editor")?this.ref.setSelectionRange(l,l):this.ref.selectionStart=l,this.ref.dispatchEvent(new Event("input")),this.closeMenu(),this.ref.focus()}}onInput(e){const o=this.ref.selectionStart,a=this.ref.value.slice(0,o),i=a.split(/\s/),n=i[i.length-1],l=a.endsWith(n)?a.length-n.length:-1;if(!("@"===a[l]))return void this.closeMenu();const r=a.slice(l+1);this.makeOptions(r);const s=t(this.ref,o),{top:d,left:u}=this.ref.getBoundingClientRect();setTimeout((()=>{this.active=0,this.left=window.scrollX+s.left+u+this.ref.scrollLeft,this.top=window.scrollY+s.top+d+s.height-this.ref.scrollTop,this.triggerIdx=l,this.renderMenu()}),0)}refreshMenu(){void 0!==this.triggerIdx&&null!==this.triggerIdx&&(this.ref===document.activeElement?this.triggerIdx&&this.menuRef.classList.remove("smart-hidden"):this.menuRef.classList.add("smart-hidden"),setTimeout((()=>{const e=this.ref.selectionStart,o=t(this.ref,e),{top:a,left:i}=this.ref.getBoundingClientRect();this.left=window.scrollX+o.left+i+this.ref.scrollLeft,this.top=window.scrollY+o.top+a+o.height-this.ref.scrollTop,this.menuRef.style.left=this.left+"px",this.menuRef.style.top=this.top+"px"})))}onKeyDown(e){let t=!1;if(void 0!==this.triggerIdx)switch(e.key){case"ArrowDown":this.active=Math.min(this.active+1,this.options.length-1),this.renderMenu(),t=!0;break;case"ArrowUp":this.active=Math.max(this.active-1,0),this.renderMenu(),t=!0;break;case"Enter":case"Tab":this.selectItem(this.active)(),t=!0}t&&e.preventDefault()}renderMenu(){return void 0===this.top?(this.menuRef.hidden=!0,void this.menuRef.classList.add("smart-hidden")):this.options.length?(this.menuRef.style.left=this.left+"px",this.menuRef.style.top=this.top+"px",this.menuRef.innerHTML="",this.ref===document.activeElement&&this.menuRef.classList.remove("smart-hidden"),this.options.forEach(((e,t)=>{this.menuRef.appendChild(this.menuItemFn(e,this.selectItem(t),this.active===t))})),this.menuRef.hidden=!1,void this.menuRef.classList.remove("smart-hidden")):(this.menuRef.hidden=!0,void this.menuRef.classList.add("smart-hidden"))}}})();