
/* Smart UI v23.1.19 (2025-06-17) 
Copyright (c) 2011-2024 jQWidgets. 
License: https://htmlelements.com/license/ */ //

(()=>{Smart.Utilities.Assign("Grid.Cell",class{constructor(e,t){const l=this;if(l.row=e,l.column=t,l.grid=e.grid,l.rowSpan=1,l.colSpan=1,l.value=void 0,l.fontSize=null,l.fontWeight=null,l.fontFamily=null,l.fontStyle=null,l.color=null,l.background=null,l.textDecoration=null,l.tooltip=null,l.align=null,l.verticalAlign=null,l.readonly=!1,l.oldValue=void 0,l._updating=!1,l.styleChanged=!0,l.editor=null,l.template=null,l.isEditing=!1,l.canNotify=!0,l.selected=!1,l.focused=!1,l.error=!1,l.format=null,l.formula=null,e._style){const t=e._style;l.color=t.color,l.background=t.background,l.fontFamily=t.fontFamily,l.fontSize=t.fontSize,l.fontStyle=t.fontStyle,l.textDecoration=t.textDecoration,l.fontWeight=t.fontWeight}if(l.grid&&l.grid.formulas){let i=e.data[t.dataField];t.formula&&(l.formula=l._parseFormula(t.formula)),i&&(""+i).startsWith("=")&&(l.formula=l._parseFormula(""+i)),l._formula=t.formula}return new Proxy(l,{deleteProperty:function(e,t){return delete e[t],!0},get:function(i,a){if("value"===a){const i=l.column.displayField?l.row.data[l.column.displayField]:l.row.data[l.column.dataField];if(l.grid&&l.grid.formulas&&l.formula){const i=l.grid._formulaParser;if(i){if(l.grid&&l.grid.formulas&&l._formula!==t.formula){let i=e.data[t.dataField];t.formula&&(l.formula=l._parseFormula(t.formula)),i&&(""+i).startsWith("=")&&(l.formula=l._parseFormula(""+i)),l._formula=t.formula}return i.parse(l.formula.slice(1))}}return i}if("editor"===a||"template"===a)return i[a]||l.column[a];if("focused"===a){if(l.grid.selection.allowCellSelection&&l.grid._selection.focusedCell&&l.grid._selection.focusedCell.id===l.row.id&&l.grid._selection.focusedCell.dataField===l.column.dataField)return!(l.grid&&l.grid.dataSource.virtualDataSource&&!l.grid.dataSource.id)||l.grid._selection.focusedCell.id===l.row.index;if(l.grid.selection.allowRowSelection&&l.grid._selection.focusedCell&&l.grid._selection.focusedCell.id===l.row.id&&l.grid._selection.focusedCell.dataField===l.column.dataField)return!(l.grid&&l.grid.dataSource.virtualDataSource&&!l.grid.dataSource.id)||l.grid._selection.focusedCell.id===l.row.index;const e=l.parent();return!!(e&&l.grid.selection.allowCellSelection&&l.grid._selection.focusedCell&&l.grid._selection.focusedCell.id===e.row.id&&l.grid._selection.focusedCell.dataField===e.column.dataField)}if("selected"===a)return!0===l.row.getProperty("selected")||(!0===l.column.getProperty("selected")||!!l.grid._selection.cells["row"+l.row.id]&&l.grid._selection.cells["row"+l.row.id][l.column.dataField]);if("modifiedValue"===a){l.grid._cellsUpdatedValues||(l.grid._cellsUpdatedValues=[]);const e=l.grid._cellsUpdatedValues[l.row.id+"_"+l.column.dataField];return void 0!==e?e:i.value}return i[a]},set:function(e,i,a){const r=this.get(e,i);if(r===a)return!0;if(e[i]=a,"element"===i||"isEditing"===i||"oldValue"===i||"_updating"===i||"notifyFn"===i||i.startsWith("_")||"canNotify"===i)return!0;if("error"===i)return!0;if("focused"===i&&(l.grid._selection.focusedCell={id:l.row.id,dataField:l.column.dataField,value:l.value,index:l.row.index}),"colSpan"!==i&&"rowSpan"!==i||a>=0&&-1===l.grid._cellsMerge.indexOf(l)&&l.grid._cellsMerge.push(l),"row"===i||"column"===i||"grid"===i||"styleChanged"===i||"formula"===i)return"formula"===i&&(l.formula=l._parseFormula(l.formula)),!0;if("background"!==i&&"fontSize"!==i&&"fontWeight"!==i&&"fontFamily"!==i&&"textDecoration"!==i&&"color"!==i&&"fontStyle"!==i||(l.grid._cellStyles["row"+l.row.id]=!0,l.grid._cellStyles.length++,l._styleChanged=!0),"value"===i){void 0===l.oldValue&&(l.oldValue=r),null==a&&delete l._formula;(()=>{if(l.grid.dataSource.boundSource.canNotify=!1,null===a&&(l.column.allowNull||(a="number"===l.column.dataType||"int"===l.column.dataType||"float"===l.column.dataType||"integer"===l.column.dataType?0:"date"===l.column.dataType?new Date:"boolean"!==l.column.dataType&&"bool"!==t.dataType&&"")),void 0===a&&(a=null),null!==a&&void 0!==a.label&&void 0!==a.value)l.row.data[l.column.displayField]=a.label,l.row.data[l.column.dataField]=a.value;else if(l.column.valueField&&(l.row.data[l.column.valueField]=a),l.row.data[l.column.dataField]=a,l.column.displayField!==l.column.dataField&&"object"!=typeof a)if(l.column._dataSource){let e=a;for(let t=0;t<l.column._dataSource.length;t++)if(l.column._dataSource[t].value===a){e=l.column._dataSource[t].label;break}l.row.data[l.column.displayField]=e}else l.row.data[l.column.displayField]=a;const e=l.grid.dataSource.dataItemById[l.row.id];if(e){const t=e.$.index;l.grid.dataSource&&(null!==a&&a.label&&a.value&&l.column.displayField!==l.column.dataField?l.grid._sortedColumns&&l.grid._sortedColumns.length>0?(e[l.column.dataField]=a.value,e[l.column.displayField]=a.label):(l.grid.dataSource.boundSource[t][l.column.dataField]=a.value,l.grid.dataSource.boundSource[t][l.column.displayField]=a.label):a!==l.grid.dataSource.boundSource[t][l.column.dataField]&&(l.grid._sortedColumns&&l.grid._sortedColumns.length>0?e[l.column.dataField]=a:l.grid.dataSource.boundSource[t][l.column.dataField]=a))}l.grid.dataSource.boundSource.canNotify=!0,l.grid.onCellValueChanged&&a!==r&&l.grid.onCellValueChanged({id:l.row.id,dataField:l.column.dataField,value:a,oldValue:r})})()}return"selected"===i?(l.grid._selection.cells["row"+l.row.id]&&(delete l.grid._selection.cells["row"+l.row.id][l.column.dataField],1===Object.getOwnPropertyNames(l.grid._selection.cells["row"+l.row.id]).length&&delete l.grid._selection.cells["row"+l.row.id]),l.grid._selection.cells["column"+l.column.dataField]&&(delete l.grid._selection.cells["column"+l.column.dataField][l.row.id],1===Object.getOwnPropertyNames(l.grid._selection.cells["column"+l.column.dataField]).length&&delete l.grid._selection.cells["column"+l.column.dataField]),a&&(l.grid._selection.cells["row"+l.row.id]||(l.grid._selection.cells["row"+l.row.id]=[]),l.grid._selection.cells["column"+l.column.dataField]||(l.grid._selection.cells["column"+l.column.dataField]=[]),l.grid._selection.cells["row"+l.row.id][l.column.dataField]=!0,l.grid._selection.cells["column"+l.column.dataField][l.row.id]=!0),l.grid._recycle(!1,!0,!1),l.propertyChanged&&l.propertyChanged(name.substring(1),r),!0):!(!l._updating&&l.canNotify)||(l.grid._recycle(),!l.row.canNotify||(l.propertyChanged&&l.propertyChanged(name.substring(1),r),!0))}})}_parseFormula(e){const t=this.row;if(!e)return e;return"string"!=typeof e&&(e=""+e),!1===e.startsWith("=")&&(e="="+e),e=function(e,t){return e.replace(/COL\(([^)]+)\)/g,((e,l)=>`${l}${t}`))}(e,1+t.index)}setStyle(e){this.setProperties(e)}_setStyle(e){const t=this;if(t._styleChanged){if(!t.grid._cellStyles.length)return;let l="";const i={background:"background",color:"color",fontSize:"font-size",fontFamily:"font-family",fontWeight:"font-weight",fontStyle:"font-style",textDecoration:"text-decoration"},a=e=>{const a=t[e];if(""===a||null===a)return;const r=i[e];l+=`${r}: ${a};`},r=["background","color","fontSize","fontFamily","fontWeight","fontStyle","textDecoration"];for(let e=0;e<r.length;e++)a(r[e]);e.getAttribute("style")!==l&&(""===l?e.removeAttribute("style"):e.setAttribute("style",l)),""!==e.style.paddingBottom&&(e.style.paddingBottom=""),t._styleChanged=!1}t.grid&&!t.grid.appearance.showSelectionOnTop||t.selected&&(t.background||t.color)&&(e.style.background="",e.style.color="")}getFormattedValue(e,t){const l=this;if(null==e||""===e)return e;if(!t)return""+e;if(l.column._cellsCachedValues||(l.column._cellsCachedValues=[]),l.column._cellsCachedValues[""+e+t+l.column.grid.locale])return l.column._cellsCachedValues[""+e+t+l.column.grid.locale];if("date"===l.column.dataType||"datetime"===l.column.dataType||"time"===l.column.dataType){if("dateRangeInput"===l.column.editor.template){if(Array.isArray(e)){const i=l.formatDate(e[0],t)+" - "+l.formatDate(e[1],t);return l.column._cellsCachedValues[""+e+t+l.column.grid.locale]=i,i}{const i=l.formatDate(e,t);return l.column._cellsCachedValues[""+e+t+l.column.grid.locale]=i,i}}let i=l.formatDate(e,t);return"1/1/0001 12:00 AM"===i&&(i=""),l.column._cellsCachedValues[""+e+t+l.column.grid.locale]=i,i}if("int"===l.column.dataType||"int64"===l.column.dataType||"float"===l.column.dataType||"number"===l.column.dataType){let i=l.formatNumber(e,t);return"NaN"===i&&(i=""),l.column._cellsCachedValues[""+e+t+l.column.grid.locale]=i,i}if("any"===l.column.dataType||"string"===l.column.dataType&&t&&t.length){let i=!1;const a=""+e;if((a.indexOf("/")>=0||a.indexOf("-")>=0||a.indexOf(":")>=0)&&(t.indexOf("d")>=0&&t.indexOf("M")>=0&&(i=!0),(t.indexOf("d")>=0||t.indexOf("M")>=0||t.indexOf("y")>=0||t.indexOf("h")>=0||t.indexOf("H")>=0||t.indexOf("m")>=0)&&(i=!0)),i){let i=l.formatDate(e,t);return"1/1/0001 12:00 AM"===i&&(i=""),l.column._cellsCachedValues[""+e+t+l.column.grid.locale]=i,i}{"string"==typeof e&&(e=parseFloat(e));let i=l.formatNumber(e,t);return"NaN"===i&&(i=""),l.column._cellsCachedValues[""+e+t+l.column.grid.locale]=i,i}}return e}formatDate(e,t){if(!Smart.Utilities.DateTime)return e;const l=this,i=l.grid;if(l.column.formatSettings.Intl&&l.column.formatSettings.Intl.DateTimeFormat){return new Intl.DateTimeFormat(this.grid.locale,l.column.formatSettings.Intl.DateTimeFormat).format(e)}!t&&l.column.formatSettings.dateFormat&&(t=l.column.formatSettings.dateFormat);try{const l=new Smart.Utilities.DateTime(e);l.calendar.locale=i.locale,i.messages[i.locale]&&i.messages[i.locale].calendar&&(i.messages[i.locale].calendar.months&&(l.calendar.months=i.messages[i.locale].calendar.months),i.messages[i.locale].calendar.days&&(l.calendar.days=i.messages[i.locale].calendar.days),void 0!==i.messages[i.locale].calendar.firstDay&&(l.calendar.firstDay=i.messages[i.locale].calendar.firstDay),void 0!==i.messages[i.locale].calendar.eras&&(l.calendar.eras=i.messages[i.locale].calendar.eras),void 0!==i.messages[i.locale].calendar.AM&&(l.calendar.AM=i.messages[i.locale].calendar.AM),void 0!==i.messages[i.locale].calendar.PM&&(l.calendar.PM=i.messages[i.locale].calendar.PM),void 0!==i.messages[i.locale].calendar["/"]&&(l.calendar["/"]=i.messages[i.locale].calendar["/"]),void 0!==i.messages[i.locale].calendar[":"]&&(l.calendar[":"]=i.messages[i.locale].calendar[":"]),l.calendar.today=i.messages[i.locale].today);let a=l.toString(t);return a!==i.messages[i.locale].today||i.showTodayDateAsString||(l.showTodayDateAsString=!1,a=l.toString(t),delete l.showTodayDateAsString),a}catch(t){return e}}formatNumber(e,t){if(!Smart.Utilities.NumberRenderer)return e;const l=this,i=l.grid;if(l.column.formatSettings.Intl&&l.column.formatSettings.Intl.NumberFormat){if(l.column.formatSettings.Intl.NumberFormat.currency&&Smart.Utilities.CurrencyFormatter){const t=void 0!==l.column.formatSettings.Intl.NumberFormat.maximumFractionDigits?l.column.formatSettings.Intl.NumberFormat.maximumFractionDigits:2,i=(new Smart.Utilities.CurrencyFormatter).format(e,{decimalPlaces:t,currency:l.column.formatSettings.Intl.NumberFormat.currency});return"accounting"===l.column.formatSettings.Intl.NumberFormat.currency.currencySign&&e<0?"("+i.replace("-","")+")":i}if(l.column.formatSettings.Intl.NumberFormat.locale){return new Intl.NumberFormat(l.column.formatSettings.Intl.NumberFormat.locale,l.column.formatSettings.Intl.NumberFormat).format(e)}{const t=new Intl.NumberFormat(this.grid.locale,l.column.formatSettings.Intl.NumberFormat).format(e);return"squaremeter"===l.column.formatSettings.Intl.NumberFormat.type?t+" m²":"cubicmeter"===l.column.formatSettings.Intl.NumberFormat.type?t+" m³":t}}const a=new Smart.Utilities.NumberRenderer;if(a.localizationObject){const e=l.column.formatSettings,t=i.messages[i.locale]?i.messages[i.locale].calendar:{};e.decimalPlaces&&(a.localizationObject.decimalPlaces=e.decimalPlaces),(e.decimalSeparator||t.decimalSeparator)&&(a.localizationObject.decimalSeparator=e.decimalSeparator||t.decimalSeparator,a.localizationObject.decimalseparator=a.localizationObject.decimalSeparator),(e.thousandsSeparator||t.thousandsSeparator)&&(a.localizationObject.thousandsSeparator=e.thousandsSeparator||t.thousandsSeparator,a.localizationObject.thousandsseparator=a.localizationObject.thousandsSeparator),a.localizationObject.currencysymbol=t.currencySymbol,a.localizationObject.currencysymbolposition=t.currencySymbolPosition,e.prefix&&(a.localizationObject.currencysymbol=e.prefix),e.sufix&&(a.localizationObject.currencysymbol=e.sufix,a.localizationObject.currencysymbolposition="after")}const r=a.formatNumber(e,t);return void 0===r?e:e<0&&l.column.formatSettings.negativeWithBrackets?"("+r+")":r}refresh(){const e=this;if(e.element){const t=e.element.firstChild;e._setStyle(t)}}autoWrap(){const e=this;e.element&&e.element._autoWrap()}setProperties(e){const t=this;t._updating=!0;for(let l in e)t[l]=e[l];t._updating=!1,t.grid._recycle()}createElement(){const e=document.createElement("smart-grid-cell");return e.setAttribute("role","gridcell"),this.element=e,e._initialize(this),e}render(){this.element&&this.element._render()}parent(e){const t=this,l=t.row,i=t.column.dataField,a=t.grid;if(!a._cellsMerge.length)return null;if(t.__parentCells&&void 0!==t.__parentCells["row"+l.id+"_column_"+i])return t.__parentCells["row"+l.id+"_column_"+i];let r=a.getVisibleRows();a.paging.enabled&&"page"===a.selection.selectAllMode&&(r=r.slice(a.paging.pageIndex*a.paging.pageSize,(a.paging.pageIndex+1)*a.paging.pageSize)),t.__parentCells||(t.__parentCells=[]);for(let n=0;n<a._cellsMerge.length;n++){const s=a._cellsMerge[n];let o=[],d=[];if(o.push(s.row),s.rowspan>1){const e=r.indexOf(s.row);if(e>=0)for(let t=e;t<e+s.rowSpan;t++)r[t]&&-1===o.indexOf(r[t])&&o.push(r[t])}if(d.push(s.column.dataField),s.colspan>1){const e=a.columns.indexOf(a.columnByDataField[s.column.dataField]);for(let t=e;t<e+s.colSpan;t++)a.columns[t]&&-1===d.indexOf(a.columns[t].dataField)&&d.push(a.columns[t].dataField)}if(o.indexOf(l)>=0&&d.indexOf(i)>=0){if(e){const e={cell:s.row.getCell(s.column.dataField),rows:o,columns:d,row:s.row,column:s.column,endRow:o[o.length-1],endColumn:a.columnByDataField[d[d.length-1]]};return t.__parentCells["row"+l.id+"_column_"+i]=e,e}const r=s.row.getCell(s.column.dataField);return t.__parentCells["row"+l.id+"_column_"+i]=r,r}}return t.__parentCells["row"+l.id+"_column_"+i]=null,null}}),Smart("smart-grid-cell",class extends Smart.BaseElement{static get properties(){return{}}get hasStyleObserver(){return!1}get enableShadowDOM(){return!1}addThemeClass(){}addDefaultClass(){}get isUtilityElement(){return!0}_createTooltip(e,t,l,i){const a=this.cell.grid;if(!a)return;let r={left:e.pageX,top:e.pageY-10};if(!a._cellTooltip){const e=document.createElement("smart-button");e.classList.add("secondary"),e.style.boxShadow="var(--smart-elevation-4)",e.style.opacity=.9,e.style.transition="all cubic-bezier(0.6, 0.2, 0, 0.8) 0.2s",e.style.setProperty("--smart-button-text-transform","normal"),document.body.appendChild(e),e.style.position="absolute",e.style.zIndex=99999999,a._cellTooltip=e}const n=a._cellTooltip;n.innerHTML===t&&n.element===l||(n.innerHTML=""+t,n.style.display="",n.style.visibility="","top"===i?(r=a.offset(l),n.style.top=r.top-n.offsetHeight-5+"px",n.style.left=r.left+l.offsetWidth/2-n.offsetWidth/2+"px"):(n.style.top=r.top+25+"px",n.style.left=r.left-15+"px")),n.innerHTML=""+t,n.style.display="",n.style.visibility=""}_refresh(){const e=this;e.innerHTML="",e._initialize(e.cell)}_createToggleButton(e,t){const l=this,i=document.createElement("div"),a=document.createElement("button"),r=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),o=document.createElement("span"),d=t.grid;t.row.expanded?a.setAttribute("toggled",""):a.removeAttribute("toggled",""),a.tabIndex=-1,l.toggleButton=a,l.checkbox=s,e.appendChild(i),e.appendChild(n),n.setAttribute("content",""),i.setAttribute("indent",""),r.setAttribute("label",""),a.setAttribute("toggle-button",""),s.setAttribute("checkbox",""),s.setAttribute("role","checkbox"),l.setAttribute("has-toggle-button",""),n.appendChild(a),n.appendChild(s),o.classList.add("smart-input"),s.appendChild(o),d.checkBoxes.visible?o.classList.remove("smart-hidden"):o.classList.add("smart-hidden"),n.appendChild(r),l.content=r}_initialize(e){const t=this,l=document.createElement("div"),i=e.column,a=e.grid;t._properties=[],t.cell=e,t.appendChild(l);let r=!1;if(i&&i._treeColumn&&a.dataSource.boundHierarchy&&(r=!0,e.row.filterRow&&(r=!1),!a.grouping.enabled&&a.dataSource.groupBy&&a.dataSource.groupBy.length>0&&(r=!1),a.grouping.enabled&&a.dataSource.groupBy&&0===a.dataSource.groupBy.length&&(r=!1)),r)return t._createToggleButton(l,e),void(t.isRendered=!0);{const e=document.createElement("div");l.appendChild(e)}t.content=l,t.isRendered=!0}_renderCommands(){const e=this,t=e.cell.grid;if(t.__cellsCommandTemplate)return e.firstChild.innerHTML=t.__cellsCommandTemplate,void t._updateCommandColumnCommandsVisibility(e.firstChild,e.cell.row);const l=t._getCommandColumnCommandsTemplate();e.firstChild.innerHTML=l,t._updateCommandColumnCommandsVisibility(e.firstChild,e.cell.row),t.__cellsCommandTemplate=l}_renderGroupCell(){const e=this,t=e.cell.grid,l=e.cell.column,i=e.cell.row;[...e.attributes].forEach((t=>e.removeAttribute(t.name))),e.setAttribute("group","");const a=l===t._firstRenderedColumn;e.style.width!==l.computedWidth+"px"&&(e.style.width=l.computedWidth+"px"),a||(t.rightToLeft?e.style.right!==l.left+"px"&&(e.style.right=l.left+"px"):e.style.left!==l.left+"px"&&(e.style.left=l.left+"px")),e.classList.contains("smart-hidden")&&e.classList.remove("smart-hidden"),l===t._firstRenderedColumn||i.summaryRow||e.classList.add("smart-hidden"),l.autoGenerated&&(e.style.width="0px");let r=i.label;const n=function(e,t,l){if(!t)return[];for(let i=0;i<t.length;i++){const a=t[i];a.$&&!1===a.$.filtered||(void 0!==a[e]&&l.push(a),a.summaryRow||(a.children||a.data&&a.data.children)&&n(e,a.children,l))}return l};let s="";if(void 0!==i.label){let o="",d=[];if(t.grouping.summaryRow.visible){let r=[];const s={},c=a?l.summary.length>0?l.summary:["count"]:l.summary;c.length&&(r=n(l.dataField,i.summaryRow?i.parent.data.children:i.data.children,[])),s[l.dataField]=c;const m=c.length>0?t.dataSource.summarize([s],r):null;if(m)for(let r=0;r<c.length;r++){const n=c[r];r>0&&(o+=", ");let u=m[l.dataField][n];const p=l.cellsFormat;if(void 0!==u){if(p&&(u=e.cell.getFormattedValue(u,p)),a){const a=t.columnByDataField[i.groupDataField];if(a){s[a.dataField]=c,m[a.dataField]=m[l.dataField],u=m[a.dataField][n];const t=a.cellsFormat;t&&(u=e.cell.getFormattedValue(u,t))}}o+=t.localize(n,{value:u}),m[l.dataField]&&m[l.dataField][n]&&d.push(m[l.dataField][n])}}}if(t.dataSource.virtualDataSourceOnExpand&&(o=""),a){const l=t.columnByDataField[i.groupDataField],a=l?l.label:"";if("advanced"===t.grouping.renderMode){if(i.summaryRow)r="<div header group-advanced><span group></span><span value></span>",o&&(r+="<div summary>",r+=o,r+="</div>");else{let e=i.label?i.label:t.localize("blankSummary");i.label||"taskStatus"!==i.groupDataField||(e="");let n="";if(l&&l.editor&&l.editor.dataSource){const t=l.editor.dataSource.find((t=>t.value===e||t.label===e));t&&t.color?(n=`--smart-primary: ${t.color}`,t.label&&(e=t.label)):t&&t.label&&(e=t.label)}if(i.label||"taskStatus"!==i.groupDataField||(e=t.localize("uncategorized")),"object"==typeof e&&l.cellsFormat){const t=i.getCell(l.dataField);e=t.getFormattedValue(e,l.cellsFormat)}else if("object"==typeof e&&e&&e instanceof Date){const t=i.getCell(l.dataField);e=t.getFormattedValue(e,"d")}const s=t.editing.addNewRow.visible?'<span add-row class="smart-grid-icon smart-icon-plus-circled show"></span>':"";if(r=`<div style="${n}" header group-advanced><span group>${s}${a}: </span><span value>${e}</span>`,e=""+e,e&&e.indexOf(",")>=0){let t="";r=`<div style="display: flex;" header group-advanced><span group>${s}${a}: </span>`;let i=e.split(",");for(let e=0;e<i.length;e++){let a=i[e].trim();if(l&&l.editor&&l.editor.dataSource){const e=l.editor.dataSource.find((e=>e.value===a||e.label===a));e&&e.color?(n=`--smart-primary: ${e.color}`,e.label&&(a=e.label)):e&&e.label&&(a=e.label),t+=`<span style="${n}" value>${a}</span>`}}r+=t}o&&t.grouping.summaryRow.inline&&(r+="<span summary>",r+=""+o,r+="</span>")}r+="</div>",e.classList.add("smart-grid-column-border-collapse")}else if("compact"===t.grouping.renderMode){if(i.summaryRow)r="<div header><span group></span><span value></span>",o&&(r+="<div summary>",r+=o,r+="</div>");else{let e=i.label;if(l.displayField!==l.dataField&&i.data.data&&(e=i.data.data[l.displayField]),"object"==typeof e&&l.cellsFormat){e=i.getCell(l.dataField).getFormattedValue(e,l.cellsFormat)}r="<div header><span group>"+a+": </span><span value>"+e+"</span>",o&&t.grouping.summaryRow.inline&&(r+="<span summary>",r+="  ("+d+")",r+="</span>")}r+="</div>",e.classList.add("smart-grid-column-border-collapse")}else if("basic"===t.grouping.renderMode){if(r=i.label,l.displayField!==l.dataField&&i.data.data&&(r=i.data.data[l.displayField]),"object"==typeof r&&l.cellsFormat){r=i.getCell(l.dataField).getFormattedValue(r,l.cellsFormat)}i.summaryRow?o&&(r+="<div summary>",r+=o,r+="</div>"):o&&t.grouping.summaryRow.inline&&(r+="<span summary>",r+="  ("+d+")",r+="</span>"),e.classList.add("smart-grid-column-border-collapse")}else if("multipleColumns"===t.grouping.renderMode){if(r=i.label,"object"==typeof r&&l.cellsFormat){r=i.getCell(l.dataField).getFormattedValue(r,l.cellsFormat)}i.summaryRow?o&&(r+="<div summary>",r+=o,r+="</div>"):o&&t.grouping.summaryRow.inline&&(r+="<span summary>",r+="  ("+d+")",r+="</span>"),e.classList.add("smart-grid-column-border-collapse")}e.setAttribute("has-toggle-button","")}else e.removeAttribute("has-toggle-button",""),r=o;s=o}let o=e.firstChild;if(t.dataSource.boundHierarchy&&a){o.children.length<=1&&(e.innerHTML="<div></div>",o=e.firstChild,e._createToggleButton(o,e.cell),o=e.firstChild);const n=o.children[0],s=o.children[1].children[0],d=o.children[1].children[1].firstChild,c=o.children[1].children[2];n.setAttribute("indent",""),i.checked?d.setAttribute("checked",""):!1===i.checked?d.removeAttribute("checked"):null===i.checked&&d.setAttribute("checked","indeterminate"),i.leaf?s.classList.add("smart-visibility-hidden"):(s.classList.remove("smart-visibility-hidden"),i.expanded?s.setAttribute("toggled",""):s.removeAttribute("toggled",""));let m="";if(!l._treeColumn||i.summaryRow||i.filterRow?e.toggleButton.classList.add("smart-hidden"):e.toggleButton.classList.remove("smart-hidden"),l._treeColumn)if(t.grouping.enabled){let e=i.level-1;if(1+e===0)m+="",n.classList.add("smart-hidden");else{if("multipleColumns"===t.grouping.renderMode){let l=0;for(let i=0;i<t.columns.length;i++)i<1+e&&(l+=t.columns[i].computedWidth);m+='<div style="width: '+l+'px;"></div>'}else m+='<div style="width: '+(1+e)*t.grouping.groupIndent+'px;"></div>';n.classList.remove("smart-hidden")}}else for(let e=0;e<i.level;e++)m+="<div class='smart-indent'></div>";if(void 0===i.label||i.summaryRow||i.filterRow?s.classList.add("smart-hidden"):(s.classList.remove("smart-hidden"),s.style.marginLeft=""),n.innerHTML=m,c.innerHTML=r,a&&t.grouping.formatFunction){const a={row:i,column:l,groupDataField:i.groupDataField,cell:e.cell,value:r,template:null},n=t.grouping.formatFunction(a);n&&(a.value=n),a.value!==r?c.innerHTML=a.value:a.template&&(c.innerHTML=a.template)}t.appearance.showTooltips?c.setAttribute("title",i.label?i.label:t._unescapeString(r)):c.hasAttribute("title")&&c.removeAttribute("title")}else void 0!==i.label&&t.grouping.enabled&&!a&&(o.innerHTML=r,l.summary.length&&t.grouping.summaryRow.inline&&r&&e.classList.remove("smart-hidden"));void 0!==i.label&&t.grouping.enabled&&a&&!l._treeColumn&&l.summary.length&&t.grouping.summaryRow.inline&&r&&(t.rightToLeft||e.style.left!==l.left+"px"&&(e.style.left=l.left+"px"),e.removeAttribute("has-toggle-button",""),r=s,o.innerHTML=r);let d="smart-label";e.style.zIndex="";const c=t.editing.addNewColumn.visible&&t._addNewColumn?t._addNewColumn.width-1:0;if(a){const l=t.columnByDataField[i.groupDataField];l&&(l.cellsAlign&&(d+=" align-"+l.cellsAlign),l.cellsVerticalAlign&&(d+=" align-"+l.cellsVerticalAlign)),e.setAttribute("header",""),i.summaryRow||(e.style.width="calc(100% - "+c+"px)"),void 0!==i.label&&(e.style.zIndex=11)}else l===t._firstRenderedColumn&&(e.style.zIndex=4),e.setAttribute("header",""),i.summaryRow||(e.style.width="calc(100% - "+c+"px)"),l.summary.length&&t.grouping.summaryRow.inline&&r&&(e.style.width=l.computedWidth+"px",e.style.zIndex=11,e.classList.add("smart-grid-column-border-collapse"),l.cellsAlign&&(d+=" align-"+l.cellsAlign),l.cellsVerticalAlign&&(d+=" align-"+l.cellsVerticalAlign));if(i.summaryRow&&(e.setAttribute("header",""),e.classList.add("smart-grid-column-border-collapse"),l.cellsAlign&&(d+=" align-"+l.cellsAlign),l.cellsVerticalAlign&&(d+=" align-"+l.cellsVerticalAlign)),o.className!==d&&(o.className=d),l.formatFunction){const t={row:i,column:l,cell:e.cell,value:null,template:null,group:{value:r,template:null}},a=l.formatFunction(t);if(a&&(t.group.value=a),t.group.value!==r)if(l._treeColumn){o.children[1].children[2].innerHTML=t.group.value}else o.innerHTML=t.group.value;null!==t.group.template&&(o.innerHTML=t.group.template)}}_renderFilterCell(e){const t=this,l=t.cell.grid,i=t.cell.column;let a;const r=(e,t)=>{l._handleFilterMenuClick(e,t)};l._filterInfo||(l._filterInfo={},l._filterInfo.stringConditions=[{icon:"smart-icon-contains",command:r,value:"CONTAINS",label:l.localize("CONTAINS")},{icon:"smart-icon-does-not-contain",command:r,value:"DOES_NOT_CONTAIN",label:l.localize("DOES_NOT_CONTAIN")},{icon:"smart-icon-starts-with",command:r,value:"STARTS_WITH",label:l.localize("STARTS_WITH")},{icon:"smart-icon-ends-with",command:r,value:"ENDS_WITH",label:l.localize("ENDS_WITH")},{icon:"smart-icon-equals",command:r,value:"EQUAL",label:l.localize("EQUAL")},{icon:"smart-icon-delete",command:r,value:"CLEAR_FILTER",label:l.localize("CLEAR_FILTER")}],l._filterInfo.numberAndDateConditions=[{icon:"smart-icon-equals",command:r,value:"EQUAL",label:l.localize("EQUAL")},{icon:"smart-icon-not-equal",command:r,value:"NOT_EQUAL",label:l.localize("NOT_EQUAL")},{icon:"smart-icon-less-than",command:r,value:"LESS_THAN",label:l.localize("LESS_THAN")},{icon:"smart-icon-less-than-equal",command:r,value:"LESS_THAN_OR_EQUAL",label:l.localize("LESS_THAN_OR_EQUAL")},{icon:"smart-icon-greater-than",command:r,value:"GREATER_THAN",label:l.localize("GREATER_THAN")},{icon:"smart-icon-greater-than-equal",command:r,value:"GREATER_THAN_OR_EQUAL",label:l.localize("GREATER_THAN_OR_EQUAL")},{icon:"smart-icon-between",command:r,value:"RANGE",label:l.localize("RANGE")},{icon:"smart-icon-delete",command:r,value:"CLEAR_FILTER",label:l.localize("CLEAR_FILTER")}]);const n=l._getFilterDataType(i);a="string"===n?l._filterInfo.stringConditions:l._filterInfo.numberAndDateConditions;let s="smart-icon-search";if(i._filterInfo||(i._filterInfo={condition:""}),i.filterEditor&&i.filterEditor.condition&&(i._filterInfo.condition=i.filterEditor.condition),i.filterEditor&&i.filterEditor.value&&(i._filterInfo.value=i.filterEditor.value),i._filterInfo.dataSource=a,null===i._filterInfo.condition||void 0===i._filterInfo.condition)i._filterInfo.condition="",s="smart-icon-search";else switch(i._filterInfo.condition.toLowerCase()){case"equal":s="smart-icon-equals";break;case"starts_with":s="smart-icon-starts-with";break;case"ends_with":s="smart-icon-ends-with";break;case"not_equal":s="smart-icon-not-equal";break;case"less_than":s="smart-icon-less-than";break;case"less_than_or_equal":s="smart-icon-less-than-or-equal";break;case"greater_than":s="smart-icon-greater-than";break;case"greater_than_or_equal":s="smart-icon-greater-than-or-equal";break;case"contains":s="smart-icon-contains";break;case"does_not_contain":s="smart-icon-does-not-contain";break;case"range":s="smart-icon-between";break;default:s="smart-icon-search"}let o=`<div class="smart-filter-input-type"><i class="smart-grid-icon ${s} show"></i></div> `;if("string"===n)o+=`<input class="smart-filter-input-value" data-type="${n}" /> `,e.innerHTML=o;else if("date"===i.dataType){const a=new Smart.Utilities.DateTime;o+=`<input placeholder = "${a.expandFormat(a.calendar,i.cellsFormat||"d")}" class="smart-filter-input-value" data-type="${i.dataType}"/><div class="smart-filter-input-type"><i class="smart-grid-icon smart-icon-calendar show"></i></div>`,e.innerHTML=o,e.lastElementChild.onpointerdown=function(){l._handleFilterCalendarCellClick(t.cell)}}else if("number"===i.dataType)o+='<div class="smart-grid-cell-editor smart-filter-input-value smart-grid-number-input-cell-editor"><input class="smart-input" type="number"><div tabindex="-1" class="nav"><div tabindex="-1" class="up"></div><div tabindex="-1" class="down"></div></div></div>',e.innerHTML=o,l._handleFilterNumberCellEditor(this.cell,e);else if("boolean"===i.dataType||"bool"===i.dataType){const a=document.createElement("div");a.classList.add("smart-input"),a.classList.add("smart-grid-check-box-cell-editor"),a.classList.add("smart-filter-input-value"),e.tabIndex=0,e.style.outline="none",t.setAttribute("template","checkBox"),a.setAttribute("checked","indeterminate"),i._filterInfo&&i._filterInfo.value?a.setAttribute("checked",""):i._filterInfo&&!1===i._filterInfo.value&&a.removeAttribute("checked"),o=a.outerHTML,e.innerHTML=o,e.classList.add("align-center"),e.classList.add("smart-label"),e.onfocus=()=>{e.setAttribute("focus","")},e.onblur=()=>{e.removeAttribute("focus","")},e.onclick=e=>{e.target.classList.contains("smart-input")&&l._handleFilterCellCheckBoxClick(this.cell)}}const d=e.querySelector("input");if(d&&(e.firstElementChild.onpointerdown=function(){l._handleFilterCellIconClick(this.cell)}.bind(this),d.onpaste=function(e){setTimeout((()=>{l._handleFilterCellKeyUp(this.cell,e)}))}.bind(this),d.onfocus=function(){l._handleFilterCellFocus(this.cell)}.bind(this),d.onblur=function(){l._handleFilterCellBlur(this.cell)}.bind(this),d.onkeyup=function(e){l._handleFilterCellKeyUp(this.cell,e)}.bind(this),d.onkeydown=function(e){l._handleFilterCellKeyDown(this.cell,e)}.bind(this)),e.classList.add("smart-filter-input-container"),i._filterInfo.input=d,i._filterInfo.cell=t.cell,i._filterInfo.editor=e,i._filterInfo.value&&d&&(d.value=i._filterInfo.value,"date"===i.dataType&&(d.value=t.cell.getFormattedValue(i._filterInfo.value,i.cellsFormat))),e.removeAttribute("disabled"),i.allowFilter||(d.disabled=!0,e.setAttribute("disabled","")),i.filterEditor)if(i.filterEditor.template){const t=i.filterEditor.template,l=document.createElement("div");i.filterTemplate instanceof HTMLTemplateElement?l.appendChild(t.content.cloneNode(!0)):t instanceof HTMLElement?l.appendChild(t):l.innerHTML=t,e.innerHTML="",e.appendChild(l),l.style.height="100%",l.style.width="100%";const a=e.querySelector("input");a&&(a.onfocus=()=>{e.setAttribute("focus","")},a.onblur=()=>{e.removeAttribute("focus","")}),i.filterEditor.onInit&&i.filterEditor.onInit(i,l)}else void 0!==i.filterEditor.min&&(d.min=i.filterEditor.min),void 0!==i.filterEditor.max&&(d.max=i.filterEditor.max),void 0!==i.filterEditor.minLength&&(d.minLength=i.filterEditor.minLength),void 0!==i.filterEditor.maxLength&&(d.maxLength=i.filterEditor.maxLength),void 0!==i.filterEditor.placeholder&&(d.placeholder=i.filterEditor.placeholder),void 0!==i.filterEditor.value&&(d.value=i.filterEditor.value),void 0!==i.filterEditor.step&&(d.step=i.filterEditor.step),void 0!==i.filterEditor.disabled&&(d.disabled=i.filterEditor.disabled),void 0!==i.filterEditor.condition&&(i._filterInfo.condition=i.filterEditor.condition),i.filterEditor.onInit&&i.filterEditor.onInit(i,e)}_setTemplate(t,l,i){const a=this,r=a.cell.grid,n=a.cell.column;r._cellCachedValues||(r._cellCachedValues=[]);const s=()=>!!r._cellCachedValues[n.dataField+"_"+t]&&(i.innerHTML!==r._cellCachedValues[n.dataField+"_"+t]&&(i.innerHTML=r._cellCachedValues[n.dataField+"_"+t]),a.cell._setStyle(i),a.setAttribute("template",a.cell.template),!0);let o=null;switch((!r.editing.enabled||!n.allowEdit||a.cell.readonly||"none"===r.editing.action||r.editing.enabled&&r.editing.commandColumn.visible&&r.editing.editRow!==a.cell.row)&&a.setAttribute("readonly",""),l){case"checkBox":case"radioButton":case"switchButton":if(i.firstElementChild&&i.firstElementChild.classList&&i.firstElementChild.classList.contains("smart-input")){if(o=i.firstElementChild,t?o.setAttribute("checked",""):null===t?o.setAttribute("checked","indeterminate"):o.removeAttribute("checked"),a.setAttribute("template",a.cell.template),o.removeAttribute("icon"),o.removeAttribute("color"),o.style.setProperty("--smart-check-template-color","var(--smart-primary)"),a.cell.column.templateSettings&&a.cell.column.templateSettings.icon){if("ok-squared"!==a.cell.column.templateSettings.icon)o.setAttribute("icon",a.cell.column.templateSettings.icon);else{const e=new Smart.Color(a.cell.column.templateSettings.color).getInvertedColor();o.style.setProperty("--smart-check-template-forecolor",e)}o.style.setProperty("--smart-check-template-color",a.cell.column.templateSettings.color),o.setAttribute("color","")}return void a.cell._setStyle(i)}if(o=document.createElement("span"),o.className="smart-input",t?o.setAttribute("checked",""):null===t?o.setAttribute("checked","indeterminate"):o.removeAttribute("checked"),a.setAttribute("template",a.cell.template),o.removeAttribute("icon"),o.removeAttribute("color"),o.style.setProperty("--smart-check-template-color","var(--smart-primary)"),a.cell.column.templateSettings&&a.cell.column.templateSettings.icon){if("ok-squared"!==a.cell.column.templateSettings.icon)o.setAttribute("icon",a.cell.column.templateSettings.icon);else{const e=new Smart.Color(a.cell.column.templateSettings.color).getInvertedColor();o.style.setProperty("--smart-check-template-forecolor",e)}o.setAttribute("color",""),o.style.setProperty("--smart-check-template-color",a.cell.column.templateSettings.color)}i.innerHTML="",i.appendChild(o),a.cell._setStyle(i);break;case"checklist":if(t&&t.indexOf("[")>=0&&(t=JSON.parse(t)),i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const e=i.firstElementChild.getAttribute("value");if(t&&e===t.length)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(t&&Array.isArray(t)&&t.length>0){const e=t.filter((e=>e.completed)).length,l=["#D50000","#F4511E","#F6BF26","#33B679"],i=e+"/"+t.length;let a=l[0];e===t.length?a=l[3]:e>0&&e<t.length&&(a=l[2]),t=`<div style="display: grid; grid-template-columns: 25px auto"><div style="margin-left: 4px; align-self: center; border-radius: 50%; display: flex; align-content: center; background: ${a}; width:16px; height: 16px;"><span title="${i}" style="align-content: center; font-size: 13px; color: white;" class="smart-grid-icon show smart-icon-check"></span></div>${i}</span></div>`}else t="";o=document.createElement("span"),o.innerHTML=t,a.setAttribute("template",a.cell.template),o.setAttribute("value",t.length);break;case"createdBy":case"updatedBy":{const e=a.cell.row;let t=null,s=null;if(t="createdBy"===l?e.createdBy:e.updatedBy,e.history&&e.history.length&&(t="createdBy"===l?e.history[0].user:e.history[e.history.length-1].user),i.firstElementChild&&i.firstElementChild.hasAttribute("user-id")){if(t===parseInt(i.firstElementChild.getAttribute("user-id")))return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template);if(null!=t&&-1!==t){s=r.users.find((e=>e.id===t));const e=s;if(e){const l=i.firstElementChild.firstElementChild&&i.firstElementChild.firstElementChild.firstElementChild?i.firstElementChild.firstElementChild.firstElementChild.firstElementChild:null;if(l){i.firstElementChild.setAttribute("user-id",t);const a="string"==typeof e?e:e.name,r="string"==typeof e?null:e.color;if(("string"==typeof e?null:e.image)&&(l.firstElementChild.style.backgroundImage=`url('${e.image}')`),r){const e=new Smart.Color(r).getInvertedColor();l.setAttribute("data-item",a),l.setAttribute("title",a),l.setAttribute("backgroundColor",r),l.setAttribute("color",e),l.lastElementChild.textContent=a}else l.setAttribute("data-item",a),l.setAttribute("title",a),l.setAttribute("backgroundColor",""),l.setAttribute("color","");return}}}}const d=document.createElement("div");d.classList.add("smart-multi-combo-input"),d.setAttribute("data-field",n.dataField),d.setAttribute("row-id",a.cell.row.id),d.style.width="100%",d.style.paddingRight="6px";let c='<div class="smart-flex smart-flex-auto smart-tokens-layout">';if(null!=t&&-1!==t){s=r.users.find((e=>e.id===t));const e=s;if(e){const t="string"==typeof e?e:e.name,l="string"==typeof e?null:e.color,i="string"==typeof e?null:e.image,a=document.createElement("span");if(i&&(a.style.backgroundImage=`url('${e.image}')`,a.className="smart-drop-down-list-selection-image"),l){c+='<span title="'+t+'" data-item="'+t+'" style="background: '+l+"; color: "+new Smart.Color(l).getInvertedColor()+'; overflow: visible;" class="smart-truncate smart-token">'+a.outerHTML+"<span class='smart-drop-down-list-selection-label' role=\"presentation\">"+t+"</span></span>"}else c+='<span title="'+t+'" data-item="'+t+'" class="smart-truncate smart-token">'+a.outerHTML+"<span class='smart-drop-down-list-selection-label' role=\"presentation\">"+t+"</span></span>"}else c=""}d.innerHTML=c+"</div>";const m=document.createElement("div");m.classList.add("smart-multi-combo-input-container","tokens","smart-flex","smart-flex-auto"),d.classList.add("smart-flex-auto"),m.appendChild(d),o=m,o.setAttribute("user-id",t),a.setAttribute("template",a.cell.template);break}case"collaborator":case"tags":{let e=[];"number"==typeof t&&(t=""+t);let d=!1===r.editing.enabled?"smart-visibility-hidden":"";!0!==r.editing.enabled||a.cell.column.allowEdit||(d="smart-visibility-hidden");let c=n.editor.dataSource&&n.editor.dataSource.length;if(n.editor.collaborator&&(c=r.users&&r.users.length),c||(d="smart-visibility-hidden"),""===t||null===t||"uncategorized"===t){let e=`\n                        <div class="smart-multi-combo-input-container tokens smart-flex smart-flex-auto" data-field="${n.dataField}" row-id="${a.cell.row.id}"> \n                                <div class="smart-multi-combo-input" data-field="${n.dataField}" row-id="${a.cell.row.id}" class="tokens smart-flex smart-flex-auto">\n                                     <div class=" smart-flex-auto smart-flex"></div>\n                                </div>\n                                 <span class="smart-arrow-down arrowbtn ${d}"></span>\n                        </div>\n                        `;i.innerHTML!==e&&(i.firstElementChild&&i.firstElementChild.firstElementChild&&i.firstElementChild.firstElementChild.firstElementChild&&""===i.firstElementChild.firstElementChild.firstElementChild.textContent?(i.firstElementChild.setAttribute("row-id",a.cell.row.id),i.firstElementChild.firstElementChild.setAttribute("row-id",a.cell.row.id)):i.innerHTML=e);const t=i.querySelector(".smart-arrow-down");return t&&(t.onpointerdown=e=>{if(r.editing.enabled&&a.cell.column.allowEdit){const t=e.target.previousElementSibling,l=t.getAttribute("data-field"),i=t.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l)}e.stopPropagation(),e.preventDefault()}),a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(s()){const e=i.querySelector(".smart-arrow-down");if(e){const t=n.editor.dots;if(i.firstElementChild&&i.firstElementChild.firstElementChild&&i.firstElementChild.firstElementChild.firstElementChild&&(i.firstElementChild.firstElementChild.firstElementChild.classList.remove("smart-flex-wrap"),i.firstElementChild.firstElementChild.firstElementChild.firstElementChild)){const e=i.firstElementChild.firstElementChild.firstElementChild.firstElementChild.firstElementChild;t?e.classList.add("dots"):e.classList.remove("dots")}e.onpointerdown=e=>{if(r.editing.enabled&&a.cell.column.allowEdit){const t=e.target.previousElementSibling,l=t.getAttribute("data-field"),i=t.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l)}e.stopPropagation(),e.preventDefault()}}return}if(null!==t&&(e=Array.isArray(t)?e.map((e=>e.trim())):t.indexOf("{")>=0||"[]"===t?JSON.parse(t):t.split(",").map((e=>e.trim()))),i.firstElementChild&&i.firstElementChild.hasAttribute("value")&&n.editor._items){if(i.firstElementChild.getAttribute("value")===t){a.cell._setStyle(i),a.setAttribute("template",a.cell.template);const e=n.editor.dots;if(i.firstElementChild&&i.firstElementChild.firstElementChild&&i.firstElementChild.firstElementChild.firstElementChild){if(i.firstElementChild.firstElementChild.firstElementChild.classList.remove("smart-flex-wrap"),i.firstElementChild.firstElementChild.firstElementChild.firstElementChild){const t=i.firstElementChild.firstElementChild.firstElementChild.firstElementChild.firstElementChild;e?t.classList.add("dots"):t.classList.remove("dots")}if(a.cell.row.height>45){i.firstElementChild.firstElementChild.firstElementChild.classList.add("smart-flex-wrap");const e=i.firstElementChild.firstElementChild.firstElementChild;if(e.children&&e.children.length>1)for(let t=0;t<e.children.length;t++)e.children[t].style.maxWidth&&(e.children[t].style.maxWidth="")}else if(r.layout.rowHeight<=45&&a.cell.row.height<=45){const e=i.firstElementChild.firstElementChild.firstElementChild;if(e.children&&e.children.length>1){const t=parseInt(n.computedWidth/e.children.length)-5;let l=0;for(let t=0;t<e.children.length;t++)l+=e.children[t].textContent.length,e.children[t].style.maxWidth="";if(14*l*.52+20*e.children.length>n.computedWidth)for(let l=0;l<e.children.length;l++)e.children[l].style.maxWidth=t+"px"}}}return}}const m=document.createElement("div");m.classList.add("smart-multi-combo-input"),m.setAttribute("data-field",n.dataField),m.setAttribute("row-id",a.cell.row.id);let u='<div class="smart-tokens-layout smart-flex smart-flex-auto">';if(e.length>2&&a.cell.row.height>45){u='<div style="max-width: '+(n.computedWidth-10+"px")+'" class="smart-flex smart-flex-wrap">'}let p=0;if(t)for(let t=0;t<e.length;t++){const i=e[t];let a=null;if("collaborator"===l||n.editor&&n.editor.collaborator)a=r.users.find((e=>{if("string"==typeof i||"number"==typeof i){if(e.value===i||parseInt(e.value)===parseInt(i))return e;if(e.id===i||parseInt(e.id)===parseInt(i))return e}else if("object"==typeof i&&e.value===i.value)return e})),a&&(a.label=a.name);else if(n.editor.dataSource)if("string"==typeof i&&n.editor._items&&n.editor._items[i])a=n.editor._items[i];else{for(let e=0;e<n.editor.dataSource.length;e++){const t=n.editor.dataSource[e];if(void 0!==t.value&&void 0!==i&&void 0!==i.value&&t.value===i.value){a=t,n.editor._items||(n.editor._items=[]),n.editor._items[i]=t;break}if(void 0===t.value&&t===i||void 0!==t.value&&""+t.value===i){a=t,n.editor._items||(n.editor._items=[]),n.editor._items[i]=t;break}}n.editor.allowItemsAdd&&!a&&i&&(a=i)}else a=i;if(!a)continue;const s="string"==typeof a?a:a.label,o="string"==typeof a?null:a.color,d="string"==typeof a?null:a.image;if(""===s)continue;const c=document.createElement("span");d&&(c.style.backgroundImage=`url('${a.image}')`,c.className="smart-drop-down-list-selection-image");const m="smart-truncate";if(o&&n.editor.colorItems){const e=new Smart.Color(o).getInvertedColor(),t=n.editor.dots?" dots":"";u+='<span title="'+s+'" data-item="'+s+'" style="background: '+o+"; color: "+e+"; --smart-primary-color: "+e+'; overflow: visible;" class="'+m+' smart-token">'+c.outerHTML+"<span class='smart-drop-down-list-selection-label"+t+'\' role="presentation">'+s+"</span>"}else u+='<span title="'+s+'" data-item="'+s+'" class="'+m+' smart-token">'+c.outerHTML+"<span class='smart-drop-down-list-selection-label' role=\"presentation\">"+s+"</span>";if(p+=s.length,n.editor.dataSource){if(n.editor.singleSelect){u+="</span>";break}u+='<span class=\'smart-hidden smart-drop-down-list-unselect-button\' role="button" aria-label="Unselect"></span></span>'}else u+="</span>"}m.innerHTML=u+"</div>";const g=14*p*.52,f=m.firstElementChild;if(r.layout.rowHeight<=45&&a.cell.row.height<=45&&m&&f.children.length>1&&g+20*f.children.length>n.computedWidth){const e=parseInt(n.computedWidth/f.children.length)-5;for(let t=0;t<f.children.length;t++)f.children[t].style.maxWidth=e+"px"}if(m.style.width="100%",a.onmouseenter=()=>{!0===a.cell.column.allowEdit&&!0===r.editing.enabled&&(m.style.width="calc(100% - 25px)")},a.onmouseleave=()=>{m.style.width="100%"},m.style.paddingRight="6px",m.onpointerdown=t=>{if(!r._mobile)if(t.target&&"#text"!==t.target.nodeName&&t.target.classList.contains("smart-drop-down-list-unselect-button")){let l=t.target.parentNode.getAttribute("data-item");if(n.editor.dataSource&&"string"==typeof l&&n.editor.dataSource)for(let e=0;e<n.editor.dataSource.length;e++)n.editor.dataSource[e].label===l&&(l=n.editor.dataSource[e],l.value&&(l=l.value));if(e[0]&&e[0].label){const i=e.map((e=>e.value)).indexOf(l);if(i>=0){e.splice(i,1);const l=a.cell.value,s=e.join(", ");r.setCellValue(a.cell.row.id,n.dataField,JSON.stringify(e)),r.onCellUpdate&&r.onCellUpdate([a.cell],[l],[s],(function(){}),a),t.preventDefault(),t.stopPropagation()}}else if(e.indexOf(l)>=0){e.splice(e.indexOf(l),1);const i=a.cell.value,s=e.join(", ");r.setCellValue(a.cell.row.id,n.dataField,s),r.onCellUpdate&&r.onCellUpdate([a.cell],[i],[s],(function(){}),a),t.preventDefault(),t.stopPropagation()}}else if(t.target.classList.contains("smart-drop-down-list-selection-label")){if(r.editing.enabled&&r.editing.allowListOpenOnContentClick){const e=t.target.closest(".smart-multi-combo-input"),l=e.getAttribute("data-field"),i=e.getAttribute("row-id");r.beginEdit(i,l)}t.stopPropagation(),t.preventDefault()}},!n.cellsWrap&&n.allowEdit&&r.editing.enabled&&"card"!==r.view){const t=document.createElement("span");t.classList.add("smart-arrow-down","arrowbtn");let l=n.editor.dataSource&&n.editor.dataSource.length;n.editor.collaborator&&(l=r.users&&r.users.length),l||t.classList.add("smart-visibility-hidden");const i=document.createElement("div");i.classList.add("smart-multi-combo-input-container","tokens","smart-flex","smart-flex-auto"),m.classList.add("smart-flex-auto"),m.classList.remove("smart-flex-wrap"),e.length>2&&r.layout.rowHeight>45&&(m.classList.add("smart-flex-wrap"),m.style.maxWidth=n.computedWidth-10+"px"),r.rightToLeft&&(m.style.direction="rtl"),i.appendChild(m),"input"!==n.editor.template&&i.appendChild(t),o=i,t.onpointerdown=e=>{if(!r._mobile){if(r.editing.enabled){const t=e.target.previousElementSibling,l=t.getAttribute("data-field"),i=t.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l)}e.stopPropagation(),e.preventDefault()}}}else if(n.cellsWrap||n.allowEdit){const t=document.createElement("div");t.classList.add("smart-multi-combo-input-container","tokens","smart-flex","smart-flex-auto"),m.classList.add("smart-flex-auto"),m.classList.remove("smart-flex-wrap"),e.length>2&&r.layout.rowHeight>45&&(m.classList.add("smart-flex-wrap"),m.style.maxWidth=n.computedWidth-10+"px"),r.rightToLeft&&(m.style.direction="rtl"),t.appendChild(m),o=t}else m.classList.add("smart-flex-auto","smart-flex","tokens"),o=m;a.setAttribute("template",a.cell.template),o.setAttribute("value",t);break}case"dropdownGrid":case"dropDownList":case"dropdownlist":case"list":{const e=document.createElement("div");if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){if(i.firstElementChild.getAttribute("value")===t&&!a.cell.column._isDirty)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if("dropdownGrid"!==a.cell.template){if(s()){const e=i.querySelector(".smart-arrow-down");return void(e&&(e.onpointerdown=e=>{if(!r._mobile){if(r.editing.enabled){const t=e.target.closest("smart-grid-cell"),l=e.target.closest("smart-grid-row"),i=t.getAttribute("data-field"),n=l.getAttribute("data-id");if(r.beginEdit(n,i),a.cell.column.editor&&a.cell.column.editor.instance){const e=a.cell.column.editor,t=e.instance.element;!e.autoOpen&&t.open?t.open():!e.autoOpen&&t.firstElementChild&&t.firstElementChild.open&&setTimeout((()=>{t.firstElementChild.open()}),250)}}e.stopPropagation(),e.preventDefault()}}))}}if("dropdownGrid"===a.cell.template){const l=a.cell.column.templateSettings.dataFields;let i=a.cell.editor.dataSource?a.cell.editor.dataSource[t]:"";if(a.cell.column.relationId&&a.cell.column.relationField&&a.cell.column._isDirty&&(!a.cell.column.editor.dataSource||a.cell.column.editor.dataSource&&0===a.cell.column.editor.dataSource.length)){const e=r._getRelationData(a.cell.column.relationId,a.cell.column.relationField,a.cell.column.relationCascadingFields),l=r._getRelationColumns(a.cell.column.relationId);e&&(i=e[t]),a.cell.column.editor.columns=l,a.cell.column.editor.dataSource=e}if(e.classList.add("smart-flex","center"),e.style.alignItems="center",e.onmouseenter=()=>{e.querySelectorAll("i").forEach((e=>e.classList.add("show")))},e.onmouseleave=()=>{e.querySelectorAll("i").forEach((e=>e.classList.remove("show")))},i){e.style.justifyContent="space-between";let t="";for(let e=0;e<l.length;e++){const a=i[l[e]];a&&(t+='<span style="" class="smart-truncate smart-token smart-flex middle center ">'+a+"</span>")}e.innerHTML=t}else e.style.justifyContent="",e.innerHTML='<span class="smart-truncate"></span>'}else"card"===r.view?e.textContent=t:e.innerHTML='<span class="smart-truncate">'+t+"</span>";if(n.allowEdit&&r.editing.enabled&&"card"!==r.view){const t=document.createElement("span");t.classList.add("smart-arrow-down","arrowbtn");const l=document.createElement("div");l.classList.add("smart-multi-combo-input-container","tokens","smart-flex","smart-flex-auto"),e.classList.add("smart-flex-auto","smart-multi-combo-input"),l.appendChild(e),l.appendChild(t),l.classList.add(a.cell.template.toLowerCase()),o=l,t.onpointerdown=e=>{if(!r._mobile){if(r.editing.enabled){const t=e.target.closest("smart-grid-cell"),l=e.target.closest("smart-grid-row"),i=t.getAttribute("data-field"),n=l.getAttribute("data-id");if(r.beginEdit(n,i),a.cell.column.editor&&a.cell.column.editor.instance){const e=a.cell.column.editor,t=e.instance.element;!e.autoOpen&&t.open?t.open():!e.autoOpen&&t.firstElementChild&&t.firstElementChild.open&&setTimeout((()=>{t.firstElementChild.open()}),250)}}e.stopPropagation(),e.preventDefault()}}}else o=e;a.setAttribute("template",a.cell.template.toLowerCase()),o.setAttribute("value",t);break}case"password":i.innerHTML=t?'<span class="smart-truncate">'+t.replace(/./g,"*")+"</span>":"",a.setAttribute("template",a.cell.template);break;case"richText":if(i.innerHTML=t?'<div class="textwrap" style="height: 100%; padding-top: 5px; padding-left: 5px;">'+r._unescapeString(t)+"</div>":"",r.layout.autoWrap&&a.cell.row.height>40&&1===a.cell.colSpan&&"string"===n.dataType){null==t&&(t="");if(14*t.length*.52>n.computedWidth){const e=parseInt(a.cell.row.height/20);i.firstElementChild.style["-webkit-line-clamp"]=e}}i.onpointerdown=e=>{if(!r._mobile&&r.editing.enabled){const t=r.offset(i);if(e.pageX>t.left+i.offsetWidth-20){const t=e.target.closest("smart-grid-cell"),l=e.target.closest("smart-grid-row"),i=t.getAttribute("data-field"),a=l.getAttribute("data-id");delete r._beginEditKey,r.beginEdit(a,i)}}},a.setAttribute("template",a.cell.template);break;case"color":i.innerHTML=`<span style="left: calc(50% - 12px); top: calc(50% - 12px); position: absolute; border-radius: 50%; width: 24px; height: 24px; display: block; background:${t};"></span>`,a.setAttribute("template",a.cell.template);break;case"autoNumber":o=document.createElement("span"),o.innerHTML=1+a.cell.row.visibleIndex,a.setAttribute("template",a.cell.template);break;case"uuid":{if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const e=i.firstElementChild.getAttribute("value");if(t===e)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}o=document.createElement("span"),o.style.paddingLeft="7px";const e=r._generateUUID(),l=a.cell.canNotify;a.cell.canNotify=!1,t||(a.cell.value=e,r.onCellUpdate&&!r.editing.editRow&&r.onCellUpdate([a.cell],[e],[e],(function(){r.onCellUpdated&&r.onCellUpdated([a.cell.row.index],[a.cell.row],[a.cell.column],[a.cell.row.data],[a.cell.value],[a.cell.value],a)}),a)),o.textContent=a.cell.value,a.cell.canNotify=l,a.setAttribute("template",a.cell.template),o.setAttribute("value",e);break}case"ai":{if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const e=i.firstElementChild.getAttribute("value");if(t===e)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}const e=(e,t)=>{const l=r.ai.url,i=r.ai.key;e.stopPropagation(),e.preventDefault();const a=e.target.closest("smart-grid-cell"),n=e.target.closest("smart-grid-row"),s=a.getAttribute("data-field"),d=n.getAttribute("data-id");t?(e.target.classList.remove("smart-icon-reload"),e.target.classList.add("smart-grid-loading")):e.target.classList.add("smart-grid-loading");let c=""+r.columnByDataField[s].AIQuery;r.columnByDataField[c]&&(c=""+r.getCellValue(d,c)),c&&l&&i?async function(e){const t=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:r.ai.model,messages:[{role:"user",content:e}],max_tokens:r.ai.maxTokens,temperature:r.ai.temperature})});if(!t.ok)throw new Error(`Error: ${t.statusText}`);return(await t.json()).choices[0].message.content.trim()}(c).then((e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;");r.setCellValue(d,s,t),o.setAttribute("value",t)})).catch((e=>{console.error("Error:",e)})):(r.setCellValue(d,s,r.localize("noResults")),o.setAttribute("value",r.localize("noResults")))};if(t){o=document.createElement("span"),o.style.paddingLeft="7px";const l=a.cell.canNotify;a.cell.canNotify=!1,o.textContent=a.cell.value,a.cell.canNotify=l;const i=document.createElement("span");o.appendChild(i),i.classList.add("smart-grid-icon","show","smart-icon-reload","smart-visibility-hidden"),i.style.position="absolute",i.style.right=i.style.top="0px",o.onmouseenter=()=>{i.classList.remove("smart-visibility-hidden")},o.onmouseleave=()=>{i.classList.add("smart-visibility-hidden")},i.onpointerdown=t=>{e(t,!0)},a.setAttribute("template",a.cell.template),o.setAttribute("value",t)}else o=document.createElement("div"),o.classList.add("smart-flex","center","middle"),o.style.height="100%",o.innerHTML=`<button style="line-height: 13px; height: 24px; padding-inline: 24px; padding-block: 2px;" class="smart-button" type="button">${r.localize("generate")}</button\n                `,o.onpointerdown=t=>{e(t)},a.setAttribute("template",a.cell.template);break}case"createdDate":case"createdTime":{const e=a.cell.row;let t=e.createdDate;if(s())return;e.history&&e.history[0]&&(t=e.history[0].date);const l=a.cell.getFormattedValue(t,"d"),r=a.cell.getFormattedValue(t,"t");if(i.firstElementChild&&i.firstElementChild.hasAttribute("created-date")){const e=l+"  "+r;e!==i.firstElementChild.textContent&&(i.firstElementChild.textContent=e)}else i.innerHTML='<span created-date class="align-left smart-truncate">'+l+"  "+r+"</span>";a.cell._setStyle(i),a.setAttribute("template",a.cell.template);break}case"updatedDate":case"updatedTime":if(s())return;if(a.cell.row.updatedDate){const e=a.cell.row;let t=e.updatedDate;e.history&&(t=e.history[e.history.length-1].date);const l=a.cell.getFormattedValue(t,"d"),r=a.cell.getFormattedValue(t,"t");if(i.firstElementChild&&i.firstElementChild.hasAttribute("updated-date")){const e=l+"  "+r;e!==i.firstElementChild.textContent&&(i.firstElementChild.textContent=e)}else i.innerHTML='<span updated-date class="align-left smart-truncate">'+l+"  "+r+"</span>"}else i.innerHTML="";a.cell._setStyle(i),a.setAttribute("template",a.cell.template);break;case"progress":{const e=t?parseInt(100*t)+"%":"0%";if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){if(e===i.firstElementChild.getAttribute("value"))return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}const l="white",r=["#D50000","#F4511E","#F6BF26","#33B679"];let n=r[0];n=t<.25?r[0]:t<.5?r[1]:t<.75?r[2]:r[3],i.innerHTML='<div value="'+e+'" style="padding-left: 5px; padding-right: 5px; display: grid; grid-template-columns: 1fr auto"><div style="height: 100%; display: flex; align-items: center; width: '+e+';"><div title="'+e+'" style="width: 100%; height: 4px; background: '+n+"; color: "+l+';" class="smart-truncate smart-token"></div></div><span>'+e+"</span></div>",a.setAttribute("template",a.cell.template);break}case"rating":{const e=a.cell.column.editor.max?a.cell.column.editor.max:5,l=t?parseInt(t):0;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){if(l===parseInt(i.firstElementChild.getAttribute("value")))return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template);i.firstElementChild.setAttribute("value",l);for(let t=0;t<e;t++){const e=i.firstElementChild.children[t];let a="";l>0&&l>t&&(a="value"),a?e.classList.add("value"):e.classList.remove("value")}return void a.setAttribute("template",a.cell.template)}const n=t=>{let l="";for(let i=0;i<e;i++){let e="";t>0&&t>i&&(e="value"),l+=`<div rating-value title="${i+1}" value="${i+1}" class="smart-grid-icon show smart-icon-star ${e}"></div>`}return l};i.innerHTML=`<div value="${l}" class="rating">${n(l)}</div>`;const s=e=>{if(!r._mobile&&e.hasAttribute("rating-value")){const t=e.getAttribute("value"),l=e.closest("smart-grid-cell"),i=e.closest("smart-grid-row");if(l&&i){const e=l.querySelector(".rating"),s=i.getAttribute("data-id"),o=l.getAttribute("data-field"),d=r.rowById[s],c=r.getCellValue(s,o),m=l.cell;let u=null;r.storeHistory&&(u=r._stringifyRow(d)),c===t?(i.row.data[o]=0,e.innerHTML=n(0),e.setAttribute("value",0)):(i.row.data[o]=parseInt(t),e.innerHTML=n(parseInt(t)),e.setAttribute("value",t));const p=i.row.data[o];r._setCellUndoRedo(m,c,p),r.onCellUpdate&&r.onCellUpdate([m],[c],[p],(function(e){r.onCellUpdated&&r.onCellUpdated([m.row.index],[m.row],[m.column],[m.row.data],[c],[p],a),r._onCellUpdated&&r._onCellUpdated(m.row.index,m.row,m.column,m.row.data,c,p)}),a);const g=e=>{if(e!==c&&(d.updatedDate=new Date,d.updatedBy=a.currentUser,r.storeHistory)){const t=r._stringifyRow(d);t[m.column.dataField]=e,r._updateRowHistory(d,u,t)}};if(r.onCellUpdate&&r.onRowHistory){const e=r.onRowHistory;r.onRowHistory=null,g(p),setTimeout((()=>{r.onRowHistory=e}),100)}else g(p);const f=l.querySelector(".rating"),h=parseInt(t)-1;f.children[h].classList.add("down"),setTimeout((()=>{f.children[h].classList.remove("down")}),1e3)}}},o=(e,t=!0)=>{if(e&&[...e.querySelectorAll(".smart-icon-star")].forEach((e=>{e.classList.remove("hover")})),e.hasAttribute("value")){const l=[...e.parentElement.children],i=l.indexOf(e);l.forEach(((e,l)=>{e.classList.remove("hover"),l<=i&&t&&e.classList.add("hover")}))}};r.handleRatingClick||(r._handleRatingMove=o,r._handleRatingClick=s),i.firstElementChild.onpointerdown=e=>{s(e.target)},i.firstElementChild.onpointermove=e=>{o(e.target)},i.firstElementChild.onpointerleave=e=>{o(e.target)},a.setAttribute("template",a.cell.template);break}case"vote":{let e=t;const l=(e,t)=>{const l=e.firstElementChild.firstElementChild,i=r.users?r.users.length:1,a=t.length*(100/i)+"%",n=t.length>0?"voted":"",s=l.firstElementChild,o=s.children[0];l.children[1].children[0].classList.remove("smart-votes-bar-animate"),r.isScrolling||l.children[1].children[0].classList.add("smart-votes-bar-animate");const d=l.children[1].firstElementChild.children[0],c=l.children[2];s.classList.remove("voted"),o.classList.remove("smart-icon-check"),n&&(o.classList.add("smart-icon-check"),s.classList.add("voted")),c.textContent=t.length,d.style.width=a,e.firstElementChild.setAttribute("value",t)};if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const t=i.firstElementChild.getAttribute("value"),r=i.firstElementChild;return r.removeAttribute("color"),r.style.setProperty("--smart-check-template-color","var(--smart-primary)"),r.style.setProperty("--smart-check-template-forecolor","#ffffff"),a.cell.column.templateSettings&&a.cell.column.templateSettings.color&&(r.style.setProperty("--smart-check-template-color",a.cell.column.templateSettings.color),r.setAttribute("color","")),e=e?e.split():[],l(i,e),e===t?(a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)):(i.firstElementChild.setAttribute("value",e),void a.setAttribute("template",a.cell.template))}const n=e=>{e&&!Array.isArray(e)&&(e=e?e.split():[]);const t=r.users?r.users.length:1,l=e.length*(100/t)+"%;";return`<div vote-value class="smart-flex middle center smart-votes-cell-component">\n                    <div class="smart-flex middle center smart-vote-button ${e.length>0?"voted":""}">\n                    <span class="smart-icon smart-grid-icon show ${e.length>0?"smart-icon-check":""}"></span>\n                    </div>\n                    <div class="smart-votes-bar-container">\n                        <div class="smart-votes-bar-component">\n                            <div class="smart-votes-bar" style="width: ${l} opacity: 1;"></div>\n                            <div class="smart-votes-bar-frame" style="width: 100%;  opacity: 0.2;"></div>\n                        </div>\n                    </div>\n                    <div class="smart-voters-info">${e.length}</div>\n                    </div>`};i.innerHTML=`<div value="${e}" class="vote">${n(e)}</div>`,a.cell.column.templateSettings&&a.cell.column.templateSettings.color&&(o=i.firstElementChild,o.style.setProperty("--smart-check-template-forecolor","#ffffff"),o.setAttribute("color",""),o.style.setProperty("--smart-check-template-color",a.cell.column.templateSettings.color));const s=(e,t,i)=>{if(r._mobile)return;const n=e.closest("smart-grid-cell"),s=e.closest("smart-grid-row"),o=(e,t)=>{const i=r.rowById[e],o=r.getCellValue(e,t),d=n.cell;let c=null;r.storeHistory&&(c=r._stringifyRow(i));const m=o?o.split(","):[],u=r._currentUser?""+r._currentUser.info.id:null;if(void 0===u)return;m.indexOf(u)>=0?(m.splice(m.indexOf(u),1),s.row.data[t]=m.toString(),l(n.firstElementChild,m)):(m.push(u),s.row.data[t]=m.toString(),l(n.firstElementChild,m));const p=s.row.data[t];r._setCellUndoRedo(d,o,p),r.onCellUpdate&&r.onCellUpdate([d],[o],[p],(function(){r.onCellUpdated&&r.onCellUpdated([d.row.index],[d.row],[d.column],[d.row.data],[o],[p],a),r._onCellUpdated&&r._onCellUpdated(d.row.index,d.row,d.column,d.row.data,o,p)}),a);const g=e=>{if(e!==o&&(i.updatedDate=new Date,i.updatedBy=a.currentUser,r.storeHistory)){const t=r._stringifyRow(i);t[d.column.dataField]=e,r._updateRowHistory(i,c,t)}};if(r.onCellUpdate&&r.onRowHistory){const e=r.onRowHistory;r.onRowHistory=null,g(p),setTimeout((()=>{r.onRowHistory=e}),100)}else g(p)};if(n&&s){o(s.getAttribute("data-id"),n.getAttribute("data-field"))}else null!==t&&null!==i&&o(t,i)};r._handleVoteClick||(r._handleVoteClick=s),i.firstElementChild.onpointerdown=e=>{s(e.target)},i.firstElementChild.onpointerenter=e=>{const t=e.target.closest("smart-grid-cell"),l=e.target.closest("smart-grid-row");if(t&&l){const n=l.getAttribute("data-id"),s=t.getAttribute("data-field");let o=r.getCellValue(n,s);if(o){if(r.users){let e="";o=o.split(),r.users.forEach((t=>{(o.indexOf(""+t.id)>=0||o.indexOf(""+t.value)>=0)&&(e+=t.name||t.label)})),e&&(o=r.localize("votes",{value:e}))}}else o=r.localize("noVotes");a._createTooltip(e,o,i,"top")}},i.firstElementChild.onpointerleave=()=>{r._cellTooltip&&(r._cellTooltip.style.visibility="hidden")},a.setAttribute("template",a.cell.template);break}case"duration":{const e=t;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){if(e===i.firstElementChild.getAttribute("value"))return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(t){const e=864e5;let l="MMM dd",n="MMM dd";if("string"==typeof t[0]&&(Array.isArray(t)?(t[0]=new Date(t[0]),t[1]=new Date(t[1])):((t=t.split(","))[0]=new Date(t[0]),t[1]=new Date(t[1]))),Array.isArray(t)){t[0]&&"string"==typeof t[0]&&(t[0]=new Date(t[0])),t[1]&&"string"==typeof t[1]&&(t[1]=new Date(t[1])),t[1]&&t[1].getMonth()===t[0].getMonth()&&(n="dd"),t[0]&&t[0].getFullYear()!==(new Date).getFullYear()&&(l+=", yyyy","dd"===n?(l="MMM dd",n+=", yyyy"):n=l);let s=!1;t[0]&&(0===t[0].getHours()&&0===t[0].getHours()||(l+=" hh:mm","dd"===n?n=l:n+=" hh:mm",s=!0));let o=null;o=Math.round(t[1].getTime()-t[0].getTime())/e;const d=o?parseInt(Math.abs(o).toFixed(0)):0;if(d>0){const e=a.cell.getFormattedValue(t[0],l)+" - "+a.cell.getFormattedValue(t[1],n);let s="";s=r.localize("days",{value:d}),i.innerHTML=`<div style="display: grid; grid-template-columns: 5px auto 25px"><span></span><span>${e}</span><span style="font-size: 11px;" class="smart-quiet">${s}</span></div>`}else{let e="";if(s){const r=t[1]-t[0],n=Math.floor(r%864e5/36e5);let s=Math.round(r%864e5%36e5/6e4);s<10&&(s+="0"+s),e=n+":"+s;const o=a.cell.getFormattedValue(t[0],l)+" - "+a.cell.getFormattedValue(t[1],"hh:mm");i.innerHTML=`<div style="display: grid; grid-template-columns: 5px auto 25px"><span></span><span>${o}</span><span style="font-size: 11px;" class="smart-quiet">${e}</span></div>`}else{const r=a.cell.getFormattedValue(t[0],l);i.innerHTML=`<div style="display: grid; grid-template-columns: 5px auto 25px"><span></span><span>${r}</span><span style="font-size: 11px;" class="smart-quiet">${e}</span></div>`}}}}else i.innerHTML="";a.setAttribute("template",a.cell.template),i.firstElementChild&&i.firstElementChild.setAttribute("value",e);break}case"startDate":{const e=t;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){if(e===i.firstElementChild.getAttribute("value"))return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(s())return;let l=t;if(n.cellsFormat?l=a.cell.getFormattedValue(t,n.cellsFormat):n.formatSettings&&n.formatSettings.Intl&&(l=a.cell.getFormattedValue(t,n.formatSettings.Intl)),t){const e=864e5,s="string"==typeof t?new Date(t):t;let o=r.columnByDataField.taskDueDate;n.editor.boundDateField&&(o=r.columnByDataField[n.editor.boundDateField]);let d=o?a.cell.row.data[o.dataField]:"";d&&"string"==typeof d&&(d=new Date(d));let c=null;d&&(c=Math.round(s.getTime()-d.getTime())/e);const m=c?parseInt(Math.abs(c).toFixed(0)):0;if(m>0){let e="";e=r.localize("days",{value:m}),i.innerHTML=`<div style="display: grid; grid-template-columns: 25px auto 25px"><span style="color: var(--smart-primary);" title="${e}" class="smart-icon-clock smart-grid-icon show"></span><span>${l}</span><span style="font-size: 11px;" class="smart-quiet">${e}</span></div>`}else i.innerHTML='<div style="padding-left: 6px;">'+l+"</div>"}else i.innerHTML="";a.setAttribute("template",a.cell.template),a.setAttribute("value",e);break}case"dueDate":{const e=t;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){if(e===i.firstElementChild.getAttribute("value"))return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(s())return;const l=["#D50000","#F4511E","#F6BF26","#33B679"],o=new Date;o.setHours(0,0,0);let d=t;n.cellsFormat?d=a.cell.getFormattedValue(t,n.cellsFormat):n.formatSettings&&n.formatSettings.Intl&&(d=a.cell.getFormattedValue(t,n.formatSettings.Intl));const c=(e,t)=>{const l=e<=8?e/8:1;return`<div title="${t}" class="smart-element smart-circular-progress-bar" style="background: inherit; padding-left:4px; position: relative; top: calc(50% - 12px); padding-top:4px; width: 20px; height: 20px;">\n                        <div class="smart-container">\n                        <svg style="background: var(--smart-background);"width="100%" height="100%" viewPort="0 0 100 100" viewBox="0 0 100 100" role="presentation" aria-hidden="true">\n                        <circle id="value" class="smart-value-path" r="50" cx="50" cy="50" transform="rotate(270 50 50)"></circle>\n                        <circle id="value" style="stroke-dashoffset: ${100*Math.PI-(1-l)*Math.PI*100}; stroke-width: 100%;"  class="smart-value" r="50" cx="50" cy="50" transform="rotate(270 50 50)"></circle>\n                        </svg>\n                        </div>\n                        </div>\n                        `};if(t){const s=864e5,m="string"==typeof t?new Date(t):t,u=Math.round(m.getTime()-o.getTime())/s,p=parseInt(Math.abs(u).toFixed(0));let g=r.columnByDataField.taskStatus;n.editor.boundDataField&&(g=r.columnByDataField[n.editor.boundDataField]);const f=g?a.cell.row.data[g.dataField]:"";if("done"===f||"complete"===f||"completed"===f||"finished"===f){let e=r.localize("done");i.innerHTML=`<div style="display: grid; grid-template-columns: 25px auto"><div style="margin-left: 4px; align-self: center; border-radius: 50%; display: flex; align-content: center; background: ${l[3]}; width:16px; height: 16px;"><span title="${e}" style="align-content: center; font-size: 13px; color: white;" class="smart-grid-icon show smart-icon-check"></span></div>${d}</span></div>`}else{let t="";t=0===p?r.localize("today"):1===p?e<o?r.localize("yesterday"):r.localize("tomorrow"):e<o?r.localize("daysOverdue",{value:p}):r.localize("daysLeft",{value:p}),i.innerHTML=e>=o?`<div style="display: grid; grid-template-columns: 25px auto">${c(p,t)}<span>${d}</span></div>`:`<div style="display: grid; grid-template-columns: 25px auto"><span title="${t}" style="font-size: 16px; color: ${l[0]}" class="smart-grid-icon show smart-icon-attention-circled"></span>${d}</span></div>`}}else i.innerHTML="";a.setAttribute("template",a.cell.template),a.setAttribute("value",e);break}case"attachments":{if(""===t||"[]"===t){const e=`<div class="file-container"><div class="attachments"><div title="${r.localize("addFiles")}" class="smart-grid-icon show smart-icon-plus"></div></div></div>`;return i.innerHTML!==e&&(i.innerHTML=e,i.onpointerdown=e=>{if(e.target.classList.contains("smart-icon-plus")){if(r._mobile)return;if(r.editing.enabled){const t=e.target.closest("smart-grid-cell"),l=t.getAttribute("data-field"),i=t.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l),t.querySelector(".smart-icon-plus").onpointerdown()}e.stopPropagation(),e.preventDefault()}}),a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const e=i.firstElementChild.getAttribute("value");if(t&&t.indexOf(e)>=0)return a.cell._setStyle(i),a.setAttribute("template",a.cell.template),void(i.firstElementChild.evaluateScroll&&i.firstElementChild.evaluateScroll());if(e&&t&&Array.isArray(t)&&t[0]&&t[0].value&&e.length===t[0].value.length)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}const e=document.createElement("div"),l=document.createElement("div");e.classList.add("file-container"),l.classList.add("attachments");let n=t;if(r._findIsFile(n)){let e="";if(n)try{e=JSON.parse(n)}catch(e){console.log(e)}n=e}if("string"==typeof n&&(n.indexOf("[{")>=0||n.indexOf("}]")>=0)){let e="";if(n)try{e=JSON.parse(n)}catch(e){console.log(e)}n=e}Array.isArray(n)&&n.forEach((t=>{const l=document.createElement("div");l.title=t.label,l.classList.add("item"),l.innerHTML="<div></div>",l.firstElementChild.classList.add("smart-grid-icon","show","attachment"),t.label||(t.label=""),t.label.indexOf("png")>=0||t.label.indexOf("jpg")>=0||t.label.indexOf("jpeg")>=0||t.label.indexOf("gif")>=0?l.firstElementChild.classList.add("smart-icon-image"):t.label.indexOf(".pdf")>=0?l.firstElementChild.classList.add("smart-icon-pdf"):t.label.indexOf(".tsv")>=0||t.label.indexOf(".txt")>=0||t.label.indexOf(".csv")>=0?l.firstElementChild.classList.add("smart-icon-text"):t.label.indexOf(".xls")>=0||t.label.indexOf(".xlsx")>=0?l.firstElementChild.classList.add("smart-icon-excel"):t.label.indexOf(".ppt")>=0?l.firstElementChild.classList.add("smart-icon-powerpoint"):t.label.indexOf(".zip")>=0||t.label.indexOf(".rar")>=0||t.label.indexOf(".7z")>=0?l.firstElementChild.classList.add("smart-icon-archive"):t.label.indexOf(".doc")>=0||t.label.indexOf(".docx")>=0?l.firstElementChild.classList.add("smart-icon-word"):t.label.indexOf(".mp3")>=0?l.firstElementChild.classList.add("smart-icon-music"):t.label.indexOf(".mp4")>=0||t.label.indexOf(".avi")>=0||t.label.indexOf(".mov")>=0||t.label.indexOf(".mp4")>=0||t.label.indexOf(".mpeg")>=0||t.label.indexOf(".webm")>=0||t.value&&t.value.indexOf("youtube")>=0?l.firstElementChild.classList.add("smart-icon-video"):l.firstElementChild.classList.add("smart-icon-file"),e.appendChild(l)}));const s=document.createElement("div");s.classList.add("smart-arrow-left","arrowbtn","smart-hidden");const d=document.createElement("div");d.classList.add("smart-arrow-right","arrowbtn");const c=document.createElement("div");if(c.classList.add("smart-icon-plus","smart-grid-icon","show"),c.title=r.localize("addFiles"),"card"!==r.view&&l.appendChild(c),l.onpointerdown=t=>{if(t.target.classList.contains("attachment")){const e=JSON.parse(a.cell.value),i=[...l.children[1].children],n=i&&i.indexOf?i.indexOf(t.target.parentNode):-1;if(e[n]){const t=document.createElement("a");if(e[n].value.indexOf(window.location.host)>=0)fetch(e[n].value).then((e=>e.blob())).then((l=>{const i=URL.createObjectURL(l);t.download=e[n].label,t.href=i,t.click()}));else{if(e[n].value.indexOf("base64")>=0){const l=r._getFileFromBase64(e[n].value);t.href=URL.createObjectURL(l)}else t.href=e[n].value;t.target="_blank",t.click()}}t.stopPropagation(),t.preventDefault()}else if("DIV"===t.target.nodeName&&t.target.classList.contains("arrowbtn")){let l=parseInt(e.style.marginLeft);isNaN(l)&&(l=0);const i=s===t.target,r=e.scrollWidth-a.offsetWidth+30;e.style.marginLeft=i?Math.min(0,l+25)+"px":Math.max(-r,l-25)+"px",l=parseInt(e.style.marginLeft),0===l?s.classList.add("smart-hidden"):s.classList.remove("smart-hidden"),t.stopPropagation(),t.preventDefault()}else if(t.target.classList.contains("smart-icon-plus")){if(r._mobile)return;if(r.editing.enabled){const e=t.target.closest("smart-grid-cell"),l=e.getAttribute("data-field"),i=e.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l),e.querySelector(".smart-icon-plus").onpointerdown()}t.stopPropagation(),t.preventDefault()}},e.children.length){if(l.appendChild(e),"card"!==r.view){const t=25*n.length;t-a.offsetWidth+30>30&&(l.appendChild(s),l.appendChild(d)),l.evaluateScroll=()=>{const i=t-a.offsetWidth+30;e.style.marginLeft="0px",s.classList.add("smart-hidden"),i<0?d.classList.add("smart-hidden"):d.classList.remove("smart-hidden"),i>30&&(l.appendChild(s),l.appendChild(d))}}o=l}else o=document.createElement("div");a.setAttribute("template",a.cell.template),t&&t[0]&&t[0].value?o.setAttribute("value",t[0].value):n&&n[0]&&n[0].label?o.setAttribute("value",n[0].label):o.setAttribute("value",t);break}case"images":{if(""===t||"[]"===t){const e=`<div class="file-container"><div class="images"><div title="${r.localize("addImages")}" class="smart-grid-icon show smart-icon-plus"></div></div></div>`;return e!==i.innerHTML&&(i.innerHTML=e,i.onpointerdown=e=>{if(e.target.classList.contains("smart-icon-plus")){if(r._mobile)return;if(r.editing.enabled){const t=e.target.closest("smart-grid-cell"),l=t.getAttribute("data-field"),i=t.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l),t.querySelector(".smart-icon-plus").onpointerdown()}e.stopPropagation(),e.preventDefault()}}),a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}if(!r._recycleFiles&&i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const e=i.firstElementChild.getAttribute("value");if(t&&t.indexOf(e)>=0)return a.cell._setStyle(i),a.setAttribute("template",a.cell.template),void(i.firstElementChild.evaluateScroll&&i.firstElementChild.evaluateScroll());if(e&&t&&Array.isArray(t)&&t[0]&&t[0].value&&e.length===t[0].value.length)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}const e=document.createElement("div"),l=document.createElement("div"),s=document.createDocumentFragment();e.classList.add("file-container"),l.classList.add("images");let d=t;if(r._findIsFile(d)){let e="";if(d&&d.indexOf("{")>=0)try{e=JSON.parse(d)}catch(e){console.log(e)}else e=d.split(","),e=e.map((e=>({label:e,value:e})));d=e}if("string"==typeof d&&(d.indexOf("[{")>=0||d.indexOf("}]")>=0)){let e="";if(d)try{e=JSON.parse(d)}catch(e){console.log(e)}d=e}else"string"==typeof d&&d.indexOf("./")>=0&&(d=d.split(","),d=d.map((e=>({label:e,value:e}))));Array.isArray(d)&&d.forEach((e=>{if(e.label||(e.label=""),e.label.indexOf(".mp4")>=0||e.label.indexOf(".avi")>=0||e.label.indexOf(".mov")>=0||e.label.indexOf(".mp4")>=0||e.label.indexOf(".mpeg")>=0||e.label.indexOf(".webm")>=0||e.value&&e.value.indexOf("youtube")>=0){const t=document.createElement("div");t.title=e.label,t.classList.add("item"),t.innerHTML="<div></div>",t.firstElementChild.classList.add("smart-grid-icon","show","attachment"),t.firstElementChild.classList.add("smart-icon-video"),s.appendChild(t)}else{const t=document.createElement("img");t.style.display="none";let l="";l=e.label.indexOf(".gif")>=0?e.value:e.small?e.small:e.medium?e.medium:e.large?e.large:e.value,t.onload=()=>{t.style.display=""},l.indexOf("base64")>=0?t.src=l:(r._imagesCache||(r._imagesCache=[]),r.uploadSettings.url?r._imagesCache[l]?r._findUserFile(e)&&(t.src=l):(r._imagesCache[l]=!0,t.style.display="none",r._findUserFile(e)?(t.src=l,t.style.display=""):l&&l.startsWith("https://")&&(t.src=l)):t.src=l,t.onerror=()=>{t.style.display="none"}),t.title=e.label,t.setAttribute("data-url",e.large||e.value),s.appendChild(t)}}));const c=document.createElement("div");c.classList.add("smart-arrow-left","arrowbtn","smart-hidden");const m=document.createElement("div");m.classList.add("smart-arrow-right","arrowbtn");const u=document.createElement("div");u.classList.add("smart-icon-plus","smart-grid-icon","show"),u.title=r.localize("addImages");const p=document.createElement("div");if(p.classList.add("smart-navigation"),"card"!==r.view&&r.editing.enabled&&n.allowEdit&&l.appendChild(u),l.onpointerdown=t=>{if("IMG"===t.target.nodeName&&("card"!==r.view&&[...e.children].forEach((e=>e.classList.remove("smart-hidden"))),r._openImagePreviewDialog(t.target),t.stopPropagation(),t.preventDefault()),t.target.classList.contains("attachment")){const l=JSON.parse(a.cell.value),i=[...e.children].indexOf(t.target.parentNode);if(l[i]){const e=document.createElement("a");if(l[i].value.indexOf(window.location.host)>=0)fetch(l[i].value).then((e=>e.blob())).then((t=>{const a=URL.createObjectURL(t);e.download=l[i].label,e.href=a,e.click()}));else{if(l[i].value.indexOf("base64")>=0){const t=r._getFileFromBase64(l[i].value);e.href=URL.createObjectURL(t)}else e.href=l[i].value;e.target="_blank",e.click()}}t.stopPropagation(),t.preventDefault()}else if("DIV"===t.target.nodeName&&t.target.classList.contains("smart-navigation-item")){[...p.children].forEach((e=>e.classList.remove("active"))),t.target.classList.add("active"),[...e.children].forEach((e=>e.classList.add("smart-hidden")));const l=[...p.children].indexOf(t.target);e.children[l].classList.remove("smart-hidden"),t.stopPropagation(),t.preventDefault()}else if("DIV"===t.target.nodeName&&t.target.classList.contains("arrowbtn")){let l=parseInt(e.style.marginLeft);isNaN(l)&&(l=0);const i=c===t.target,r=e.scrollWidth-a.offsetWidth+30;e.style.marginLeft=i?Math.min(0,l+25)+"px":Math.max(-r,l-25)+"px",l=parseInt(e.style.marginLeft),0===l?c.classList.add("smart-hidden"):c.classList.remove("smart-hidden"),t.stopPropagation(),t.preventDefault()}else if(t.target.classList.contains("smart-icon-plus")){if(r._mobile)return;if(r.editing.enabled){const e=t.target.closest("smart-grid-cell"),l=e.getAttribute("data-field"),i=e.closest("smart-grid-row").getAttribute("data-id");r.beginEdit(i,l),e.querySelector(".smart-icon-plus").onpointerdown()}t.stopPropagation(),t.preventDefault()}},e.appendChild(s),e.children.length){if(l.appendChild(e),"card"===r.view&&l.appendChild(p),"card"!==r.view){const t=25*d.length;t-a.offsetWidth+30>30&&(l.appendChild(c),l.appendChild(m)),l.evaluateScroll=()=>{const i=t-a.offsetWidth+30;e.style.marginLeft="0px",c.classList.add("smart-hidden"),i<0?m.classList.add("smart-hidden"):m.classList.remove("smart-hidden"),i>30&&(l.appendChild(c),l.appendChild(m))}}else{for(let t=0;t<e.children.length;t++){const l=document.createElement("div");l.classList.add("smart-navigation-item"),0===t?l.classList.add("active"):e.children[t].classList.add("smart-hidden"),p.appendChild(l)}1===e.children.length&&p.classList.add("smart-visibility-hidden")}o=l}else o=document.createElement("div");a.setAttribute("template",a.cell.template),t&&t[0]&&t[0].value?o.setAttribute("value",t[0].value):d&&d[0]&&d[0].label?o.setAttribute("value",d[0].label):o.setAttribute("value",t);break}case"email":if(Smart.Validator){const e=i.firstElementChild?i.firstElementChild.getAttribute("value"):null;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")&&e===t)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template);if(s())return;o=document.createElement("span"),null===t||""===t?o.innerHTML="":Smart.Validator.email(t)?o.innerHTML=t:(o.className="url center middle",o.innerHTML='<a href="mailto:'+t+'" target="_blank" contenteditable="false" rel="noreferrer noopener">'+t+"</a>",o.firstElementChild&&(o.firstElementChild.onpointerdown=e=>{e.stopPropagation(),e.preventDefault(),o.firstElementChild.click()}))}a.setAttribute("template",a.cell.template),o.setAttribute("value",t);break;case"url":if(Smart.Validator){const e=i.firstElementChild?i.firstElementChild.getAttribute("value"):null;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")&&e===t)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template);if(s())return;const l=e=>{e.classList.add("center","middle"),null===t||""===t?e.classList.add("smart-hidden"):Smart.Validator.url(t)?(e.firstElementChild&&"A"===e.firstElementChild.nodeName?(e.firstElementChild.setAttribute("href",t),e.firstElementChild.textContent=t):e.innerHTML='<a href="https://'+t+'" target="_blank" contenteditable="false" rel="noreferrer noopener">'+t+"</a>",e.classList.remove("smart-hidden")):(e.firstElementChild&&"A"===e.firstElementChild.nodeName?(e.firstElementChild.setAttribute("href",t),e.firstElementChild.textContent=t):e.innerHTML='<a href="'+t+'" target="_blank" contenteditable="false" rel="noreferrer noopener">'+t+"</a>",e.classList.remove("smart-hidden"))};i.firstElementChild&&i.firstElementChild.classList.contains("url")?(o=i.firstElementChild,l(o)):(o=document.createElement("span"),o.className="url",l(o)),o.firstElementChild&&(o.firstElementChild.onpointerdown=e=>{e.stopPropagation(),e.preventDefault(),o.firstElementChild.click()})}a.setAttribute("template",a.cell.template),o.setAttribute("value",t);break;case"sparklines":{const l=t,o=""+n.computedWidth;if(i.firstElementChild&&i.firstElementChild.hasAttribute("value")){const e=i.firstElementChild.getAttribute("value"),t=i.firstElementChild.getAttribute("width"),n=i.firstElementChild.getAttribute("height"),s=a.cell.row.cellHeight||r.layout.rowMinHeight;if(l===e&&t===o&&s===n)return a.cell._setStyle(i),void a.setAttribute("template",a.cell.template)}const d=(e,t,l)=>{if(!1===c.tooltip)return;const i=e.pageX,a=e.pageY-10;if(!r._sparklineTooltip){const e=document.createElement("smart-button");e.classList.add("secondary"),e.style.boxShadow="var(--smart-elevation-4)",e.style.opacity=.9,e.style.transition="all cubic-bezier(0.6, 0.2, 0, 0.8) 0.2s",document.body.appendChild(e),e.style.position="absolute",e.style.zIndex=999,r._sparklineTooltip=e}const n=r._sparklineTooltip;n.innerHTML===t&&n.element===l||(n.style.top=a+25+"px",n.style.left=i-15+"px"),n.innerHTML=""+t,n.style.display=""},c=n.templateSettings,m=()=>{i.onmousemove=e=>{if("column"!==c.type&&"bar"!==c.type||i.querySelectorAll("rect").forEach((t=>{var l=t.getBoundingClientRect();t.removeAttribute("highlight"),l.left<=e.clientX&&e.clientX<=l.right&&l.top<=e.clientY&&e.clientY<=l.bottom&&(t.setAttribute("highlight",""),d(e,t.getAttribute("data-title"),t))})),"pie"===c.type){let t=!1;i.querySelectorAll("path").forEach((l=>{var i=l.getBoundingClientRect();l.removeAttribute("highlight"),t||i.left<=e.clientX&&e.clientX<=i.right&&i.top<=e.clientY&&e.clientY<=i.bottom&&(l.setAttribute("highlight",""),t=!0,d(e,l.getAttribute("data-title"),l))}))}"line"===c.type&&i.querySelectorAll("line").forEach((t=>{var l=t.getBoundingClientRect();t.removeAttribute("highlight"),l.left<=e.clientX&&e.clientX<=l.right&&(t.previousElementSibling&&(t.previousElementSibling.style.display="none"),t.nextElementSibling&&(t.nextElementSibling.style.display="none"),t.setAttribute("highlight",""),l.left+l.width/2>=e.clientX?t.previousElementSibling&&(t.previousElementSibling.style.display="",d(e,t.previousElementSibling.getAttribute("data-title"),t.previousElementSibling)):t.nextElementSibling&&(t.nextElementSibling.style.display="",d(e,t.nextElementSibling.getAttribute("data-title"),t.nextElementSibling)))}))},i.onmouseleave=()=>{r._sparklineTooltip&&(r._sparklineTooltip.style.display="none"),i.querySelectorAll("rect").forEach((e=>{e.removeAttribute("highlight")})),i.querySelectorAll("path").forEach((e=>{e.removeAttribute("highlight")})),i.querySelectorAll("line").forEach((e=>{e.removeAttribute("highlight")})),i.querySelectorAll("circle").forEach((e=>{e.style.display="none"}))}};if(s())return void m();const u=new e,p=a.cell.row.cellHeight||r.layout.rowMinHeight;if(p>=7)if(a._sparklinesRender&&cancelAnimationFrame(a._sparklinesRender),t){const e=u.render({width:o-10,height:Math.max(0,p-7),points:t,colors:c.colors,type:c.type,gap:c.gap,max:c.max,min:c.min,strokeWidth:c.strokeWidth,colorFunction:c.colorFunction,tooltipFormatFunction:c.tooltipFormatFunction});i.innerHTML=`<div height="${p}" width="${o}" value="${l}" style="padding-top: 5px; padding-left: 5px; padding-right: 5px;">${e}</div>`,m()}else i.innerHTML="",i.onmousemove=i.onmouseleave=null;a.setAttribute("template",a.cell.template);break}default:{let e=null;a.setAttribute("template","");const l=a.cell.row,s=i;let o=a.cell.getFormattedValue(t,n.cellsFormat);if(s.style.lineHeight="","function"==typeof a.cell.template){const e=a.cell.column.templateSettings.React||r.React,i=a.cell.column.templateSettings.ReactDOM||r.ReactDOM;if(a.cell.column.templateSettings&&e&&i){return void i.createRoot(s).render(e.createElement(a.cell.template,{value:t}))}const d={row:l,column:n,cell:a.cell,oldValue:a.cell.oldValue,value:t,template:null};let c=s.querySelector(".smart-grid-cell-template");const m=l.id;r.isHScrolling&&(r._cachedTemplates||(r._cachedTemplates=[]),c&&0===c.innerHTML.length&&(c=null),!c&&r._cachedTemplates&&r._cachedTemplates[n.dataField+"_"+m]&&(0===r._cachedTemplates[n.dataField+"_"+m].innerHTML.length?delete r._cachedTemplates[n.dataField+"_"+m]:d.template=r._cachedTemplates[n.dataField+"_"+m])),c&&c.getAttribute("column")===n.dataField?d.template=c.firstElementChild:c=null,a.formattedValue!==o&&(c=null),a.cell.canNotify=!1,l.canNotify=!1;const u=Object.assign({},{background:a.cell.background,color:a.cell.color,fontSize:a.cell.fontSize,fontFamily:a.cell.fontFamily,fontWeight:a.cell.fontWeight,textDecoration:a.cell.textDecoration,fontStyle:a.cell.fontStyle});if(a.cell.template(d),!c&&d.template)if(d.template instanceof HTMLElement){const e=document.createElement("div");e.classList.add("smart-grid-cell-template"),e.setAttribute("column",n.dataField),s.innerHTML="",s.appendChild(e),e.appendChild(d.template)}else s.innerHTML='<div column="'+n.dataField+'" class="smart-grid-cell-template">'+d.template+"</div>";else c||null!==d.template||(s.innerHTML=t);if(r.isHScrolling&&!r._cachedTemplates[n.dataField+"_"+m]&&s.firstElementChild.firstElementChild){const e=s.firstElementChild.firstElementChild;e&&(r._cachedTemplates[n.dataField+"_"+m]=e)}s.style.background===u.background&&s.style.color===u.color&&s.style.fontSize===u.fontSize&&s.style.fontWeight===u.fontWeight&&s.style.fontStyle===u.fontStyle||(a.cell._styleChanged=!0,a.cell._setStyle(s)),a.cell.background!==u.background||a.cell.color!==u.color||a.cell.fontSize!==u.fontSize||a.cell.fontWeight!==u.fontWeight||a.cell.fontStyle!==u.fontStyle?(a.cell._styleChanged=!0,a.cell._setStyle(s)):a.cell._styleChanged&&a.cell._setStyle(s),void 0===a.cell.oldValue&&(a.cell.oldValue=t),a.formattedValue=o,a.cell.canNotify=!0,l.canNotify=!0}else if(Array.isArray(a.cell.template)){const e=document.createElement("div");if(s.firstElementChild&&s.firstElementChild.classList.contains("smart-grid-cell-template"))for(let e=0;e<a.cell.template.length;e++){const t=s.firstElementChild.children[e].firstElementChild,i=a.cell.template[e];if(i.length>1&&t){let e=l.data[i[1]];i[2]&&(e=i[2].length>2?i[2].replaceAll("{{value}}",e):a.cell.getFormattedValue(e,i[2])),t.src&&t.src!==e?(a._imageUpdateTimer&&clearTimeout(a._imageUpdateTimer),a._imageUpdateTimer=setTimeout((()=>{t.src=e}),50)):t.textContent!==e&&(t.textContent=e)}}else{e.classList.add("smart-grid-cell-template"),e.setAttribute("column",n.dataField),s.innerHTML="",s.appendChild(e);let t="";for(let e=0;e<a.cell.template.length;e++){const i=a.cell.template[e];if(i.length>1){let e=l.data[i[1]];i[2]&&(e=i[2].length>2?i[2].replaceAll("{{value}}",e):a.cell.getFormattedValue(e,i[2])),t+='<span class="smart-template-part">'+i[0].replaceAll("{{value}}",e)+"</span>"}}e.innerHTML=t}}else{if(""!==s.textContent&&(s.textContent=""),a.cell.template instanceof HTMLTemplateElement)e=a.cell.template;else if(a.cell.template instanceof HTMLElement){const e=a.cell.template.innerHTML.replace(/{{value}}/gi,t).replace(/{{id}}/gi,l.id);s.innerHTML!==e&&(s.innerHTML=e)}else if("function"==typeof a.cell.template&&a.cell.template.prototype&&"undefined"!=typeof ngApp){const e=ngApp.injector,l=e.get(ComponentFactoryResolver).resolveComponentFactory(a.cell.template),i=s.appendChild(l.create(e));return i.instance.value=t,void i.changeDetectorRef.detectChanges()}if(a.cell.template.startsWith&&a.cell.template.startsWith("#")&&(e=document.querySelector(a.cell.template)),e){let i=e.content.cloneNode(!0).firstElementChild;const d=t;if(t=(t=(t=t.toString()).replace(/'/gi,"\\'")).replace(/"/gi,'\\"'),i.querySelector("[smart-if]")){const e=i.querySelector("[smart-else]"),l=i.querySelectorAll("[smart-if]");let a=!1;for(let e=0;e<l.length;e++){const r=l[e],s=r.getAttribute("smart-if"),o=s.split(" "),c=o[1].trim();let m=o[2].trim();s.indexOf("'")>=0&&(m=s.substring(s.indexOf("'")+1),m=m.replaceAll("'",""));let u=t;switch("Today"===m&&(m=new Date),"date"===n.dataType&&(t=new Date(d).getTime(),m=new Date(m).getTime()),c){case">":t>parseFloat(m)&&(i=r,a=!0);break;case">=":t>=parseFloat(m)&&(i=r,a=!0);break;case"=":case"==":case"===":t===m&&(i=r,a=!0);break;case"<":t<parseFloat(m)&&(i=r,a=!0);break;case"<=":t<=parseFloat(m)&&(i=r,a=!0)}if(t=u,a)break}!a&&e&&(i=e)}let c=i.outerHTML.replace(/{{value}}/gi,t).replace(/{{id}}/gi,l.id);for(c.indexOf("{{value=")>=0&&(t?(c=c.substring(0,c.indexOf("{{value="))+t+c.substring(c.indexOf("}")),c=c.replace(/}/gi,""),c=c.replace(/{/gi,"")):(c=c.replace(/{{value=/gi,""),c=c.replace(/}}/gi,"")));c.indexOf("{{value::")>=0;){const e=c.indexOf("{{value::"),l=c.substring(e+9,c.indexOf("}}")),i=a.cell.getFormattedValue(t,l);c=c.replace(`{{value::${l}}}`,i)}if(n._treeColumn){const e=s.firstChild;if(e&&e.classList&&a.toggleButton&&n._treeColumn&&s.children[1]){const e=s.children[0],t=s.children[1].children[0],i=s.children[1].children[1].firstChild,a=s.children[1].children[2];let n="";if(r.grouping.enabled){let e=l.level-1;"multipleColumns"!==r.grouping.renderMode&&(n+='<div style="width: '+(1+e)*r.grouping.groupIndent+'px;"></div>')}else for(let e=0;e<l.level;e++)n+="<div class='smart-indent'></div>";l.checked?i.setAttribute("checked",""):!1===l.checked?i.removeAttribute("checked"):null===l.checked&&i.setAttribute("checked","indeterminate"),l.leaf?l.allowCheck?i.classList.remove("smart-visibility-hidden"):i.classList.add("smart-visibility-hidden"):l.allowCheck?i.classList.remove("smart-hidden"):i.classList.add("smart-hidden"),l.allowCheck?r.checkBoxes.visible?i.classList.remove("smart-hidden"):i.classList.add("smart-hidden"):r.checkBoxes.visible||i.classList.add("smart-hidden"),e.innerHTML=n,t.classList.add("smart-visibility-hidden"),l.leaf?t.classList.add("smart-visibility-hidden"):(t.classList.remove("smart-visibility-hidden"),l.expanded?t.setAttribute("toggled",""):t.removeAttribute("toggled","")),l.data.isEmpty&&t.classList.add("smart-visibility-hidden"),a.innerHTML=c,r.appearance.showTooltips?a.setAttribute("title",r._unescapeString(o)):a.hasAttribute("title")&&a.removeAttribute("title")}}else s.innerHTML!==c&&(s.innerHTML=c)}else if("string"==typeof a.cell.template){""===t&&(t="&nbsp;");let e=a.cell.template.replace(/{{value}}/gi,t).replace(/{{id}}/gi,l.id);if(e.indexOf("{{"))for(let t=0;t<r.dataSource.dataFields.length;t++){const i=r.dataSource.dataFields[t].name;if(e.indexOf("{{"+i+"}}")>=0&&(e=e.replace("{{"+i+"}}",l.data[i]),-1===e.indexOf("{{")))break}s.innerHTML!==e&&(s.innerHTML=e)}}if("auto"===a.cell.row.height||r.layout.allowCellsWrap||"auto"===r.layout.rowHeight){const e=s.querySelector(".smart-grid-cell-template");if(e){l._templatesHeight||(l._templatesHeight=[]);const t=(e,t)=>{if(e){const l=r.rowById[e.getAttribute("data-id")];l._templatesHeight[n.dataField]=t,l._isDirty=!0;const i=l.canNotify;l.canNotify=!1,l.autoSize(),l.canNotify=i,delete l._isDirty}};if(e.firstElementChild){if(!e.firstElementChild.resizeObserver){const l=new ResizeObserver((function(){const e=this.target.closest("smart-grid-row");this.target.offsetHeight&&(t(e,this.target.offsetHeight),r.$.scrollView.scrollTop=0)}));e.firstElementChild.resizeObserver=l,l.target=e.firstElementChild,l.observe(e.firstElementChild)}e.firstElementChild.onblur=e.firstElementChild.onchange=function(){const e=this.closest("smart-grid-row");t(e,this.offsetHeight)}}else{const l=this.closest("smart-grid-row");t(l,e.offsetHeight)}}}}}if(o)return i.innerHTML="",i.appendChild(o),r._cellCachedValues&&(r._cellCachedValues[n.dataField+"_"+t]=i.innerHTML),a.cell._setStyle(i),o;r._cellCachedValues&&(r._cellCachedValues[n.dataField+"_"+t]=i.innerHTML)}async _render(){const e=this,t=e.cell.grid,l=e.cell.column,i=e.cell.row,a=i.data,r=i._isMeasureRow?null:e.cell.format||l.cellsFormat,n=t.grouping.enabled&&t.dataSource.groupBy.length>0;if(!(!1!==t._recycleValues||n||l.formatFunction||l._treeColumn||i.summaryRow||"grid"!==t.view)){if(e.cell.selected?(e.setAttribute("selected",""),e.setAttribute("aria-selected",!0)):(e.removeAttribute("selected"),e.removeAttribute("aria-selected")),e.classList.contains("smart-hidden")&&e.classList.remove("smart-hidden"),e.cell.focused?(t.selection.allowCellSelection&&e.setAttribute("focus",""),i.element.setAttribute("focus",""),i.element.toggleDetailButton&&(i.element.toggleDetailButton.classList.remove("smart-visibility-hidden"),i.element.star&&i.element.star.classList.add("smart-hidden")),e.cell.id||(e.id="gridcell_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),t.setAttribute("aria-activedescendant",e.id)):(e.removeAttribute("focus"),i.element&&i.element.star&&t._selection.focusedCell&&t._selection.focusedCell.id!==i.id?i.element.star.classList.remove("smart-hidden"):t.appearance.showRowComments&&!i.element.hasAttribute("focus")&&i.element.toggleDetailButton&&i.element.toggleDetailButton.classList.add("smart-visibility-hidden")),e.cell.background||e.cell.color){e.cell._styleChanged=!0;const t=e.firstChild;e.cell._setStyle(t)}return}if(t.grouping.enabled&&t.dataSource.groupBy.length>0&&"card"!==t.view){if(void 0!==i.label){let t=l.displayField?a[l.displayField]:a[l.dataField];return void 0===t&&a.data&&(t=l.displayField?a.data[l.displayField]:a.data[l.dataField]),e._renderGroupCell(t),void(i.summaryRow&&(e.cell.canNotify=!1,i.canNotify=!1,e.cell._styleChanged=!0,e.cell.background=null,e.cell.color=null,e.cell.fontFamily=null,e.cell.fontSize=null,e.cell.element&&e.cell.element.firstElementChild&&e.cell._setStyle(e.cell.element.firstElementChild),e.cell.canNotify=!0,i.canNotify=!0))}e.style.zIndex=""}else if(t.appearance.showTreeRowHeader&&t.rowHierarchy&&!1===i.leaf&&!l.autoGenerated){let t=a[i.groupDataField];return i.label=t,void e._renderGroupCell(t)}if(t.appearance.showTreeRowHeader&&e.removeAttribute("header"),t.grouping.enabled&&t.dataSource.groupBy.length>0&&e.toggleButton&&(e.toggleButton.classList.remove("smart-hidden"),e.toggleButton.classList.remove("smart-visibility-hidden"),e.toggleButton.style.marginLeft="",l._treeColumn&&t.grouping.enabled&&t.grouping.toggleButtonIndent>0&&(e.toggleButton.style.marginLeft=i.level*(t.grouping.toggleButtonIndent-t.grouping.groupIndent)+"px")),t.grouping.enabled&&t.dataSource.groupBy.length>0&&(e.removeAttribute("header"),e.removeAttribute("group")),!l.visible)return void(e.style.width="0px");t.appearance.showSortColumnBackground&&t.sorting.maintainSort&&!i.summaryRow?l.sorted?e.setAttribute("sort",""):e.removeAttribute("sort"):l.sorted&&e.hasAttribute("sort")&&e.removeAttribute("sort"),t.appearance.showFilterColumnBackground?l.filtered?e.setAttribute("filter",""):e.removeAttribute("filter"):l.filtered&&e.hasAttribute("filter")&&e.removeAttribute("filter"),t.dataSource.boundHierarchy&&e.hasAttribute("has-toggle-button")&&!l._treeColumn&&e.removeAttribute("has-toggle-button"),t.dataSource.boundHierarchy||!e.hasAttribute("has-toggle-button")||l._treeColumn||e.removeAttribute("has-toggle-button");let s=l.displayField?a[l.displayField]:a[l.dataField];if(l.parentDataField){const e=t.columnByDataField[l.parentDataField];if(e){let a=e.editor.dataSource;e.relationId&&e.relationField&&e._isDirty&&(!e.editor.dataSource||e.editor.dataSource&&0===e.editor.dataSource.length)&&(a=t._getRelationData(e.relationId));const r=a[t.getCellValue(i.id,l.parentDataField)];if(r){s=r[l.cascadingDataField]}}}if(null!==s||l.allowNull||("int"!==l.dataType&&"number"!==l.dataType||(s=0),"string"===l.dataType&&(s=""),"boolean"!==l.dataType&&"bool"!==l.dataType||(s=!1),"date"===l.dataType&&(s=new Date)),t.formulas&&e.cell.formula&&"string"==typeof e.cell.formula&&e.cell.formula.startsWith("=")&&/=.+/.test(e.cell.formula)){const a=t._formulaParser;if(a){if(t&&t.formulas&&e.cell._formula!==l.formula){let t=i.data[l.dataField];l.formula&&(e.cell.formula=e.cell._parseFormula(l.formula)),t&&(""+t).startsWith("=")&&(e.cell.formula=e.cell._parseFormula(""+t)),e.cell._formula=l.formula}const r=a.parse(e.cell.formula.slice(1));s=isNaN(r)?"#VALUE!"===r?"":"#ERROR!"===r?"#ERROR!":r:r}}t.grouping.enabled&&"multipleColumns"===t.grouping.renderMode&&t.dataSource&&t.dataSource.groupBy.length>0&&t.dataSource.groupBy.indexOf(l.dataField)>=0&&(s="",e.setAttribute("header","")),e.removeAttribute("highlight"),t.highlighted!==i.id||l.autoGenerated||e.setAttribute("highlight",""),t.editing.addNewRow.visible&&e.classList.remove("smart-add-new-row"),t.editing.enabled&&(e.cell.readonly||!l.allowEdit?e.classList.add("smart-readonly"):e.classList.remove("smart-readonly"));const o=t=>{if(t){if((t=""+t).startsWith("off_"))return e.classList.remove(t.substring(4)),!1;if(e.classList.add(t),e.hasAttribute("customCSS")){t=t+" "+e.getAttribute("customCSS")}return e.setAttribute("customCSS",t),!0}return e.setAttribute("highlight",""),!0};if((t.highlightedRows||t.highlightedCells)&&e.hasAttribute("customCSS")){const t=e.getAttribute("customCSS");e.removeAttribute("customCSS");const l=t.split(" ");for(let t=0;t<l.length;t++)e.classList.remove(l[t])}if(l.highlight&&!i.summaryRow&&(o(l._highlightCSS||""),e.setAttribute("highlight-data-field",l.dataField)),t.highlightedCells&&t.highlightedCells[i.id]&&!i.summaryRow&&void 0!==t.highlightedCells[i.id][l.dataField]){o(t.highlightedCells[i.id][l.dataField])}if(t.highlightedRows&&!i.summaryRow&&void 0!==t.highlightedRows[i.id]){o(t.highlightedRows[i.id])}if(t.editing.batch){if(t._cellsUpdatedValues){e.removeAttribute("update");const a=t._cellsUpdatedValues[i.id+"_"+l.dataField];void 0!==a&&(e.setAttribute("update",""),s=a)}t._rowsDeleted&&(t._rowsDeleted.indexOf(i.id)>=0?e.setAttribute("delete",""):e.removeAttribute("delete")),t._rowsAdded&&(t._rowsAdded.indexOf(i.id)>=0?e.setAttribute("add",""):e.removeAttribute("add"))}!t.onCellValue||l.rowHeaderColumn||l.selectionColumn||(e.cell._updating=!0,t.onCellValue(e.cell,t),e.cell._updating=!1,s=e.cell.value),void 0===s&&(s="");let d=s;r?d=e.cell.getFormattedValue(s,r):l.formatSettings&&l.formatSettings.Intl?d=e.cell.getFormattedValue(s,l.formatSettings.Intl):l.formatSettings&&l.formatSettings.formatString&&(d=e.cell.getFormattedValue(s,l.formatSettings.formatString));const c=e.firstChild;if(e.content=c,l._isDirty&&(c.innerHTML=""),c.hasAttribute("data-field")&&c.getAttribute("data-field")!==l.dataField&&(c.innerHTML="",i.filterRow&&(l._filterEditorInitialized=!1)),c.setAttribute("data-field",l.dataField),t.onCellRender||l.onCellRender)if(l._cellsCachedValues||(l._cellsCachedValues=[]),l._cellsCachedValues[i.index]){const t=l._cellsCachedValues[i.index];c.firstChild&&c.removeChild(c.firstChild),e.cell.template instanceof HTMLTemplateElement||"string"==typeof e.cell.template?c.appendChild(t):c.innerHTML=t.innerHTML}else{if(e.cell._updating=!0,t.onCellRender?t.onCellRender(e.cell,i.visibleIndex,l.dataField,i.data,e):l.onCellRender(e.cell,i.visibleIndex,l.dataField,i.data,e),e.cell._updating=!1,e.cell.template!==l.template){const t=document.createElement("div");return c.firstChild&&c.removeChild(c.firstChild),e.cell.template instanceof HTMLTemplateElement?(t.appendChild(e.cell.template.content.cloneNode(!0)),l._cellsCachedValues[i.index]=t):t.appendChild(e.cell.template),void c.appendChild(t)}e.cell.value!==s&&(d=e.cell.value)}if(l.autoGenerated||e.setAttribute("data-field",l.dataField),e.cell.focused?(t.selection.allowCellSelection&&e.setAttribute("focus",""),i.element.setAttribute("focus",""),i.element.toggleDetailButton&&(i.element.toggleDetailButton.classList.remove("smart-visibility-hidden"),i.element.star&&i.element.star.classList.add("smart-hidden")),e.cell.id||(e.id="gridcell_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),t.setAttribute("aria-activedescendant",e.id)):e.removeAttribute("focus"),e.cell.selected?(e.setAttribute("selected",""),e.setAttribute("aria-selected",!0)):(e.removeAttribute("selected"),e.removeAttribute("aria-selected")),t.dragDrop&&t.dragDrop.row===i?e.classList.add("dragged"):e.classList.remove("dragged"),e._classNames)for(let t=0;t<e._classNames.length;t++)e.classList.remove(e._classNames[t]);if(i._classNames||e._rowClassNames){if(e._rowClassNames)for(let t=0;t<e._rowClassNames.length;t++)e.classList.remove(e._rowClassNames[t]);for(let t=0;t<i._classNames.length;t++)e.classList.add(i._classNames[t]);e._rowClassNames=i._classNames}if(t.onCellClass){const a=t.onCellClass(i.visibleIndex,l.dataField,s,i.data,i,t);if(e.___classNames)for(let t=0;t<e.___classNames.length;t++)e.classList.remove(e.___classNames[t]);if(a){const t=a.trim().split(" ");for(let l=0;l<t.length;l++)e.classList.add(t[l]);e.___classNames=t}}if(l.cellsClassName)if("string"==typeof l.cellsClassName){const t=l.cellsClassName.trim().split(" ");for(let l=0;l<t.length;l++)e.classList.add(t[l]);e._classNames=t}else{const t=l.cellsClassName(i.visibleIndex,l.dataField,s,i.data,i);if(e._classNames)for(let t=0;t<e._classNames.length;t++)e.classList.remove(e._classNames[t]);if(t){const l=t.trim().split(" ");for(let t=0;t<l.length;t++)e.classList.add(l[t]);e._classNames=l}}if(l.cellsCSSRules){if(e.__classNames)for(let t=0;t<e.__classNames.length;t++)e.classList.remove(e.__classNames[t]);const a=Object.keys(l.cellsCSSRules);let r=[];for(let n=0;n<a.length;n++){let o=a[n];const d={index:i.visibleIndex,value:s,dataField:l.dataField,row:i,api:t};l.cellsCSSRules[o](d)&&(e.classList.add(o),r.push(o))}e.__classNames=r}t.rowDetail.enabled&&i.showDetail&&!1===t.rowDetail.dialog.enabled&&(e.style.height=i.cellHeight+"px",e.style.lineHeight=i.cellHeight+"px"),i.expanded&&i.expandHeight>0&&(e.style.height=i.cellHeight+"px",e.style.lineHeight=i.cellHeight+"px");const m=e._getCellAlignment(i,l),u=""!==e.cell.template&&t.isInitialized&&!i._isMeasureRow;let p="";if(m.align&&(p+=m.align+" "),m.verticalAlign&&(p+=m.verticalAlign+" "),l.cellsWrap)p+="wrap ";else if(t.layout.autoWrap&&i.height>40&&1===e.cell.colSpan&&"string"===l.dataType){if(14*(d||"").length*.52>l.computedWidth){if("url"!==e.cell.template&&"email"!==e.cell.template){p+="textwrap ";const e=parseInt(i.height/20);c.style["-webkit-line-clamp"]=e}}}if(p+="smart-label",e.style.width!==l.computedWidth+"px"){const i=t._isLastVisibleColumn(l);l.autoGenerated||i?e.style.width=l.computedWidth+"px":e.style.width=l.computedWidth-t._columnGap+"px"}l.grid.appearance.showRowComments&&l.rowHeaderColumn&&(e.style.width=l.computedWidth+t.rowDetailColumn.width+"px",e.classList.add("row-number")),l===t._firstVisibleColumn?e.classList.add("smart-grid-column-border-collapse"):e.classList.remove("smart-grid-column-border-collapse"),t.appearance.showColumnGroupCellLines||l.parent&&!l.element.hasAttribute("column-group-first-child")&&e.classList.add("smart-grid-column-border-collapse"),t.grouping.enabled&&"multipleColumns"===t.grouping.renderMode&&t.dataSource&&t.dataSource.groupBy.length>0&&t.dataSource.groupBy.indexOf(l.dataField)>=0&&e.classList.add("smart-grid-column-border-collapse"),t._columnGap>0&&t.appearance.showColumnLines&&e.classList.add("smart-grid-column-border"),t._rowGap>0&&e.classList.add("smart-grid-row-border"),t.appearance.showColumnLines?e.classList.remove("smart-grid-vertical-border-collapse"):e.classList.add("smart-grid-vertical-border-collapse"),t.appearance.showRowLines?e.classList.remove("smart-grid-horizontal-border-collapse"):e.classList.add("smart-grid-horizontal-border-collapse");let g=l.left;if(t.rightToLeft?e.style.right!==g+"px"&&(e.style.right=g+"px"):e.style.left!==g+"px"&&(e.style.left=g+"px"),e.classList.contains("smart-hidden")&&e.classList.remove("smart-hidden"),e.hasAttribute("template")&&e.removeAttribute("template"),e.hasAttribute("freeze")&&e.removeAttribute("freeze"),e.hasAttribute("detail")&&e.removeAttribute("detail"),e.hasAttribute("error")&&e.removeAttribute("error"),e.cell.error&&e.setAttribute("error",e.cell.error),i.filterRow?e.classList.add("smart-grid-filter-row-cell"):i.summaryRow?e.classList.add("smart-grid-summary-row-cell"):(l.freeze||i.freeze)&&(l.selectionColumn&&(e.setAttribute("checkbox",""),p+=" smart-input",l.grid.selection.checkBoxes.enabled&&l.grid.selection.checkBoxes.autoShow?e.setAttribute("auto-show",""):e.removeAttribute("auto-show")),(l.rowHeaderColumn||l.selectionColumn)&&(e.setAttribute("header",""),e.setAttribute("role","rowheader")),t.appearance.showFrozenColumnBackground&&l.freeze&&e.setAttribute("freeze",""),t.appearance.showFrozenRowBackground&&i.freeze&&e.setAttribute("freeze",""),l.rowDetailColumn&&(e.setAttribute("header",""),e.setAttribute("detail",""),e.setAttribute("has-toggle-button",""),e.classList.add("smart-grid-column-border-collapse")),l.commandColumn&&e.setAttribute("command","")),t.appearance.showRowComments&&(i.comments&&i.comments.length>0&&l===t._firstVisibleUserColumn?e.classList.add("row-comments"):e.classList.remove("row-comments")),l.cellsRotationAngle){if(!e._rotateCellContent(c,l,s))return}else if(i.filterRow){if(!l.toggleColumn&&!l.rowHeaderColumn)return t.grouping.enabled&&t.dataSource&&t.dataSource.groupBy.length>0&&(l._filterEditorInitialized=!1),l._filterEditorInitialized||l.autoGenerated?void("boolean"===l.dataType||"bool"===l.dataType?e.setAttribute("template","checkBox"):e.removeAttribute("template")):(l._filterEditorInitialized=!0,void e._renderFilterCell(c));c.innerHTML=""}else if(i.summaryRow){if(l.toggleColumn||l.rowHeaderColumn)""!==c.innerHTML&&(c.innerHTML="");else if(l.autoGenerated&&""!==c.innerHTML&&(c.innerHTML=""),t.dataSource.boundHierarchy&&e.hasAttribute("has-toggle-button")&&e.removeAttribute("has-toggle-button"),!l.autoGenerated){if(l.summary&&l.summary.length>0&&t._summaryItems){const i=t._summaryItems[l.dataField],a=[];for(let r in i){if("status"===r)continue;const n=l.cellsFormat;let s=i[r];n&&n.indexOf("p")>=0&&"count"===r?s=i[r]:n&&"date"!==l.dataType&&(s=e.cell.getFormattedValue(s,n)),t.messages&&t.messages[t.locale]&&t.messages[t.locale][r]?a.push(t.localize(r,{value:s})):a.push(r+": "+s)}let r=[],n="";if(i&&i.status&&l.editor){n+='<div style="margin-right: 5px; display: flex; border-radius: 8px; align-items: center;">';const e=l.editor.dataSource,a=i.status,s=t.rows.length,o=l.computedWidth;let d=0;if(e)for(let l=0;l<e.length;l++){const i=e[l];if(a[i.value]){const e=i.label?i.label:t.localize("blankSummary"),l=a[i.value].length,c=new Number(l/s*100).toFixed(2),m=e+" "+l+"/"+s+" "+c+"%",u=o*c/100/2;r.push(m);const p=["#D50000","#F6BF26","#33B679","#039BE5","#3F51B5","#8E24AA"];d>p.length-1&&(d=0);n+='<span class="summary-value-part" title="'+m+'" style="width: '+u+"px; font-size: 11px; padding: 5px; background:"+(i.color||p[d++])+'; color: white;"></span>'}}n+="</div>"}const s=a.join(", "),o=t.summaryRow.editing?'<span class="smart-arrow-down"></span>':"";let d=`<div title = "${s}" class="smart-truncate summary-value" > <span class="label">${s}</span>${o}</div> `;r.length&&(d=`<div title = "${s}" class="smart-truncate summary-value" > <span style="align-items: center; display: flex;" class="label">${n}${s}</span>${o}</div> `);if(t.columns[0].dataField===l.dataField&&a.length<3){const e=t._recyclingRows.length;d=`<div title = "${s}" class="smart-truncate summary-value" > ${`<span style = "justify-content: flex-start" class="smart-truncate summary-value" > ${1===e?t.localize("oneRow"):t.localize("rows",{value:e})}</span> `} <span class="label">${s}</span>${o}</div> `}c.innerHTML!==d&&(c.innerHTML=d)}else if(t.summaryRow.editing&&l.allowSummary){if(t.columns[0].dataField===l.dataField){const e=t._recyclingRows.length,l=`<div class="smart-truncate summary-value"><span style="justify-content: flex-start" class="smart-truncate summary-value">${1===e?t.localize("oneRow"):t.localize("rows",{value:e})}</span><span class="smart-summary-placeholder label">${t.localize("summary")}</span><span class="smart-arrow-down"></span></div>`;c.innerHTML!==l&&(c.innerHTML=l)}else{const e=`<div class="smart-truncate summary-value"><span class="smart-summary-placeholder label">${t.localize("summary")}</span><span class="smart-arrow-down"></span></div>`;c.innerHTML!==e&&(c.innerHTML=e)}}t.summaryRow.editing&&l.allowSummary&&(t._selection&&t._selection.focusedCell&&t._selection.focusedCell.dataField===l.dataField?c.firstElementChild.setAttribute("has-summary",""):c.firstElementChild.removeAttribute("has-summary"),c.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),c._clickTarget=e.target},c.onpointerup=l=>{!0!==t._mobile&&c._clickTarget!==l.target||(l.preventDefault(),l.stopPropagation(),t._summaryRowDialog&&t._summaryRowDialog.classList.contains("open")&&t._summaryRowDialog.dataField===e.cell.column.dataField?t._summaryRowDialog.confirm():t._openSummaryRowDialog(e.cell,(()=>{})))})}}else if(t.rowDetail.enabled&&l.rowDetailColumn){let l="",a=t.appearance.showRowStatus||t.appearance.showRowComments?"smart-visibility-hidden":"";if(i.showDetail){l='<button tabindex="-1" class="'+a+' smart-animate" toggled toggle-button="" title="'+t.localize(i.showDetail?"collapseRow":"expandRow",{elementType:"Grid"})+'"></button>'}else{l='<button tabindex="-1" class="'+a+" smart-animate"+(t.rowDetail.dialog.enabled?" row-detail":"")+'" toggle-button="" title="'+t.localize(i.showDetail?"collapseRow":"expandRow",{elementType:"Grid"})+'"></button>'}if(t.appearance.showRowStatus){l=i._style&&i._style.status?`<span class="row-status custom" style = "color: ${i._style.status};" ></span> `+l:'<span class="row-status"></span>'+l,c.innerHTML===l||i.element.star?(i.element.star.classList.remove("smart-hidden"),i.element.star.classList.remove("custom"),i._style&&i._style.status?(i.element.star.style.color=i._style.status,i.element.star.classList.add("custom")):i.element.star.style.color=""):c.innerHTML=l;const a=()=>{if(i.comments&&i.comments.length>0){const e=i.comments.length;i.element.star.classList.add("comments"),i.element.star.setAttribute("title",t.localize(i.starred?"starred":"notStarred",{elementType:"Grid"})+", "+e+" "+t.localize("comments"))}else i.comments&&0===i.comments.length&&i.element.star.classList.remove("comments")};i.element.star=e.querySelector("span"),i.element.star||(c.innerHTML=l,i.element.star=e.querySelector("span")),i.element.star.onpointerdown=e=>{i.canNotify=!1,i.starred=!i.starred,i.canNotify=!0,i.data.$&&(i.data.$.starred=i.starred),i.starred?i.element.star.classList.add("starred"):i.element.star.classList.remove("starred"),i.element.star.setAttribute("title",t.localize(i.starred?"starred":"notStarred",{elementType:"Grid"})),a(),e.stopPropagation(),e.preventDefault(),t.$.fireEvent("rowStarred",{id:i.id,originalEvent:e,row:i,value:i.starred})},i.element.star.setAttribute("title",t.localize(i.starred?"starred":"notStarred",{elementType:"Grid"})),i.starred?i.element.star.classList.add("starred"):i.element.star.classList.remove("starred"),a()}else c.innerHTML!==l&&(c.innerHTML=l);if(i.element.toggleDetailButton=e.querySelector("button"),i.element.toggleDetailButton.setAttribute("title",t.localize(i.showDetail?"collapseRow":"expandRow",{elementType:"Grid"})),(t.rowDetail.template||t.onRowDetailInit)&&i.element.toggleDetailButton.classList.remove("smart-visibility-hidden"),i.comments&&i.comments.length>0){const e=i.comments.length;i.element.toggleDetailButton.classList.remove("smart-visibility-hidden"),t.appearance.showRowStatus?i.element.toggleDetailButton.querySelector(".comments-length")?i.element.toggleDetailButton.querySelector(".comments-length").innerHTML=e:i.element.toggleDetailButton.innerHTML+=`<div class="comments-length'>${e}</div>`:i.element.toggleDetailButton.innerHTML=`<div class="comments-length'>${e}</div>`,i.starred&&i.element.toggleDetailButton.classList.add("starred"),i.element.toggleDetailButton.classList.add("row-comments"),i.element.toggleDetailButton.setAttribute("title",t.localize(i.showDetail?"collapseRow":"expandRowComments",{value:e,elementType:"Grid"}))}else i.comments&&0===i.comments.length&&i.element.toggleDetailButton.classList.remove("row-comments");t.rowDetail.dialog.enabled&&i.element.toggleDetailButton.classList.add("row-detail")}else if(l.commandColumn)e._renderCommands();else if(t.appearance.showRowHeaderNumber&&l.rowHeaderColumn)if(i.addNewRow)c.textContent="";else{const l=l=>{if(e.cell.value)return e.cell.value;if("number"===t.appearance.autoGenerateRowLabelMode)return l.visibleIndex+1;{const e=l.visibleIndex%26,t=Math.floor(l.visibleIndex/26),i="A".charCodeAt(0),a=String.fromCharCode(i+e);let r="";for(let e=0;e<t;e++)r+="A";return r+a}};t._rowsAdded&&t._rowsAdded.indexOf(i.id)>=0?c.textContent="":c.textContent=l(i)}else if(u)if(e.removeAttribute("readonly"),t.appearance.displayLoadingIndicator&&!l.autoGenerated)c.innerHTML='<div class="smart-grid-cell-loading"></div>';else if(i._isMeasureRow)c.innerHTML=s;else switch(c.removeAttribute("title"),e.cell.template){case"checkBox":case"switchButton":case"radioButton":e._setTemplate(s,e.cell.template,c);break;case"tags":case"checklist":case"collaborator":case"updatedBy":case"createdBy":case"multiComboInput":e._setTemplate(s,e.cell.template,c);break;case"attachment":e._setTemplate(s,"attachments",c);break;case"image":e._setTemplate(s,"images",c);break;case"email":e._setTemplate(s,"email",c);break;case"url":e._setTemplate(s,"url",c);break;case"richText":e._setTemplate(s,"richText",c);break;default:e._setTemplate(s,e.cell.template,c)}else{const a=c.firstChild;if(a&&a.classList&&e.toggleButton&&l._treeColumn&&c.children[1]){const e=c.children[0],a=c.children[1].children[0],r=c.children[1].children[1].firstChild,n=c.children[1].children[2];let s="";if(l._treeColumn){if(t.grouping.enabled){let e=i.level-1;t.appearance.showRowHeaderNumber&&e--,t.rowDetail.enabled&&e--,e<-1?s="":"multipleColumns"!==t.grouping.renderMode&&(s+='<div style="width: '+(1+e)*t.grouping.groupIndent+'px;"></div>')}else for(let e=0;e<i.level;e++)s+="<div class='smart-indent'></div>";if(i.checked?r.setAttribute("checked",""):!1===i.checked?r.removeAttribute("checked"):null===i.checked&&r.setAttribute("checked","indeterminate"),i.leaf?i.allowCheck?r.classList.remove("smart-visibility-hidden"):r.classList.add("smart-visibility-hidden"):i.allowCheck?r.classList.remove("smart-hidden"):r.classList.add("smart-hidden"),!l.autoGenerated){const e=i["column_"+l.dataField];e&&e._setStyle(c)}}i.allowCheck?t.checkBoxes.visible?r.classList.remove("smart-hidden"):r.classList.add("smart-hidden"):t.checkBoxes.visible||r.classList.add("smart-hidden"),"card"===t.view&&(r.classList.add("smart-hidden"),a.classList.add("smart-hidden")),e.innerHTML=s,a.classList.add("smart-visibility-hidden"),i.leaf?a.classList.add("smart-visibility-hidden"):(a.classList.remove("smart-visibility-hidden"),i.expanded?a.setAttribute("toggled",""):a.removeAttribute("toggled","")),t.grouping.enabled&&a.classList.add("smart-hidden"),i.data.isEmpty&&a.classList.add("smart-visibility-hidden"),n.innerHTML=d,t.appearance.showTooltips?n.setAttribute("title",t._unescapeString(d)):n.hasAttribute("title")&&n.removeAttribute("title")}else{const a=i["column_"+l.dataField];if(e.getAttribute("rowspan")&&(e.removeAttribute("rowspan"),e.removeAttribute("aria-rowspan"),e.style.height=""),e.getAttribute("colspan")&&(e.removeAttribute("colspan"),e.removeAttribute("aria-colspan")),a){if(a.colSpan>1){const i=t.columns.indexOf(l);let r=0;for(let e=i;e<i+a.colSpan;e++){const l=t.columns[e];l&&l.visible&&(r+=l.computedWidth)}e.style.width=r+"px",e.setAttribute("colspan",""),e.setAttribute("aria-colspan",a.colSpan),a._styleChanged=!0}let r=a.rowSpan;if(a.rowSpan>1){const l=t.rows.indexOf(i);let r=0;i.element.setAttribute("rowspan","");for(let e=l;e<=l+a.rowSpan-1;e++){const l=t.rows[e];l&&l.visible&&l.filtered&&(r+=l.cellHeight)}e.style.height=r+"px",e.setAttribute("rowspan",""),e.setAttribute("aria-rowspan",a.rowSpan),a._styleChanged=!0}else if(l.rowSpan&&!i._isMeasureRow){const n="number"==typeof l.rowSpan?l.rowSpan:l.rowSpan(s,i.visibleIndex,i.data),o=i.visibleIndex;let d=!1;for(let e=0;e<t._cellRowSpan.length;e++){const l=t._cellRowSpan[e];if(o>l[0]&&o<l[1]){d=!0;break}}if(i._rowSpan=n,n&&!d){let s=0;t._cellRowSpan.push([o,o+n,l.dataField]),t._cellRowSpan.maxSpan||(t._cellRowSpan.maxSpan=1),t._cellRowSpan.maxSpan=Math.max(n,t._cellRowSpan.maxSpan),i.element.setAttribute("rowspan","");for(let e=o;e<=o+n-1;e++){const l=t.rows[e];l&&l.visible&&l.filtered&&(s+=l.cellHeight)}e.style.height=s+"px",e.setAttribute("rowspan",""),e.setAttribute("aria-rowspan",n),a._styleChanged=!0,r=n}}if(1===a.colSpan&&e.hasAttribute("colspan")&&(e.style.width=l.computedWidth+"px",e.removeAttribute("colspan"),e.removeAttribute("aria-colspan"),a._styleChanged=!0),e.hasAttribute("rowspan")&&1===r&&(e.style.height="",e.removeAttribute("rowspan"),e.removeAttribute("aria-rowspan"),a._styleChanged=!0),c.textContent===d||l.formatFunction||("string"==typeof d&&d.indexOf("&")>=0?"card"===t.view?c.innerHTML=d:t.isScrolling?requestAnimationFrame((()=>{c.innerHTML=d})):c.innerHTML=d:c.textContent=d),a.column.autoGenerated||a._setStyle(c),t.appearance.showTooltips?(d&&(""+d).indexOf("&#")>=0&&(d=t._fromHTMLEntities(d)),c.setAttribute("title",a.tooltip||t._unescapeString(d))):c.hasAttribute("title")&&c.removeAttribute("title"),t.appearance.showTooltipsOverflow&&(!t.appearance.showTooltips&&c.hasAttribute("title")&&c.removeAttribute("title"),d&&d.length)){14*(d||"").length*.52>l.computedWidth?(d&&(""+d).indexOf("&#")>=0&&(d=t._fromHTMLEntities(d)),"image"!==l.template&&"attachment"===l.template&&c.setAttribute("title",a.tooltip||t._unescapeString(d))):!t.appearance.showTooltips&&c.hasAttribute("title")&&c.removeAttribute("title")}}else c.textContent=d}}if(c.className!==p&&(c.className=p),!t.appearance.displayLoadingIndicator||l.autoGenerated||t.dataSource.boundHierarchy?t.appearance.displayLoadingIndicator&&l.selectionColumn?e.removeAttribute("selected"):!l.autoGenerated&&c.firstChild&&c.firstChild.classList&&c.firstChild.classList.contains("smart-grid-cell-loading")&&(c.firstChild.classList.remove("smart-grid-cell-loading"),e.removeAttribute("selected")):(i.element.removeAttribute("focus"),e.removeAttribute("selected"),c.innerHTML='<div class="smart-grid-cell-loading"></div>'),l.formatFunction&&!i.data.isEmpty&&t.isInitialized&&!i.summaryRow){const a={row:i,column:l,cell:e.cell,oldValue:e.cell.oldValue,value:s,formattedValue:d,template:null};e.cell.canNotify=!1,i.canNotify=!1;const r=Object.assign({},{background:e.cell.background,color:e.cell.color,fontSize:e.cell.fontSize,fontFamily:e.cell.fontFamily,textDecoration:e.cell.textDecoration,fontWeight:e.cell.fontWeight,fontStyle:e.cell.fontStyle});if(t.hasAttribute("smart-blazor"))await l.formatFunction(a);else{const e=l.formatFunction(a);e&&(a.value=e)}c.style.background===r.background&&c.style.color===r.color&&c.style.fontSize===r.fontSize&&c.style.fontFamily===r.fontFamily&&c.style.textDecoration===r.textDecoration&&c.style.fontWeight===r.fontWeight&&c.style.fontStyle===r.fontStyle||(e.cell._styleChanged=!0,e.cell._setStyle(c)),e.cell.background===r.background&&e.cell.color===r.color&&e.cell.fontSize===r.fontSize&&e.cell.fontWeight===r.fontWeight&&e.cell.textDecoration===r.textDecoration&&e.cell.fontFamily===r.fontFamily&&e.cell.fontStyle===r.fontStyle||(e.cell._styleChanged=!0,e.cell._setStyle(c));let n=!0;if(a.value!==s){if(e.toggleButton){c.children[1].children[2].innerHTML=a.value}else c.innerHTML=a.value;n=!1}if(null!==a.template){if(e.toggleButton){if(c.children[1]){const e=c.children[1].children[2];e.innerHTML!==a.template&&(e.innerHTML=a.template)}}else if(c.innerHTML!==a.template){const e=document.createElement("div");e.innerHTML=a.template,e.innerHTML!==c.innerHTML&&(c.innerHTML=a.template)}n=!1}n&&(l.cellsFormat?c.textContent=d:c.textContent=s),e.cell.canNotify=!0,i.canNotify=!0}if(!i.data.isEmpty&&t.isInitialized&&e._applyConditionalFormattingToCell(e.cell,t,c),t.grouping.enabled&&t.dataSource&&t.dataSource.groupBy.length>0&&l===t._firstVisibleColumn&&t.rowDetail.enabled&&t.rowDetail.visible&&c.querySelector("[toggle-button]")){const e=c.querySelector("[toggle-button]");e.classList.remove("smart-visibility-hidden"),e.classList.add("row-detail"),i.element.toggleDetailButton=e,i.element.toggleDetailButton.setAttribute("title",t.localize(i.showDetail?"collapseRow":"expandRow",{elementType:"Grid"})),e.onpointerdown=function(e){i.showDetail=!i.showDetail,e.stopPropagation(),e.preventDefault()}}}_autoWrap(){const e=this,t=e.firstChild,l=e.cell.grid;l.layout.allowCellsWrapShortcut&&e.hasAttribute("focus")&&e.hasAttribute("selected")&&(t.offsetWidth<t.scrollWidth?e._popupCellContent(t.innerHTML,e.cell):l._cellContentPopup&&l._cellContentPopup.remove())}_popupCellContent(e,t){const l=this,i=t.grid;let a=i._cellContentPopup;if(!i._cellContentPopup){a=document.createElement("div");const t=document.createElement("span"),l=document.createElement("div"),r=document.createElement("div");a.style.minHeight="0px",a.style.minWidth="0px",a.setAttribute("theme",i.theme),a.classList.add("smart-grid-cell-content-popup"),r.appendChild(l),r.classList.add("smart-grid-text-area-container"),l.innerHTML=e,l.classList.add("smart-grid-cell-content-popup-content"),t.classList.add("smart-hidden"),t.classList.add("close-button"),t.classList.add("smart-grid-icon"),t.classList.add("smart-icon-cancel-circled"),t.onclick=function(){i._cellContentPopup.parentNode.removeChild(i._cellContentPopup)},a.classList.add("smart-grid-text-area-dialog"),a.appendChild(r),a.appendChild(t),i._cellContentPopup=a}a.querySelector(".smart-grid-cell-content-popup-content").innerHTML=e;const r=i.offset(i.$.scrollView);a.style.top=i._offsetTop(l)-r.top+"px",a.style.left=i._offsetLeft(l)-r.left+"px",a.style.width=l.offsetWidth-4+"px",i.$.scrollView.appendChild(a)}_applyConditionalFormattingToCell(e,t,l){const i=this,a=e.column.dataField,r=e.row,n=e.row.index,s=r._style,o=r.data&&r.data.$?r.data.$.id:null;if(e.column.autoGenerated){const l=t._conditionalColors;if(l&&e.column.rowHeaderColumn)if("border"===l.decorate){const t=l.colors;t&&t[o]?(e.element.classList.add("smart-decorate"),e.element.style.setProperty("--smart-decorate-color",t[o].color)):e.element.classList.remove("smart-decorate")}else e.element.classList.remove("smart-decorate")}else{if(t._conditionalColors){const n=t._conditionalColors;if("border"!==n.decorate){const t=n.colors;if(t&&t[o]){const s="cell"===n.decorate?t[o][a]:t[o].color;if(s){const t=new Smart.Color(s).getInvertedColor();i.cell.canNotify=!1,r.canNotify=!1,e.background=s,e.color=t,i.cell._setStyle(l),i.cell.canNotify=!0,r.canNotify=!0}else e.background&&e.color&&(i.cell.canNotify=!1,r.canNotify=!1,e.background=null,e.color=null,i.cell._setStyle(l),i.cell.canNotify=!0,r.canNotify=!0)}else e.background&&e.color&&(i.cell.canNotify=!1,r.canNotify=!1,e.background=null,e.color=null,s&&(e._styleChanged=!0,e.background=s.background,e.color=s.color),i.cell._setStyle(l),i.cell.canNotify=!0,r.canNotify=!0)}else e.background&&e.color&&(i.cell.canNotify=!1,r.canNotify=!1,e.background=null,e.color=null,s&&(e._styleChanged=!0,e.background=s.background,e.color=s.color),i.cell._setStyle(l),i.cell.canNotify=!0,r.canNotify=!0)}if(t._conditionalFormatting&&t._conditionalFormatting[a]){const e=t._conditionalFormatting[a][n];i.cell.canNotify=!1,r.canNotify=!1,e?(i.cell._styleChanged=!0,i.cell.background=e.background,i.cell.color=e.color,i.cell.fontFamily=e.fontFamily,i.cell.fontSize=e.fontSize,i.cell._setStyle(l)):i.cell._styleChanged||(s&&s._changed?(i.cell._styleChanged=!0,i.cell.background=s.background,i.cell.color=s.color,i.cell.fontFamily=s.fontFamily,i.cell.fontSize=s.fontSize,i.cell._setStyle(l)):(i.cell._styleChanged=!0,i.cell.background=null,i.cell.color=null,i.cell.fontFamily=null,i.cell.fontSize=null,i.cell._setStyle(l))),i.cell.canNotify=!0,r.canNotify=!0}else t._conditionalFormattingChanged&&!i.cell._styleChanged&&(i.cell.canNotify=!1,r.canNotify=!1,s&&s._changed?(i.cell._styleChanged=!0,i.cell.background=s.background,i.cell.color=s.color,i.cell.fontFamily=s.fontFamily,i.cell.fontSize=s.fontSize,i.cell._setStyle(l)):(i.cell._styleChanged=!0,i.cell.background=null,i.cell.color=null,i.cell.fontFamily=null,i.cell.fontSize=null,i.cell._setStyle(l)),i.cell.canNotify=!0,r.canNotify=!0)}}_rotateCellContent(e,t,l){const i=document.createElement("span");return e.innerHTML="",i.innerHTML=l,e.appendChild(i),i.className="rotate",i.style.transform="rotate("+t.cellsRotationAngle+"deg)",this.grid._recycleRotate(e,i,t.cellsAlign,t.cellsVerticalAlign,l)}_getCellAlignment(e,t){const l=e["column_"+t.dataField],i=l&&l.verticalAlign||t.cellsVerticalAlign;let a=l&&l.align||t.cellsAlign;const r={align:"",verticalAlign:""};if(!l)return{align:"align-left",verticalAlign:"align-middle"};switch(l.grid.rightToLeft&&("left"===a?a="right":"right"===a&&(a="left")),a){case"left":r.align="align-left";break;case"center":case"middle":r.align="align-center";break;case"right":r.align="align-right"}switch(i){case"top":r.verticalAlign="align-top";break;case"center":case"middle":r.verticalAlign="align-middle";break;case"bottom":r.verticalAlign="align-bottom"}return r}template(){return""}_detach(){this.element=null,this.cell=null}onDetached(){this._detach()}});class e{render(e){const t=this,l={svg:null,width:e.width||100,height:e.height||30,gap:e.gap||5,strokeWidth:e.strokeWidth||2,type:e.type||"column",colors:e.colors||["var(--smart-primary)"],points:e.points,labels:e.labels,colorFunction:e.colorFunction,tooltipFormatFunction:e.tooltipFormatFunction,min:e.min,max:e.max};switch(l.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),l.svg.setAttribute("width",l.width),l.svg.setAttribute("height",l.height),function(e){Array.isArray(e.colors)||(e.colors=t.colors.split(",")),e.points&&(e.points=e.points.split(",").map((e=>parseInt(e,10))))}(l),l.type){case"column":return t.column(l);case"bar":return t.bar(l);case"line":return t.line(l);case"pie":return t.pie(l);case"stacked":return t.stacked(l)}}colorFunction(e,t){const l=function(e,t){e===t&&(t=e+100);const l=(t-e)/5;return[e+l,e+2*l,e+3*l,e+4*l]}(e,t),i=["#D50000","#F4511E","#F6BF26","#039BE5","#33B679"];return e=>e<l[0]?i[0]:e<l[1]?i[1]:e<l[2]?i[2]:e<l[3]?i[3]:i[4]}column(e){const t=e.gap/e.points.length+e.width/e.points.length-e.gap,l=e.max||Math.max(...e.points),i=e.min||Math.min(...e.points),a=e.height/(Math.abs(i)+Math.abs(l)),r=Math.abs(i)*a;return e.colorFunction||(e.colorFunction=this.colorFunction(i,l)),e.points.forEach(((n,s)=>{isNaN(n)&&(n=0);const o=document.createElementNS("http://www.w3.org/2000/svg","rect"),d=Math.abs(n)*a;o.setAttribute("x",s*t+s*e.gap),o.setAttribute("point",n);let c=n>=0?"var(--smart-primary)":"var(--smart-error)";if(l>0&&i<0?n>=0?o.setAttribute("y",e.height-r-1-d):o.setAttribute("y",e.height-r-1):l>=0&&i>=0?o.setAttribute("y",e.height-d):i<=0&&l<=0&&o.setAttribute("y",d),o.setAttribute("width",t),o.setAttribute("height",d),e.colorFunction){const t=e.colorFunction(n);t&&(c=t)}o.setAttribute("fill",c);const m=e.tooltipFormatFunction?e.tooltipFormatFunction(n):n;o.setAttribute("data-title",m),e.svg.appendChild(o)})),e.svg.outerHTML}bar(e){const t=e.height-3,l=Math.max(5,e.gap/e.points.length+t/e.points.length-e.gap),i=e.max||Math.max(...e.points),a=e.min||Math.min(...e.points);let r=e.width/(Math.abs(a)+Math.abs(i));const n=Math.abs(a)*r;return e.colorFunction||(e.colorFunction=this.colorFunction(a,i)),e.points.forEach(((t,s)=>{isNaN(t)&&(t=0);const o=document.createElementNS("http://www.w3.org/2000/svg","rect"),d=Math.abs(t)*r;o.setAttribute("y",s*l+s*e.gap),o.setAttribute("point",t);let c=t>=0?"var(--smart-primary)":"var(--smart-error)";if(i>0&&a<0?t>=0?o.setAttribute("x",n):o.setAttribute("x",n-d):(i>=0&&a>=0||a<=0&&i<=0)&&o.setAttribute("x",0),o.setAttribute("width",d),o.setAttribute("height",l),e.colorFunction){const l=e.colorFunction(t);l&&(c=l)}o.setAttribute("fill",c);const m=e.tooltipFormatFunction?e.tooltipFormatFunction(t):t;o.setAttribute("data-title",m),e.svg.appendChild(o)})),e.svg.outerHTML}line(e){const t=e.width/(e.points.length-1),l=e.max||Math.max(...e.points),i=e.min||Math.min(...e.points),a=e.height/(Math.abs(i)+Math.abs(l)),r=Math.abs(i)*a;e.colorFunction||(e.colorFunction=this.colorFunction(i,l));let n="var(--smart-primary)",s=[],o=[];e.svg.setAttribute("overflow","visible");for(let l=0;l<e.points.length;l++){let i=e.points[l];isNaN(i)&&(i=0);const n=l*t,d=e.height-r-i*a;o.push({x:n,y:d,point:i}),2===o.length&&(s.push(o),o=[]),s.length>0&&0===o.length&&o.push(s[s.length-1][1])}for(let t=0;t<s.length;t++){const l=s[t];if(e.colorFunction){const t=e.colorFunction(l[0].point);t&&(n=t)}if(0===t){const t=document.createElementNS("http://www.w3.org/2000/svg","circle");e.svg.appendChild(t),t.setAttribute("cx",l[0].x),t.setAttribute("cy",l[0].y),t.setAttribute("r",3),t.setAttribute("fill",n);const i=e.tooltipFormatFunction?e.tooltipFormatFunction(l[0].point):l[0].point;t.setAttribute("data-title",i),t.style.display="none"}const i=document.createElementNS("http://www.w3.org/2000/svg","line");e.svg.appendChild(i),i.setAttribute("x1",l[0].x),i.setAttribute("y1",l[0].y),i.setAttribute("x2",l[1].x),i.setAttribute("y2",l[1].y);const a=document.createElementNS("http://www.w3.org/2000/svg","circle");e.svg.appendChild(a),a.setAttribute("cx",l[1].x),a.setAttribute("cy",l[1].y),a.setAttribute("r",3),a.setAttribute("fill",n);const r=e.tooltipFormatFunction?e.tooltipFormatFunction(l[1].point):l[1].point;a.setAttribute("data-title",r),a.style.display="none",i.setAttribute("fill","none"),i.setAttribute("stroke-width",e.strokeWidth),i.setAttribute("stroke",n)}return e.svg.outerHTML}pie(e){const t=Math.min(e.width,e.height)/2,l=e.width/2,i=e.height/2,a=e.points.reduce(((e,t)=>e+Math.abs(t)),0);let r=0;const n=e.max||Math.max(...e.points),s=e.min||Math.min(...e.points);return e.colorFunction||(e.colorFunction=this.colorFunction(s,n)),e.points.forEach((n=>{isNaN(n)&&(n=0);let s=e.color;if(e.colorFunction){const t=e.colorFunction(n);t&&(s=t)}const o=Math.abs(n)/a*2*Math.PI,d=r+o,c=l+t*Math.cos(r),m=i+t*Math.sin(r),u=l+t*Math.cos(d),p=i+t*Math.sin(d),g=document.createElementNS("http://www.w3.org/2000/svg","path"),f=o>Math.PI?1:0,h=`M ${l},${i} L ${c},${m} A ${t},${t} 0 ${f} 1 ${u},${p} Z`;g.setAttribute("d",h),g.setAttribute("fill",s);const b=e.tooltipFormatFunction?e.tooltipFormatFunction(n):`${(n/a*100).toFixed(2)}%`;g.setAttribute("data-title",b),e.svg.appendChild(g),r=d})),e.svg.outerHTML}stacked(e){let t=e.points.reduce(((e,t)=>e+t),0),l=(e.points.length-1)*e.gap,i=e.width-l;const a=e.max||Math.max(...e.points),r=e.min||Math.min(...e.points);e.colorFunction||(e.colorFunction=this.colorFunction(r,a));let n=0;return e.points.forEach(((l,a)=>{isNaN(l)&&(l=0);let r=e.colors[a%e.colors.length];if(e.colorFunction){const t=e.colorFunction(l);t&&(r=t)}const s=l/t*i,o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x",n),o.setAttribute("y",0),o.setAttribute("width",s),o.setAttribute("height",e.height),o.setAttribute("fill",r);const d=document.createElementNS("http://www.w3.org/2000/svg","title");d.textContent=l,o.appendChild(d),e.svg.appendChild(o),n+=s+e.gap})),e.svg.outerHTML}}})();