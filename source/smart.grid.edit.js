
/* Smart UI v23.1.19 (2025-06-17) 
Copyright (c) 2011-2024 jQWidgets. 
License: https://htmlelements.com/license/ */ //

(()=>{Smart.Utilities.Assign("Grid.Edit",class{_renderCommandBar(){const e=this,t=e.editing.commandBar.dataSource,i="icon"!==e.editing.commandBar.displayMode,n="label"!==e.editing.commandBar.displayMode,l=l=>{for(let o in t){const a=t[o],r=document.createElement("div");r.classList.add("smart-grid-command-item"),r.label="{{messages}}"===a.label?e.localize(o):a.label;const d=r.label;let s="";n&&i?(s+='<span class="smart-grid-icon '+a.icon+'"></span>',s+='<span class="smart-grid-label">'+d+"</span>"):n&&!i?s+='<span title="'+d+'" class="smart-grid-icon '+a.icon+'"></span>':i&&!n&&(s+='<span class="smart-grid-label">'+d+"</span>"),r.innerHTML=s,a.visible||r.classList.add("smart-hidden"),r.command=a.command,r.onclick=function(){const t=r.command;e._applyCommand(t,[])},l.appendChild(r)}};e.editing.enabled&&e.editing.commandBar.visible&&(e.$.headerCommandBar.innerHTML="",e.$.footerCommandBar.innerHTML="","far"!==e.editing.commandBar.position&&l(e.$.headerCommandBar),"near"!==e.editing.commandBar.position&&l(e.$.footerCommandBar))}commandKeyEditCommand(){const e=this;if(e._selection&&e._selection.focusedCell&&void 0!==e._selection.focusedCell.id){const t=e.rowById[e._selection.focusedCell.id];e.beginEdit(t.id)}}commandKeyCancelCommand(){this.cancelEdit()}commandKeyUpdateCommand(){this.endEdit()}commandColumnMenuCommand(){this._openColumnChooserMenu(this._commandColumn)}commandColumnEditCommand(e){const t=this;t._disableEndEdit=!0;const i=t._scrollView.vScrollBar.value===t._scrollView.vScrollBar.max;t.beginEdit(e.id),i&&(t._scrollView.vScrollBar.value=t._scrollView.vScrollBar.max),setTimeout((()=>{delete t._disableEndEdit}),50)}commandColumnUpdateCommand(){this.endEdit()}commandColumnRowMenuCommand(){}commandColumnCancelCommand(e){const t=this;if(t.editing.batch){const i=t._rowsDeleted?t._rowsDeleted.indexOf(e):-1;i>=0&&t._rowsDeleted.splice(i,1);for(let i=0;i<t.columns.length;i++){const n=t.columns[i].dataField;t._cellsUpdatedValues&&t._cellsUpdatedValues[e.id+"_"+n]&&(delete t._cellsUpdatedValues[e.id+"_"+n],t._cellsUpdatedValues.length--)}t._recycle(!1)}t.cancelEdit()}commandColumnDeleteCommand(e){this.deleteRow(e.id)}_renderAddNewRow(){const e=this;e._frozenNearDefaultRows=[],e._frozenFarDefaultRows=[];const t=new Smart.Grid.Row({data:{},index:-1,grid:e,freeze:"near",visible:"far"!==e.editing.addNewRow.position,autoGenerated:!0,addNewRow:!0}),i=new Smart.Grid.Row({data:{},index:-2,grid:e,freeze:"far",visible:"near"!==e.editing.addNewRow.position,autoGenerated:!0,addNewRow:!0});if(e._newNearRow){const t=e._frozenNearRows.indexOf(e._newNearRow);if(t>=0&&(e._frozenNearRows.splice(t,1),e.$.rowNearContainer.children.length>0)){const t=e.$.rowNearContainer.children[0];t.parentNode.removeChild(t)}}if(e._newFarRow){const t=e._frozenFarRows.indexOf(e._newFarRow);if(t>=0&&(e._frozenFarRows.splice(t,1),e.$.rowFarContainer.children.length>0)){const t=e.$.rowFarContainer.children[e.$.rowFarContainer.children.length-1];t.parentNode.removeChild(t)}}e.editing.addNewRow.visible&&"button"!==e.editing.addNewRow.displayMode&&(e._frozenNearDefaultRows.push(t),e._frozenFarDefaultRows.push(i),e._frozenNearRows.splice(0,0,t),e._frozenFarRows.push(i));const n=()=>{e.editing.addNewRow.autoCreate&&e._scrollView.vScrollBar.value===e._scrollView.vScrollBar.max&&(e.addUnboundRow(1),e._scrollView.vScrollBar.value=e._scrollView.vScrollBar.max),"button"===e.editing.addNewRow.displayMode&&e._scrollView.vScrollBar.value===e._scrollView.vScrollBar.max&&(e._add({}),e._scrollView.vScrollBar.value=e._scrollView.vScrollBar.max)};if(e._addRowOnButtonClickHandler||(e._addRowOnButtonClickHandler=n),e._scrollView&&e._scrollView.vScrollBar&&(e._scrollView.vScrollBar.$.farButton.removeEventListener("click",e._addRowOnButtonClickHandler),e._scrollView.vScrollBar.$.farButton.addEventListener("click",e._addRowOnButtonClickHandler)),e._newNearRow=t,e._newFarRow=i,e.editing.addNewRow.visible&&"button"!==e.editing.addNewRow.displayMode){if(!e._newNearRow.element){const t=e._newNearRow,i=t.createElement();t.visible="far"!==e.editing.addNewRow.position,t.element=i,e.$.rowNearContainer.children.length>0?e.$.rowNearContainer.insertBefore(i,e.$.rowNearContainer.children[0]):e.$.rowNearContainer.appendChild(i)}if(!e._newFarRow.element){const t=e._newFarRow,i=t.createElement();t.visible="near"!==e.editing.addNewRow.position,t.element=i,e.$.rowFarContainer.children.length>0?e.$.rowFarContainer.insertBefore(i,e.$.rowFarContainer.children[0]):e.$.rowFarContainer.appendChild(i)}}}_insertNewRowAfter(e){return this._insertNewRowBefore(e,!0)}_insertNewRowBefore(e,t=!1){const i=this,n=new Smart.Grid.Row({index:t?0:-1,id:Smart.Utilities.Core.createGUID(),grid:i}),l={};for(let e=0;e<i.columns.length;e++){const t=i.columns[e];void 0!==t.defaultValue?l[t.dataField]=t.defaultValue:"uuid"===t.template&&(dataRow[t.dataField]=i._generateUUID())}n.data=l;const o=function(t,n){i._suppressSort=i._suppressFilter=!0;const l=e=>{i._supressEnter=!0,i.scrollTop=n?i.scrollHeight:0,i.editing.addDialog.enabled||setTimeout((function(){if(i.editing.enabled&&i.editing.addNewRow.autoEdit){i.ensureVisible(e.id);let t=null;if(!t)if(i.columns[0]&&i.columns[0].allowEdit&&i.columns[0].visible)t=i.columns[0].dataField;else for(let e=0;e<i.columns.length;e++)if(i.columns[e].allowEdit&&i.columns[e].visible){t=i.columns[e].dataField;break}const n=()=>{i._selection.focusedCell={id:e.id,dataField:t,index:e.index},i._selection.rows=[],i._selection.columns=[],i._selection.cells=[],i._setSelection(e.id,t)};i.paging.enabled?setTimeout((()=>{if(!e.element){const t=e.createElement();e.element=t}n(),i._beginEdit(e)}),200):(n(),i._beginEdit(e))}}),100),i._suppressSort=i._suppressFilter=!1},o=i.dataSource&&i.dataSource.virtualDataSource&&!i.dataSource.virtualDataSourceOnExpand&&"infinite"!==i.scrolling;!0===i.editing.batch||i.editing.batch&&i.editing.batch.indexOf("add")>=0?(i._batchAddRow(t,n?i.rows.length:0),o||l(t),e&&e(t)):i.addRow(t.data,n,(t=>{o||l(t),e&&e(t)}))}.bind(this);return i.editing.addDialog.enabled?i._openAddRowDialog(n,o):o(n,t),!0}commandBarBatchSaveCommand(){this._saveBatchEdit()}commandBarAddRowCommand(){this._insertNewRowAfter()}commandBarAddTopRowCommand(){this._insertNewRowBefore()}commandBarDeleteRowCommand(){const e=this;let t=1,i=e.rows[e.rows.length-t];for(e._rowsDeleted||(e._rowsDeleted=[]);e._rowsDeleted.indexOf(e.rows[e.rows.length-t])>=0;)t++;if(i=e.rows[e.rows.length-t],e.selection.enabled)if(e.selection.allowCellSelection){const t=e.getSelectedCells();if(t.length>0){const n=t[0][0];i=e.rowById[n]}}else{const t=e.getSelectedRowIds();t.length>0&&(i=e.rowById[t[0]])}i&&e.commandColumnDeleteCommand(i)}commandBarBatchRevertCommand(){this.revertBatchEdit()}_beginEdit(e,t){const i=this;if(!t)if(i.columns[0]&&i.columns[0].allowEdit&&i.columns[0].visible)t=i.columns[0].dataField;else for(let e=0;e<i.columns.length;e++)if(i.columns[e].allowEdit&&i.columns[e].visible){t=i.columns[e].dataField;break}const n=i.columnByDataField[t];if(i.editing.allowColumnHeaderEdit&&!e&&n)return void i._beginColumnEdit(n);if(!e||!n||n&&n.autoGenerated)return!1;const l=e.getCell(t);if(!l)return!1;i.$.fireEvent("beginEdit",{id:e.id,dataField:n.dataField,row:e,column:n,cell:l,data:l.row.data,value:l.value}).defaultPrevented||("cell"===i.editing.mode?i._beginCellEdit(l):"row"===i.editing.mode&&i._beginRowEdit(e,l))}_saveUnboundRows(e){const t=this;if(t._unboundRows&&t._unboundRows.length>0&&t.editing.addNewRow.autoSave){const i=t.rowById[e];if(!i.unbound)return;const n=t._unboundRows.indexOf(i);if(n<0)return;const l=n+1;t.beginUpdate();for(let e=0;e<l;e++){const i=t._unboundRows[e];if(!i)continue;delete t.rowById[i.id],i.unbound=!1;let n=!1;t._selection.focusedCell&&t._selection.focusedCell.id===i.id&&(n=!0),t._nearRowsAdded&&t._nearRowsAdded.indexOf(i)>=0?(t._nearRowsAdded.splice(t._nearRowsAdded.indexOf(i),1),t._add(0,i.data),n&&(t._selection.focusedCell.id=t.rows[0].id,t._selection.focusedCell.index=t.rows[0].index)):t._farRowsAdded&&t._farRowsAdded.indexOf(i)>=0&&(t._farRowsAdded.splice(t._farRowsAdded.indexOf(i),1),t._add(i.data),n&&(t._selection.focusedCell.id=t.rows[t.rows.length-1].id,t._selection.focusedCell.id=t.rows[t.rows.length-1].index))}t._unboundRows.splice(0,l),t.endUpdate()}}_validateCell(e,t,n){const l=this;if(l._errorOverlay&&(l._errorOverlay.remove(),l._errorMessage&&l._errorMessage.remove(),l._isUpdating=!1),e.column.validationRules||n||e.column.editor&&e.column.editor.onValidate){let o={},a=e._updating;if(e._updating=!0,e.error="",n){for(let i in n)n[i]&&"valid"!==i&&(e.error=n.message),"custom"===i&&n[i].minLength?e.error=l.localize("invalidCellValue",{value:t,validationRule:"minLength: "+n[i].value}):"custom"===i&&n[i].maxLength&&(e.error=l.localize("invalidCellValue",{value:t,validationRule:"maxLength: "+n[i].value}));e.error&&(l._isUpdating=!0)}for(let n of e.column.validationRules){switch(n.type){case"min":o.min=i.min(t,n.value);break;case"max":o.max=i.max(t,n.value);break;case"minLength":o.minLength=i.minLength(t,n.value);break;case"maxLength":o.maxLength=i.maxLength(t,n.value);break;case"minDate":o.minDate=i.minDate(t,n.value);break;case"maxDate":o.maxDate=i.maxDate(t,n.value);break;case"required":o.required=i.required(t);break;case"requiredTrue":o.requiredTrue=i.requiredTrue(t);break;case"pattern":o.pattern=i.pattern(t,n.value);break;case"email":o.email=i.email(t);break;case"null":o.null=i.null(t)}o[n.type]&&(n.message?e.error=n.message:e.error=l.localize("invalidCellValue",{value:t,validationRule:void 0!==n.value?n.type+": "+n.value:n.type}),e._updating=a,l._isUpdating=!0,e.element&&e.element.setAttribute("error",e.error),e.row.element.setAttribute("error",""))}if(e.column.editor&&e.column.editor.onValidate){const i=e.column.editor.onValidate(t,e.row.data);"string"==typeof i&&(e.error=i,e._updating=a,l._isUpdating=!0,e.element&&e.element.setAttribute("error",e.error),e.row.element.setAttribute("error",""))}if(e._updating=a,e.error){l._errorOverlay=l._createOverlay(),l._errorOverlay.onpointerdown=function(){l.endEdit()};const t=document.createElement("div");t.innerHTML=e.error,t.classList.add("smart-grid-validation-error");const i=l.offset(e.element),n=e.element.getBoundingClientRect(),o=l.offset(l);return i.left=i.left,i.top=i.top,i.top+n.height+5-l.offsetTop>l.offsetHeight?t.style.top=i.top-n.height-o.top-5+"px":t.style.top=i.top+n.height-o.top+5+"px",t.style.left=i.left-o.left+"px",l._errorMessage=t,l.$.root.appendChild(l._errorOverlay),l.$.root.appendChild(l._errorMessage),e.editor&&e.editor.instance&&e.editor.instance.focus(),!1}l._isUpdating=!1}return!0}hideCellMessage(){const e=this;if(e._messageOverlay){e._messageOverlay.remove();for(let t in e._message)e._message[t].remove();delete e._message,delete e._messageOverlay}}showCellMessage(e,t,i){const n=this,l=n.rowById[e].getCell(t);n._messageOverlay||(n._messageOverlay=n._createOverlay(),n._messageOverlay.onpointerdown=function(){n.hideCellMessage()});const o=document.createElement("div");o.innerHTML=i,o.classList.add("smart-grid-cell-notification");const a=n.offset(l.element),r=l.element.getBoundingClientRect(),d=n.offset(n);a.left=a.left,a.top=a.top,a.top+r.height+5-n.offsetTop>n.offsetHeight?o.style.top=a.top-r.height-d.top-5+"px":o.style.top=a.top+r.height-d.top+5+"px",o.style.left=a.left+"px",n._message||(n._message=[]),n._message.push(o),n._messageOverlay.parentNode||n.$.root.appendChild(n._messageOverlay),n.$.root.appendChild(o)}_endCellEdit(e){const t=this,i=e||t.editing.editCell;if(!i||i&&!i.isEditing)return null;let n=t._getEditorValue(i),l=null;if(n&&n.error&&(i.canNotify=!1,i.element.setAttribute("error",""),i.row.element.setAttribute("error",""),i.error=!0,i.canNotify=!0,l=n.validity,n=n.value),"string"===i.column.dataType&&t.formulas&&n&&"string"==typeof n){if(i.formula!==n){const e=i.canNotify;i.canNotify=!1,n.startsWith("=")?i.formula=t._unescapeString(n):i.formula=null,i.canNotify=e}if(n.startsWith("=")&&i.formula){const e=t._formulaParser;if(e){let t=e.parse(i.formula.slice(1));n=isNaN(t)?"#VALUE!"===n?0:"#ERROR!"===n?"#ERROR!":t:t}}}const o=function(e,t){return"date"===i.column.dataType?e&&t?e.valueOf()===t.valueOf():!e&&!t:!("any"!==i.column.dataType||void 0===e||void 0===t||!Array.isArray(e)||0!==e.length||""!==t)||(!(null!=t&&""!==t||null!==e&&""!==e)||e===t)},a=function(){const e=t._getEditorId(i);t._cellEditors[e].detach(),i.row.element.removeAttribute("edit"),i.element&&(i.element.removeAttribute("editor"),i.element.removeAttribute("error")),i.row.element.removeAttribute("error"),i.isEditing=!1,i.element&&(i.element.content.innerHTML="");const l=function(){t.editing.editRow||(t.dataSource&&t.dataSource.boundHierarchy?(t.dataSource.refreshHierarchy(),t._refreshRowHierarchy(),t.refresh()):t.layout.allowCellsWrap?t.refresh():t._recycle(!1))},a=t._cellsUpdatedValues?t._cellsUpdatedValues[i.row.id+"_"+i.column.dataField]:void 0,r=void 0!==a?a:i.value,d=()=>{if(t._fireEndEdit){let e=i.value;if(t.editing.batch&&i.row&&i.column){const t=i.modifiedValue;void 0!==t&&(e=t)}t.$.fireEvent("endEdit",{id:i.row.id,dataField:i.column.dataField,row:i.row,column:i.column,cell:i,data:i.row.data,value:e}),t._fireEndEdit=!1}};if(o(n,r))t.editing.isEditing=!1,d(),t.editing.editCell=null,t.editing.editRow||(t.editing.isEditing=!1,l());else{const e=function(){t.editing.editCell=null,t.editing.editRow||(t.editing.isEditing=!1),delete t._editInfo};if(!0===t.editing.batch||t.editing.batch&&t.editing.batch.indexOf("update")>=0)e(),t._batchUpdateCell(i.row,i.column,n,i.value),l(),d();else{const o=function(){e(),i._updating=!0,t.editing.readOnlyEdit?t.onCellEditRequest&&t.onCellEditRequest(i.row.id,i.column.dataField,n,i.value,i.row.data,t):i.value=n,i._updating=!1,l(),d()};if(!t.editing.editRow&&t.dataSource&&t.dataSource.virtualDataSource){const e={};e[i.column.dataField]=n,t.updateRow(i.row.id,e,(()=>{o()}))}else o()}}return t.editing.commandColumn.visible&&!t.editing.commandColumn.width&&"cell"===t.editing.mode&&t.refresh(),t.focus(),!0};let r=t._validateCell(i,n,l);if(!r)return i.editor.instance&&!i.editor.autoOpen&&setTimeout((()=>{i.editor.instance.focus()}),50),!1;const d=t._cellsUpdatedValues?t._cellsUpdatedValues[i.row.id+"_"+i.column.dataField]:void 0,s=void 0!==d?d:i.value;if(o(n,s))return a(),!!r;if(t._setCellUndoRedo(i,s,n),t.onCellUpdate&&!t.editing.editRow){t.beginUpdate(),t.appearance.displayLoadingIndicator=!0,t._setLoadingIndicatorVisibility();const e=t._createOverlay();t.$.root.appendChild(e),t.onCellUpdate([i],[s],[n],(function(l){l?a():t.cancelEdit(),t.appearance.displayLoadingIndicator=!1,t._setLoadingIndicatorVisibility(),e.parentNode.removeChild(e),t.endUpdate(),t.onCellUpdated&&t.onCellUpdated([i.row.index],[i.row],[i.column],[i.row.data],[s],[n],t),t._onCellUpdated&&t._onCellUpdated(i.row.index,i.row,i.column,i.row.data,s,n)}),t)}else if(t.onRowUpdate){t.beginUpdate(),t.appearance.displayLoadingIndicator=!0,t._setLoadingIndicatorVisibility();const e=t._createOverlay();t.$.root.appendChild(e);const l=i.column.dataField,o=Object.assign({},i.row.data),r=Object.assign({},i.row.data);r[l]=n,t.onRowUpdate([i.row.index],[i.row],[o],[r],(function(n){n?a():t.cancelEdit(),t.appearance.displayLoadingIndicator=!1,t._setLoadingIndicatorVisibility(),e.parentNode.removeChild(e),t.endUpdate(),t.onRowUpdated&&t.onRowUpdated([i.row.index],[i.row],[i.row.data],t),t._onRowUpdated&&t._onRowUpdated(i.row.index,i.row,i.row.data)}),t)}else a();return!!r}_endRowEdit(){const e=this,t=e.editing.editRow;if(!t)return!1;let i=!0;const n=t.cells;let l={},o={};t.element.removeAttribute("error");for(let a=0;a<n.length;a++){const r=n[a];let d=e._getEditorValue(r),s=null;d&&d.error&&(r.canNotify=!1,r.element.setAttribute("error",""),r.row.element.setAttribute("error",""),r.error=!0,r.canNotify=!0,s=d.validity,d=d.value),d!==r.value&&(l[r.column.dataField]=r.value,o[r.column.dataField]=d);if(!e._validateCell(r,d,s))return i=!1,t.element.setAttribute("error",""),e._isUpdating=!0,r.editor.instance&&setTimeout((()=>{r.editor.instance.focus()}),50),!1}if(i){const i=function(){const i=e._fireEndEdit;e._fireEndEdit=!1;for(let t=0;t<n.length;t++){const i=n[t];e._endCellEdit(i)}e._fireEndEdit=i,e.onRowUpdate||null===e.onRowUpdated||e.onRowUpdated([t.index],[t],[t.data],e),e.editing.isEditing=!1,e.editing.editRow=null,e.editing.commandColumn.visible&&!e.editing.commandColumn.width?e.refresh():e._recycle(!1)};if(!0===e.editing.batch||e.editing.batch&&e.editing.batch.indexOf("update")>=0)i();else if(e.onRowUpdate){e.beginUpdate(),e.appearance.displayLoadingIndicator=!0,e._setLoadingIndicatorVisibility();const n=e._createOverlay();e.$.root.appendChild(n);const a=e.onRowHistory;e.onRowHistory=null,t.updatedDate=new Date,t.updatedBy=e.currentUser,e.storeHistory&&e._updateRowHistory(t,l,o),setTimeout((()=>{e.onRowHistory=a}),100),e.onRowUpdate([t.index],[t],[l],[o],(function(l){const o=e.onRowUpdate,a=e.onCellUpdate;e.onRowUpdate=null,e.onCellUpdate=null,l?i():e.cancelEdit(),e.onRowUpdate=o,e.onCellUpdate=a,e.appearance.displayLoadingIndicator=!1,e._setLoadingIndicatorVisibility(),n.parentNode.removeChild(n),e.endUpdate(),e.onRowUpdated&&e.onRowUpdated([t.index],[t],[t.data])}),e)}else if(e.dataSource&&e.dataSource.virtualDataSource&&e.editing.isEditing){e.beginUpdate(),e.appearance.displayLoadingIndicator=!0,e._setLoadingIndicatorVisibility();const t=e._createOverlay();e.$.root.appendChild(t);let n=Object.assign({},e.editing.editRow.data);for(let t=0;t<e.editing.editRow.cells.length;t++){const i=e.editing.editRow.cells[t];if(!i.column.allowEdit)continue;const l=e._getEditorValue(i);void 0!==l&&(n[i.column.dataField]=l)}e._editInfo={row:n},e._virtualDataRequest("update",(function(n){n?i():e.cancelEdit(),e.appearance.displayLoadingIndicator=!1,e._setLoadingIndicatorVisibility(),t.parentNode.removeChild(t),e.endUpdate()}))}else i();return!0}return e.focus(),!1}_batchDeleteRow(e){const t=this;if(t._rowsDeleted||(t._rowsDeleted=[]),t.onRowRemove){if(!1===t.onRowRemove([e.id],t))return}t._rowsDeleted.push(e.id),t._recycle(!1),t.onRowRemoved&&t.onRowRemoved([e.id],[e.data.$.index],t)}_batchAddRow(e,t){const i=this;i._rowsAdded||(i._rowsAdded=[]),i._rowsAdded.push(e.id),i.rowById[e.id]=e,e.index=i.rows.length+(i._rowsAdded?i._rowsAdded.length:0),0===t?i._nearRowsAdded.splice(0,0,e):i._farRowsAdded.push(e);i.isInitialized&&i._rowElements&&i._rowElements.length<i.rows.length+i._rowsAdded.length&&i._initializeRowElements(),i.refresh()}_batchUpdateCell(e,t,i,n){const l=this;l._cellsUpdatedValues||(l._cellsUpdatedValues=[]);!function(e,i){return"date"===t.dataType?!(!e&&i)&&(!(e&&!i)&&e.valueOf()===i.valueOf()):e===i}(i,n)?l._cellsUpdatedValues[e.id+"_"+t.dataField]=i:delete l._cellsUpdatedValues[e.id+"_"+t.dataField],l._cellsUpdatedValues.length++}_saveBatchEdit(){const e=this;for(let t in e._cellsUpdatedValues){const i=e._cellsUpdatedValues[t],n=t.substring(0,t.indexOf("_")),l=t.substring(t.indexOf("_")+1),o=e.rowById[n],a=o.getCell(l);if(e.dataSource.virtualDataSource){const t={};t[a.column.dataField]=i,o.data.$&&o.data.$.id?e.updateRow(o.data.$.id,t):(a._updating=!0,a.value=i,a._updating=!1)}else a._updating=!0,a.value=i,a._updating=!1}const t=e._rowsDeleted&&e._rowsDeleted.length>0||e._rowsAdded&&e._rowsAdded.length>0;if(t&&e.beginUpdate(),e._rowsAdded&&e._rowsAdded.length>0)for(let t in e._rowsAdded){const i=e._rowsAdded[t],n=e.rowById[i];if(n){if(e._rowsDeleted&&e._rowsDeleted.length>0){let t=!1;for(let n=0;n<e._rowsDeleted.length;n++){if(e._rowsDeleted[n].id===i){t=!0;break}}if(t)continue}e.dataSource.virtualDataSource?e.addRow(n.data,!0):e._nearRowsAdded.indexOf(n)>=0?e.rows.splice(0,0,n):e._farRowsAdded.indexOf(n)>=0&&e.rows.push(n)}}if(e._rowsDeleted&&e._rowsDeleted.length>0)for(let t=0;t<e._rowsDeleted.length;t++){const i=e._rowsDeleted[t],n=e.rowById[i];if(n)if(e.dataSource&&e.dataSource.virtualDataSource)e._editInfo={row:n.data},e._virtualDataRequest("remove",(function(t){if(t){const t=e.rows.indexOf(n);e.rows.splice(t,1),delete e.rowById[n.id]}}));else{const t=e.rows.indexOf(n);e.rows.splice(t,1)}}t&&e.endUpdate(),e._clearBatchEdit(!1),e.$.fireEvent("saveBatchEdit")}_clearBatchEdit(){const e=this;let t=!1;e._rowsAdded&&e._rowsAdded.length>0&&(t=!0),e._cellsUpdatedValues=[],e._rowsAdded=[],e._rowsDeleted=[],e._nearRowsAdded=[],e._farRowsAdded=[],t?e.refresh():e._recycle(!1),e.$.fireEvent("clearBatchEdit")}_getEditorId(e){const t=e.column._editorId?e.column._editorId:"";return e.editor!==e.column.editor?e.editor.template+"_"+e.column.dataField+"_"+e.row.id+t:e.editor.template+"_"+e.column.dataField+t}_applyCommand(e,t){const i=this;t||(t=[]);const n=function(){"function"==typeof e?e.apply(i,t):i[e]?i[e].apply(i,t):Smart[e]?Smart[e].apply(i,t):window[e]&&window[e].apply(i,t)};if(i.onCommand){t||(t=[]),t[1]||(t[1]=null);const l={name:e,command:n,details:t[0],event:t[1],handled:!1};setTimeout((()=>{i.onCommand.apply(i,[l]),l.handled||n()}),200)}else n()}_getCommandColumnCommandsTemplate(){const e=this,t=e.editing.commandColumn.dataSource,i="icon"!==e.editing.commandColumn.displayMode,n="label"!==e.editing.commandColumn.displayMode;let l="";for(let o in t){const a=t[o];let r="<div",d=!1;if("commandColumnMenu"===o)continue;d||(r+=' item="'+o+'" command="'+a.command+'" class="smart-grid-command-item">',d=!0);const s="{{messages}}"===a.label?e.localize(o):a.label;n&&i?(r+='<span class="smart-grid-icon '+a.icon+'"></span>',r+='<span class="smart-grid-label">'+s+"</span>"):n&&!i?r+='<span title="'+s+'" class="smart-grid-icon '+a.icon+'"></span>':i&&!n&&(r+='<span class="smart-grid-label">'+s+"</span>"),r+="</div>",l+=r}return l}_updateCommandColumnCommandsVisibility(e,t){const i=this,n=e.children,l=i.editing.commandColumn.dataSource;for(let e=0;e<n.length;e++){const o=n[e],a=o.getAttribute("item"),r=l[a].visible;!0===r?o.classList.remove("smart-hidden"):!1===r?o.classList.add("smart-hidden"):"auto"===r&&(!i.editing.dialog.enabled&&(i.editing.editRow===t||i.editing.editCell&&i.editing.editCell.row===t)?"commandColumnEdit"===a?o.classList.add("smart-hidden"):"commandColumnUpdate"!==a&&"commandColumnCancel"!==a||n[e].classList.remove("smart-hidden"):"commandColumnEdit"===a?o.classList.remove("smart-hidden"):"commandColumnUpdate"!==a&&"commandColumnCancel"!==a||n[e].classList.add("smart-hidden"))}}_handleEditKeyDown(e){const t=this,i=e.key,n=t.editing.commandKeys;if(!t.editing.dialog.enabled){if("cell"===t.editing.mode&&t.selection.allowCellSelection&&t.selection.enabled){const n=t.editing.editCell,l=n.column,o=n.row,a=t.columns.indexOf(l);("ArrowLeft"===i&&a>0||"ArrowRight"===i&&a<t.columns.length-1||"ArrowDown"===i&&o.visibleIndex<t.rows.length-1||"ArrowUp"===i&&o.visibleIndex>0)&&(t.editing.editKeyHandling=!0,t._keyDownHandler(e),t.editing.editKeyHandling=!1)}for(let l in n){const o=n[l],a=o.key.replace(/ /gi,"").split("|");if(("Tab"!==i||!t.editing.editRow)&&a.indexOf(i)>=0){if(t._editDownKey=i,t._applyCommand(o.command),"Enter"===i&&e){if(e.stopPropagation(),t._supressEnter)return void delete t._supressEnter;t.selection.enabled&&t.selection.allowCellSelection&&t._keyDownHandler(e)}delete t._editDownKey;break}}}}_getCustomCellEditor(e){const t=this;e.editor.selector=e.editor.template,e.editor.template="custom";const i=t._getEditorId(e);if(!t._cellEditors[i]){let n=document.createElement("div");t._applyCellEditorUserSettings(n,e),n.classList.add("smart-grid-cell-editor");const l=function(e){"keydown"!==e.type||t._handleEditKeyDown(e)},o=function(){const t=e.editor.instance.element.firstElementChild;Smart.Utilities.Core.isMobile||(e.editor.focus?setTimeout((function(){e.editor.focus.apply(e.editor.instance.element,[])}),50):setTimeout((function(){t.focus()}),50))},a=function(t){const i=e.editor.instance.element.firstElementChild;e.editor.blur?e.editor.blur.apply(e.editor.instance.element,[t]):i.blur()},r=function(t){const i=e.editor.instance.element.firstElementChild;if(!e.editor.isInitialized&&e.editor.settings&&i)for(let t in e.editor.settings)i[t]=e.editor.settings[t];if(e.editor.setValue)e.editor.setValue.apply(e.editor.instance.element,[t]);else{if(i.innerHTML.indexOf("{{")>=0){const n=i.innerHTML.replace(/{{value}}/gi,t).replace(/{{id}}/gi,e.row.id);i.innerHTML=n}i.value=t,t instanceof Date&&(i.value=t.toISOString().split("T")[0]),e.editor.instance.element.value=i.value}},d=function(){if(!e.editor.instance)return"";const t=e.editor.instance.element.firstElementChild;if(e.editor.getValue){const i=t.querySelector("input");return i&&i.blur(),e.editor.getValue.apply(e.editor.instance.element,[t.value])}const i=t.value;return e.editor.settings&&e.editor.settings.valueProperty?i?Array.isArray(i)&&i.length>0?i[0][e.editor.settings.valueProperty]:i[e.editor.settings.valueProperty]:"":i||""},s=function(){n.removeEventListener("keydown",l),e.editor.detach&&e.editor.detach.apply(n,[])},c=function(){n.addEventListener("keydown",l),e.editor.attach&&e.editor.attach.apply(n,[])};let u=null;if((e.editor.selector.startsWith("#")||e.editor.selector.startsWith("."))&&(u=document.querySelector(e.editor.selector)),u)n.appendChild(u.content.cloneNode(!0).firstElementChild);else{const i=function(e){const t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}(e.editor.selector);if(i){if("#text"===i.nodeName)return t._getInputCellEditor(e);n.appendChild(i)}}t._cellEditors[i]={element:n,focus:o,blur:a,getValue:d,setValue:r,attach:c,detach:s}}return t._cellEditors[i]}_getSliderCellEditor(e){const t=this,i=t._getEditorId(e),n=document.createElement("div"),l=document.createElement("input"),o=document.createElement("div"),a=document.createElement("smart-number-input");if(l.type="range",l.step="0.01",t._applyCellEditorUserSettings(n,e),"{}"===JSON.stringify(a.numberFormat)){let i={};if(e.column.cellsFormat)if(e.column.cellsFormat.indexOf("c")>=0){i={style:"currency",currency:t.messages[t.locale].calendar.currency};let n=parseInt(e.column.cellsFormat.substring(1));isNaN(n)||(i.maximumFractionDigits=n)}else if(e.column.cellsFormat.indexOf("p")>=0){i={style:"percent"};let t=parseInt(e.column.cellsFormat.substring(1));isNaN(t)||(i.maximumFractionDigits=t)}else e.column.Intl&&e.column.Intl.NumberFormat&&(i=e.column.Intl.NumberFormat);a.numberFormat=i}e.editor.min&&(l.min=a.min=e.editor.min),e.editor.max&&(l.max=a.max=e.editor.max),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-slider-cell-editor"),o.classList.add("nav"),a.classList.add("smart-flex"),a.style.paddingLeft="6px",o.classList.add("smart-icon-resize-full","smart-grid-icon");const r=function(e){if("keydown"===e.type&&(t._handleEditKeyDown(e),"Backspace"!==e.key&&"Delete"!==e.key&&"Tab"!==e.key&&"Escape"!==e.key&&!e.altKey&&!e.shiftKey))return o.click(),void e.preventDefault()};o.onclick=function(){const i=document.createElement("div"),n=document.createElement("input");n.type="range";const r=e.editor.instance.element,d=document.createElement("div");d.classList.add("smart-slider-editor"),i.setAttribute("theme",t.theme),d.appendChild(n);const s=Smart.Utilities.Core.createGUID().replace(/-/gi,"");i.id="Slider"+s,r.setAttribute("aria-owns",i.id),d.classList.add("smart-grid-slider-container"),n.value=l.value,l.min&&(n.min=l.min),l.max&&(n.max=l.max),o.sliderEditorDialog=i,o.popupSlider=n,n.onchange=n.oninput=function(){a.value=parseFloat(n.value)};const c=e=>{e&&e.key&&("Enter"===e.key&&(i.parentNode.removeChild(i),l.value=parseFloat(n.value),t.endEdit()),"Escape"===e.key&&(i.parentNode.removeChild(i),t.cancelEdit()))};a.onchange=a.onkeyup=e=>{n.value=a.value,c(e)},n.onkeydown=function(e){c(e)},i.classList.add("smart-grid-slider-dialog"),i.appendChild(d),document.body.appendChild(i),i.style.top=t._offsetTop(r)+r.offsetHeight+"px",i.style.left=t._offsetLeft(r)+15+r.offsetWidth-i.offsetHeight+"px",i.style.width=r.offsetWidth+"px";const u=t._offsetLeft(t)+t.offsetWidth;t._offsetLeft(r)+i.offsetWidth>u&&(i.style.left=u-i.offsetWidth-10+"px")};let d=e.value;void 0===d&&(d=0),a.value=d,l.value=d,n.appendChild(a);const s=e=>{"Escape"===e.key&&(o.sliderEditorDialog&&o.sliderEditorDialog.parentNode.removeChild(o.sliderEditorDialog),t.cancelEdit()),"Enter"===e.key&&(o.sliderEditorDialog&&o.sliderEditorDialog.parentNode.removeChild(o.sliderEditorDialog),l.value=parseFloat(a.value),t.endEdit())};return t._cellEditors[i]={element:n,focus:function(){o.click(),Smart.Utilities.Core.isMobile||setTimeout((function(){a.focus(),t.$.scrollView.scrollTop=0}),50)},blur:function(){},setValue:function(e){l.value=void 0!==e&&""!==e?parseFloat(e):0,a.isReady&&a.setValue(e)},getValue:function(){const e=parseFloat(l.value);return o.sliderEditorDialog&&o.sliderEditorDialog.parentNode?(l.value=parseFloat(o.popupSlider.value),l.value):e},attach:function(){l.addEventListener("keydown",r),a.addEventListener("keydown",s)},detach:function(){l.removeEventListener("keydown",r),a.removeEventListener("keydown",s),o.sliderEditorDialog&&o.sliderEditorDialog.parentNode&&(l.value=o.popupSlider.value,o.sliderEditorDialog.parentNode.removeChild(o.sliderEditorDialog))}},t._cellEditors[i]}_getBeginEditKey(e){const t=this;t._beginEditKey?t._beginEditKey+=e:t._beginEditKey=e}_getTextAreaCellEditor(e){const t=this,i=t._getEditorId(e),n=t._cellEditors[i],l=document.createElement("div");let o=t.editing.dialog.enabled?document.createElement("smart-text-area"):document.createElement("textarea");o.users=t.users;let a=!1;Smart.Editor&&(o=t.editing.dialog.enabled?document.createElement("smart-editor"):document.createElement("textarea"),o.users=t.users,o.spellcheck=!1,o.editMode="blockHtml",o.style.border="none",o.style.setProperty("--smart-editor-input-min-height","100px"),o.style.setProperty("--smart-editor-default-height","250px"),a=!0);const r=document.createElement("div");"richText"===e.column.template&&(o.richText=!0,o.style.setProperty("--smart-editor-label-padding","0px")),t._applyCellEditorUserSettings(l,e),o.style.direction="",t.rightToLeft&&(o.style.direction="rtl"),e.editor.min&&(o.minLength=e.editor.min),e.editor.max&&(o.maxLength=e.editor.max),o.classList.add("smart-input"),l.classList.add("smart-grid-cell-editor"),l.classList.add("smart-grid-text-area-cell-editor"),r.classList.add("nav"),r.classList.add("smart-icon-resize-full","smart-grid-icon");const d=function(e){if(t._getBeginEditKey(e.key),"keydown"===e.type&&(t._handleEditKeyDown(e),"Backspace"!==e.key&&"Delete"!==e.key&&"Tab"!==e.key&&"Escape"!==e.key&&!e.altKey&&!e.shiftKey)){if(t.editing.dialog.enabled)return;return r.click(),void e.preventDefault()}};r.onclick=function(){if(t.editing.dialog.enabled)return;const l=document.createElement("div");l.style.paddingRight=l.style.paddingBottom="4px";let d=document.createElement("smart-text-area");if(a){if(d=document.createElement("smart-editor"),n&&n.popupTextAreaId){const e=document.querySelector("#"+n.popupTextAreaId+"_toolbar");e&&e.remove()}d.spellCheck=!1,d.users=t.users,d.compactImageDialog=!0,d.ai.key=t.ai.key,d.ai.model=t.ai.model,d.ai.url=t.ai.url,d.editMode="blockHtml",d.uploadUrl=t.uploadSettings.url,d.removeUrl=t.uploadSettings.removeUrl,d.onImageRemove=t.uploadSettings.onUploadRemove,d.whenRendered((()=>{const e=t._cellEditors[i];e&&(e.popupTextAreaId=d.id)})),d.style.setProperty("--smart-editor-padding","5px"),d.style.setProperty("--smart-editor-input-min-height","100px"),d.style.setProperty("--smart-editor-default-height","250px");const e=["bold","italic","underline","|","fontsize","fontname","alignment","|","orderedlist","unorderedlist","checklist","hyperlink","image"];t.ai.key&&e.push("ai"),e.push("|"),e.push("clearFormat"),d.toolbarItems=e,d.style.border="none",t._hasRichTextEditor=!0,t._errorOverlay=t._createOverlay(),t._errorOverlay.onpointerdown=function(){t._hasRichTextEditor=!1,t.endEdit()},d._setEditorValue(o.value,d),t.$.root.appendChild(t._errorOverlay)}const s=e.editor.instance.element,c=document.createElement("div"),u=document.createElement("div");t._resizeHandling=!1,u.classList.add("smart-grid-text-area-resizer","show","smart-icon-resize-full","smart-grid-icon"),u.title=t.localize("expandCell");let m=s.offsetHeight+20;t._resizable(l,d,"bottom-right",s.offsetWidth,m),u.onpointerdown=e=>{if(u.hasAttribute("expanded"))return void t.endEdit();d.sortable=!0,d.style.setProperty("--smart-editor-padding","15px"),u.setAttribute("expanded",""),u.classList.add("smart-grid-text-area-resizer","show","smart-icon-close","smart-grid-icon");const i=t.offset(t);l.style.top=i.top+40+"px",l.style.left=i.left+40+"px",l.style.width=t.offsetWidth-80+"px",l.style.height=t.offsetHeight-80+"px";const n=window.innerWidth,o=window.innerHeight;o<t.offsetHeight&&(l.style.height=o-80+"px"),n<t.offsetWidth&&(l.style.width=n-80+"px");const a=["bold","italic","underline","strikethrough","subscript","superscript","outdent","indent","|","fontsize","fontname","formats","fontcolor","backgroundcolor","alignment","|","orderedlist","unorderedlist","checklist","hyperlink","image","file","table","video","print"];t.ai.key&&a.push("ai"),a.push("|"),a.push("undo"),a.push("redo"),a.push("|"),a.push("sourceCode"),a.push("clearFormat"),a.push("delete"),d.style.height=t.offsetHeight-80+"px",d.toolbarItems=a,d.style.width=l.offsetWidth+"px",l.resizeMode="none",document.body.style.cursor="",d.recycle&&d.recycle(),e.preventDefault(),e.stopPropagation()},"richText"===e.column.template&&(d.richText=!0,d.toolbarOnFocus=!0),d.users=t.users,s.offsetHeight>180&&(d.style.height=s.offsetHeight+20+"px"),l.appendChild(u),r.textAreaEditorDialog&&r.textAreaEditorDialog.parentNode&&r.textAreaEditorDialog.parentNode.contains(r.textAreaEditorDialog)&&(r.textAreaEditorDialog.parentNode.removeChild(r.textAreaEditorDialog),r.textAreaEditorDialog.menu&&r.textAreaEditorDialog.menu.remove()),l.id="TextArea"+i,s.setAttribute("aria-owns",l.id),t.rightToLeft&&(d.style.direction="rtl"),l.setAttribute("theme",t.theme),c.appendChild(d),c.classList.add("smart-grid-text-area-container"),d.value=o.value,d.classList.add("smart-input"),o.minLength>=0&&(d.minLength=o.minLength),o.maxLength>=0&&(d.maxLength=o.maxLength),r.textAreaEditorDialog=l,r.popupTextArea=d,d.onkeydown=function(e){if(d._key=e.key,t._getBeginEditKey(e.key),"Escape"===e.key){try{l.parentNode.contains(l)&&(l.parentNode.removeChild(l),l.menu&&l.menu.remove())}catch(e){l.error=e}t.editing.editCell&&t.cancelEdit()}if("Tab"===e.key||"Enter"===e.key&&e.shiftKey){if(o.value=d.value,t.editing.editCell?t.endEdit():d.blur(),"Tab"===e.key)return void t._keyDownHandler(e);e.preventDefault(),e.stopPropagation()}},l.classList.add("smart-grid-text-area-dialog"),l.appendChild(c),document.body.appendChild(l);const g=t._offsetTop(s);if(l.style.top=g+"px",l.style.left=t._offsetLeft(s)+"px",l.style.width=Math.max(320,s.offsetWidth)+"px",g+c.offsetHeight>window.innerHeight&&(l.style.top=s.offsetHeight+g-l.offsetHeight+"px"),t.grouping.enabled&&e.column._treeColumn){const e=s.parentNode.parentNode;l.style.top=t._offsetTop(e)+"px",l.style.left=t._offsetLeft(e)+"px",l.style.width=e.offsetWidth+"px"}t._beginEditKey&&!Smart.Utilities.Core.isMobile?d.focus():setTimeout((function(){Smart.Utilities.Core.isMobile||d.select()}),50),d.onblur=()=>{if(!t._dialogTextArea||t._dialogTextArea.classList.contains("smart-hidden")){"Escape"!==d._key&&(o.value=r.popupTextArea.value),o.focus();try{r.textAreaEditorDialog.parentNode&&(r.textAreaEditorDialog.parentNode.removeChild(r.textAreaEditorDialog),r.textAreaEditorDialog.menu&&r.textAreaEditorDialog.menu.remove())}catch(e){r.error=e}}}},l.appendChild(o);return t._cellEditors[i]={element:l,focus:function(){r.click()},blur:function(){},setValue:function(i){i&&(""+i).indexOf("&#")>=0&&(i=t._fromHTMLEntities(i)),"richText"!==e.column.template&&"string"==typeof i&&(i=i.replaceAll("<br/>","\n\r").replaceAll("<br>","\n\r")),null===i&&(i="");const n=t._unescapeString(i);o.value=n,r.popupTextArea&&(r.popupTextArea.value=o.value,r.popupTextArea.dispatchEvent(new Event("input")),r.popupTextArea.focus())},getValue:function(){let i=o.value;return t._resizeHandling=!0,"Smart-TEXT-AREA"===o.nodeName&&"richText"===e.column.template&&(i=o.getHTML()),r.textAreaEditorDialog&&r.textAreaEditorDialog.parentNode?(o.value=r.popupTextArea.value,r.popupTextArea.richText?r.popupTextArea.getHTML():o.value):i},attach:function(){o.addEventListener("keydown",d)},detach:function(){if(o.removeEventListener("keydown",d),n&&n.popupTextAreaId){const e=document.querySelector("#"+n.popupTextAreaId+"_toolbar");e&&e.remove()}if(setTimeout((()=>{const e=document.querySelector(".smart-editor-toolbar[popup]");e&&e.remove()}),100),r.textAreaEditorDialog&&r.textAreaEditorDialog.parentNode){o.value=r.popupTextArea.value;try{r.textAreaEditorDialog.parentNode&&r.textAreaEditorDialog.parentNode.removeChild(r.textAreaEditorDialog),r.textAreaEditorDialog.menu&&r.textAreaEditorDialog.menu.remove(),r.popupTextArea&&r.popupTextArea.remove();const e=document.querySelector(".smart-grid-textarea-dialog");e&&e.close()}catch(e){r.error=e}}else r.popupTextArea&&r.popupTextArea.remove()}},t._cellEditors[i]}_getGridCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("div"),l=document.createElement("smart-grid");l.users=t.users;const o=document.createElement("div");if(o.setAttribute("theme",t.theme),o.classList.add("smart-grid-cell-drop-down-menu","smart-input-drop-down-menu"),o.style.width="550px",o.style.height="350px",document.body.appendChild(o),l.sorting.enabled=l.filtering.enabled=l.selection.enabled=!0,l.style.width=l.style.height="100%",l.selection.mode="one",l.appearance.showColumnLines=!1,l.layout.rowMinHeight=45,l.appearance.showRowHeader=!0,l.appearance.allowHover=!0,l.behavior.columnResizeMode=l.behavior.rowResizeMode="growAndShrink",l.selection.allowRowHeaderSelection=!0,e.column.relationId&&e.column.relationField){const i=t._getRelationData(e.column.relationId,e.column.relationField,e.column.relationCascadingFields),n=t._getRelationColumns(e.column.relationId);l.columns=n,l.dataSource=i}else t._applyCellEditorUserSettings(l,e);o.appendChild(l),n.classList.add("smart-grid-cell-editor");const a=document.createElement("div");a.innerHTML='<span class="smart-flex middle center smart-truncate">'+e.value+"</span>";const r=document.createElement("span");r.classList.add("smart-arrow-down","arrowbtn");const d=document.createElement("div");d.classList.add("smart-multi-combo-input-container","tokens","smart-flex","smart-flex-auto"),a.classList.add("smart-flex-auto","smart-flex","middle","center","smart-multi-combo-input"),a.style.justifyContent="space-between",a.style.alignItems="center",a.style.width="100%",r.style.width="30px",d.appendChild(a),d.appendChild(r),n.appendChild(d);const s=e=>{const t=this._offsetTop(n),i=this._offsetLeft(n);o.setAttribute("open","");const a=n.closest("smart-grid-cell");a&&a.setAttribute("focus","");const r=window.scrollX,d=window.scrollY;if(o.style.left=-3+i+r+"px",o.removeAttribute("top"),o.style.top=t+n.offsetHeight+d+1+"px",window.innerHeight<parseInt(o.style.top)+o.offsetHeight-d?(o.style.top=t-o.offsetHeight+d+1+"px",o.setAttribute("top","")):o.style.top=t+n.offsetHeight+d+1+"px",l._firstSelect=!0,void 0!==e)l.selectRow(e);else if(a&&a.cell){const e=a.cell.value;l.rowById[e]&&l.selectRow(e)}l._firstSelect=!1};d.onpointerdown=r.onpointerdown=e=>{o.hasAttribute("open")?o.removeAttribute("open"):s(),e.stopPropagation(),e.preventDefault()},n.open=()=>{s()};const c=n.close=()=>{o.removeAttribute("open"),l.clearSelection()},u=t=>{if(e.column.templateSettings&&t){const i=e.column.templateSettings.dataFields;let n="";if(i)for(let e=0;e<i.length;e++){const l=t[i[e]];l&&(n+='<span class="smart-truncate smart-token smart-flex middle center ">'+l+"</span>")}a.innerHTML=n}else a.innerHTML='<span class="smart-flex middle center smart-truncate"></span>'};l.onRowSelect=e=>{if(l._firstSelect)return;o.removeAttribute("open");const t=e.data;u(t)};const m=function(){const i=l.getSelectedRows();if(i.length){const l=i[0][0],o=e.column._computedFields;if(o)for(let e=0;e<o.length;e++){const l=o[e],a=t.columnByDataField[l],r=i[0][1],d=n.closest("smart-grid-cell").cell,s=r[a.cascadingDataField];requestAnimationFrame((()=>{t.setCellValue(d.row.id,a.dataField,s),t.flashCell(d.row.id,a.dataField)}))}return l}return""},g=function(e){e&&(""+e).indexOf("&#")>=0&&(e=t._fromHTMLEntities(e)),null===e&&(e="");t._unescapeString(e);if(void 0!==e){if(!l.rowById)return;const t=l.rowById[e];t?u(t.data):u()}},p=function(){Smart.Utilities.Core.isMobile},f=function(){},h=function(){document.body.appendChild(o)},w=function(){c(),setTimeout((()=>{!o.hasAttribute("open")&&o.parentNode&&(o.style.left="-1000px",o.style.top="-1000px")}),200)};t._cellEditors[i]={element:n,focus:p,blur:f,setValue:g,getValue:m,attach:h,detach:w}}if(e.column.relationId&&e.column.relationField){const n=t._getRelationData(e.column.relationId,e.column.relationField,e.column.relationCascadingFields),l=t._getRelationColumns(e.column.relationId);t._cellEditors[i].element.columns=l,t._cellEditors[i].element.dataSource=n,e.column.editor.columns=l,e.column.editor.dataSource=n}return t._cellEditors[i]}_getColorInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=t._getColorInput();t._applyCellEditorUserSettings(n,e),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-color-input-cell-editor"),n.dropDownWidth=90,n.autocomplete="off",n.style.direction="",t.rightToLeft&&(n.rightToLeft=!0);const l=function(e){"keydown"!==e.type||t._handleEditKeyDown(e)},o=function(){Smart.Utilities.Core.isMobile||setTimeout((function(){n.select()}),50)},a=function(){},r=function(e){null==e&&(e=""),n.value=e},d=function(){return n.value},s=function(){n.removeEventListener("keydown",l)},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:a,getValue:d,setValue:r,attach:c,detach:s}}return t._cellEditors[i]}_getInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("input");t._applyCellEditorUserSettings(n,e),e.editor.min&&(n.minLength=e.editor.min),e.editor.max&&(n.maxLength=e.editor.max),n.classList.add("smart-input"),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-input-cell-editor"),n.autocomplete="off",n.style.direction="",t.rightToLeft&&(n.style.direction="rtl");const l=function(i){let l=i.key;if(t._getBeginEditKey(i.key),"keydown"!==i.type);else{if(!("number"!==e.column.dataType&&"int"!==e.column.dataType&&"float"!==e.column.dataType||t.editing.editColumn||i.key.match(/[0-9]/)||"-"===i.key||1!==i.key.length))return i.preventDefault(),void i.stopPropagation();if("ArrowLeft"===l&&0!==n.selectionStart)return;if("ArrowRight"===l&&n.selectionStart<n.value.length)return;t._handleEditKeyDown(i)}},o=function(){Smart.Utilities.Core.isMobile||(t._beginEditKey?n.focus():setTimeout((function(){n.select()}),50))},a=function(){},r=function(i){if(e.column.rowHeaderColumn&&!i)return void(n.value=e.editor.row.visibleIndex+1);if("number"===e.column.dataType||"int"===e.column.dataType||"float"===e.column.dataType){if(""===i)return;if(i&&!i.toString().match(/[0-9]/)&&"-"!==i)return}i&&(""+i).indexOf("&#")>=0&&(i=t._fromHTMLEntities(i));const l=t._unescapeString(i);n.value=l},d=function(){return n.value},s=function(){n.removeEventListener("keydown",l)},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:a,getValue:d,setValue:r,attach:c,detach:s}}return t._cellEditors[i]}_applyCellEditorUserSettings(e,t){for(let i in t.editor)"template"!==i&&("list"!==i?"onInit"!==i&&"onRender"!==i&&(e[i]=t.editor[i]):e.setAttribute(i,t.editor[i]));if(t.editor.settings)for(let i in t.editor.settings)e[i]=t.editor.settings[i]}_getCheckInputCellEditor(e){return this._getAutoCompleteCellEditor(e,"smart-check-input")}_getMultiInputCellEditor(e){return this._getAutoCompleteCellEditor(e,"smart-multi-input")}_getMultiComboInputCellEditor(e){const t=this._getAutoCompleteCellEditor(e,"smart-multi-combo-input");return"tags"!==e.column.template&&"collaborator"!==e.column.template||(t.getValue=()=>{const e=t.element.selectedItems;if(e&&0===e.length)return"";let i=[];for(let t=0;t<e.length;t++){const n=e[t];"string"==typeof n?i.push(n):i.push(n.value)}return i.toString()},t.setValue=e=>{if(null===e&&(e=""),"number"==typeof e&&(e=""+e),e&&e.indexOf("{")>=0||e&&e.indexOf("[")>=0)t.element.selectedItems=JSON.parse(e);else if(e&&e.indexOf(",")>=0)if(e=e.split(",").map((e=>e.trim())),t.element.readonly){let i=[];t.element.dataSource.forEach((t=>{for(let n=0;n<e.length;n++){const l=e[n];("string"==typeof t&&""+t===l||t&&void 0!==t.label&&""+t.value===l)&&i.push(t)}})),t.element.selectedItems=i}else t.element.selectedItems=e;else if(t.element.readonly){let i=[];t.element.dataSource.forEach((t=>{("string"==typeof t&&""+t===e||t&&void 0!==t.label&&""+t.value===e)&&i.push(t)})),e&&0===i.length&&t.element.allowItemsAdd&&i.push(e),t.element.selectedItems=i}else t.element.value=e},t.focus=function(){if(Smart.Utilities.Core.isMobile)return;const e=t.element;setTimeout((()=>{t.element.readonly?t.element.focus():e&&e.select&&e.select()}),50)}),t}_getAutoCompleteCellEditor(e,t){const i=this,n=i._getEditorId(e);if(i._cellEditors[n]&&e.column.editor.isDirty&&(delete e.column.editor.isDirty,delete i._cellEditors[n]),!i._cellEditors[n]){let l=document.createElement("smart-input");t&&(l=document.createElement(t)),l.dropDownPlaceholder=i.localize("noOptions"),i._applyCellEditorUserSettings(l,e),l.readonly&&(l.dropDownButtonPosition="right"),l.dropDownOpenPosition="auto";const o=function(e){if(l.opened)return;const t=e.key;if("keydown"!==e.type);else{if("ArrowLeft"===t&&l.$.input&&0!==l.$.input.selectionStart)return;if("ArrowRight"===t&&l.$.input&&l.$.input.selectionStart<l.$.input.value.length)return;i._handleEditKeyDown(e)}};l.rightToLeft=i.rightToLeft,l.classList.add("smart-grid-cell-editor"),l.classList.add("smart-grid-auto-complete-cell-editor"),l.dropDownOpenPosition="auto";const a=function(){Smart.Utilities.Core.isMobile||setTimeout((()=>{l&&l.select&&l.select()}),50)},r=function(e){e&&1===e.length&&l.readonly||(l.value=null!==e?e:"")},d=function(){if(e.column.dataField!==e.column.displayField){const e=l.selectedValues[0];return{label:l.value,value:e}}return l.value},s=function(){l&&l.close&&(l.value="",l.close(),l.removeEventListener("keydown",o))},c=function(){},u=function(){l.addEventListener("keydown",o)};i._cellEditors[n]={element:l,focus:a,blur:c,setValue:r,getValue:d,attach:u,detach:s}}if(!e.editor.isInitialized&&e.editor.dataSource&&(e.editor.dataSource.length<=7?i._cellEditors[n].element.dropDownHeight="auto":i._cellEditors[n].element.dropDownHeight=200),e.editor.allowItemsAdd&&e.editor.dataSource&&(e.editor.dataSource.length<=12?i._cellEditors[n].element.dropDownHeight="auto":i._cellEditors[n].element.dropDownHeight=200,i._cellEditors[n].element.onAdd=()=>{i.onColumnUpdated&&i.onColumnUpdated(i.columns.indexOf(e.column),e.column)}),e.editor.dataSource||e.editor.isInitialized){if(e.column.editor.collaborator){let t=[];for(let e=0;e<i.users.length;e++)t.push({color:i.users[e].color,label:i.users[e].name,id:i.users[e].id,value:i.users[e].id,name:i.users[e].name,image:i.users[e].image});if(e.column.editor.singleSelect&&(t=[""].concat(t)),t&&i._cellEditors[n]&&i._cellEditors[n].element&&i._cellEditors[n].element.dataSource&&JSON.stringify(t)!==JSON.stringify(i._cellEditors[n].element.dataSource)){i._cellEditors[n].element.dropDownHeight="auto";const l=i._cellEditors[n].element.dataSource;if(l)for(let e=0;e<t.length;e++){const i=t[e],n=l.find((e=>{if(e.id===i.id)return e}));n&&"object"==typeof i&&(i.color=n.color)}i._cellEditors[n].element.dataSource=t,e.column.editor.dataSource=t}}}else{const t=i.getVisibleRows(),l=[],o=[];for(let n=0;n<t.length;n++){let a=i.dataSource[t[n].index];if(a){if(e.column.displayField!==e.column.dataField){const t=a[e.column.displayField],i=a[e.column.dataField];-1===o.indexOf(t)&&(l.push({label:t,value:i}),o.push(t));continue}if(a=a[e.column.dataField],!a)continue;-1===l.indexOf(a)&&l.push(a)}}l.length<=7?i._cellEditors[n].element.dropDownHeight="auto":i._cellEditors[n].element.dropDownHeight=200,i._cellEditors[n].element.dataSource=l}return i._cellEditors[n]}_getDateRangeInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-date-range-input");n.dropDownButtonPosition="right",n.dropDownAppendTo="body",n.autoClose=!0,n.selectionMode="default",n.rightToLeft=t.rightToLeft,n.timepicker=!0,n.dropDownOpenPosition="auto",t._applyCellEditorUserSettings(n,e);const l=function(e){let i=e.key;if(!n.opened)if("keydown"!==e.type);else{if("ArrowLeft"===i&&n.$.input&&0!==n.$.input.selectionStart)return;if("ArrowRight"===i&&n.$.input&&n.$.input.selectionStart<n.$.input.value.length)return;t._handleEditKeyDown(e)}};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const o=function(){Smart.Utilities.Core.isMobile||setTimeout((()=>{n.select()}),50)},a=function(e){n.value=e,n.selectedDates=[]},r=function(){return n._performSelect(),n.selectedDates},d=function(){n.value="",n.close(),n.removeEventListener("keydown",l)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getDateTimePickerCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-date-time-picker");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",n.rightToLeft=t.rightToLeft,n.nullable=!0,e.column.cellsFormat&&(n.formatString=e.column.cellsFormat),t._applyCellEditorUserSettings(n,e),t.selection.enabled&&!t.selection.allowCellSelection&&n.autoOpen&&(n.autoOpen=e.editor.autoOpen=!1);const l=function(e){let i=e.key;if(!n.opened)if("keydown"!==e.type);else{if("ArrowLeft"===i&&n.$.input&&0!==n.$.input.selectionStart)return;if("ArrowRight"===i&&n.$.input&&n.$.input.selectionStart<n.$.input.value.length)return;t._handleEditKeyDown(e)}};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const o=function(){setTimeout((()=>{if(n.autoOpen&&!t.editing.editRow)n.open();else{if(Smart.Utilities.Core.isMobile)return;n.select()}}),100)},a=function(e){if("string"==typeof e&&1===e.length){if("string"==typeof e&&n.autoOpen&&"Invalid Date"===(e=new Date(e)).toString())return;n.$.input.value=e}else n.value=e},r=function(){if(n.value&&n.value instanceof Smart.Utilities.DateTime){if(""===n.$.input.value)return n._validateValue(n.$.input.value,null),null;const e=Smart.Utilities.DateTime.ParseDate(n.$.input.value,n.formatString);return n._validateValue(e),n.value.toDate()}return n.value},d=function(){n.value="",n.close(),n.removeEventListener("keydown",l)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getTimeInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-time-input");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const l=function(e){let i=e.key;if(n.opened)"Enter"!==e.key&&"Escape"!==e.key||t._handleEditKeyDown(e);else if("keydown"!==e.type);else{if("ArrowLeft"===i&&n.$.input&&0!==n.$.input.selectionStart)return;if("ArrowRight"===i&&n.$.input&&n.$.input.selectionStart<n.$.input.value.length)return;t._handleEditKeyDown(e)}};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const o=function(){Smart.Utilities.Core.isMobile||setTimeout((()=>{n.select()}),50)},a=function(e){n.value=e},r=function(){const e=new Date;return n.value[0]?e.setHours(n.value[0]):e.setHours(0),n.value[1]?e.setMinutes(n.value[1]):e.setMinutes(0),e.setSeconds(0),"Invalid Date"===e.toString()?new Date:e},d=function(){n.value="",n.close(),n.removeEventListener("keydown",l)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getDateInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-date-input");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",n.rightToLeft=t.rightToLeft,n.formatString=(!e.column.cellsFormat||1!==e.column.cellsFormat.length&&"d"!==e.column.cellsFormat)&&e.column.cellsFormat?e.column.cellsFormat:"MM/dd/yyyy",n.dropDownOpenPosition="auto",t._applyCellEditorUserSettings(n,e),t.selection.enabled&&!t.selection.allowCellSelection&&n.autoOpen&&(n.autoOpen=e.editor.autoOpen=!1);const l=function(e){let i=e.key;if(n.opened)"Enter"!==e.key&&"Escape"!==e.key||t._handleEditKeyDown(e);else if("keydown"!==e.type);else{if("ArrowLeft"===i&&0!==n.selectionStart)return;if("ArrowRight"===i&&n.selectionStart<n.value.length)return;t._handleEditKeyDown(e)}};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const o=function(){setTimeout((()=>{if(e.editor.autoOpen&&!t.editing.editRow)n.open();else{if(Smart.Utilities.Core.isMobile)return;n.select()}}),50)},a=function(e){"string"==typeof e&&e.length>1&&"Invalid Date"===(e=new Date(e)).toString()||(n.value=e)},r=function(){return n.getValue()},d=function(){n.value="",n.close(),n.removeEventListener("keydown",l)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getAttachmentCellEditor(e){const t=this,i=t._getEditorId(e);if(t._dialogFile&&(t._dialogFile.cell=e),!t._cellEditors[i]){const n=document.createElement("div");n.innerHTML=`\n                <div style="display: grid;"><div title="${t.localize("addFiles")}" class="smart-grid-icon smart-icon-plus show"></div><div class="attachments"><div class="container"></div></div></div>\n            `,n.rightToLeft=t.rightToLeft,n.tabIndex=0,n.firstElementChild.style.gridTemplateColumns="25px 1fr",t.rightToLeft&&(n.style.direction="rtl");const l=n.querySelector(".smart-grid-icon"),o=n.querySelector(".attachments");l.onpointerdown=()=>{t._openFileDialog(t._dialogFile?t._dialogFile.cell:e,!0)},o.onclick=e=>{const i=n.value&&"string"==typeof n.value&&n.value.indexOf("{")>=0?JSON.parse(n.value):[],l=[...o.children[0].children].indexOf(e.target.parentNode);if(i[l]){const e=document.createElement("a");if(i[l].value.indexOf(window.location.host)>=0)fetch(i[l].value).then((e=>e.blob())).then((t=>{const n=URL.createObjectURL(t);e.download=i[l].label,e.href=n,e.click()}));else{if(i[l].value.indexOf("base64")>=0){const n=t._getFileFromBase64(i[l].value);e.href=URL.createObjectURL(n)}else e.href=i[l].value;e.target="_blank",e.click()}}},n.ondrop=i=>{i.preventDefault(),t._openFileDialog(t._dialogFile?t._dialogFile.cell:e,!0),t._dialogFile.dropZone.dropHere(i)},n.ondragover=e=>{e.preventDefault()},t._applyCellEditorUserSettings(n,e),n.classList.add("smart-grid-cell-editor");const a=function(){n.focus(),setTimeout((()=>{n.focus()}),50)},r=function(e){n.value=e,o.innerHTML=`<div class="container"><div style="justify-content: center; align-items: center; display: flex; margin-top: 3px;" class="smart-drop-file smart-micro smart-quiet">${t.localize("dropFiles")}</div></div>`;const i=o.firstElementChild;if(t._findIsFile(e)){let t="";try{t=JSON.parse(e)}catch(e){console.log(e)}e=t}Array.isArray(e)&&(i.innerHTML="",e.forEach((e=>{const t=document.createElement("div");t.title=e.label,t.classList.add("item"),t.innerHTML="<div></div>",t.firstElementChild.classList.add("smart-grid-icon","show","attachment"),e.label.indexOf("png")>=0||e.label.indexOf("jpg")>=0||e.label.indexOf("jpeg")>=0||e.label.indexOf("gif")>=0?t.firstElementChild.classList.add("smart-icon-image"):e.label.indexOf(".pdf")>=0?t.firstElementChild.classList.add("smart-icon-pdf"):e.label.indexOf(".tsv")>=0||e.label.indexOf(".txt")>=0||e.label.indexOf(".csv")>=0?t.firstElementChild.classList.add("smart-icon-text"):e.label.indexOf(".xls")>=0||e.label.indexOf(".xlsx")>=0?t.firstElementChild.classList.add("smart-icon-excel"):e.label.indexOf(".ppt")>=0?t.firstElementChild.classList.add("smart-icon-powerpoint"):e.label.indexOf(".zip")>=0||e.label.indexOf(".rar")>=0||e.label.indexOf(".7z")>=0?t.firstElementChild.classList.add("smart-icon-archive"):e.label.indexOf(".doc")>=0||e.label.indexOf(".docx")>=0?t.firstElementChild.classList.add("smart-icon-word"):e.label.indexOf(".mp3")>=0?t.firstElementChild.classList.add("smart-icon-music"):e.label.indexOf(".mp4")>=0||e.label.indexOf(".avi")>=0||e.label.indexOf(".mov")>=0||e.label.indexOf(".mp4")>=0||e.label.indexOf(".mpeg")>=0||e.label.indexOf(".webm")>=0||e.value&&e.value.indexOf("youtube")>=0?t.firstElementChild.classList.add("smart-icon-video"):t.firstElementChild.classList.add("smart-icon-file"),i.appendChild(t)})))},d=function(){let e=n.value;return e&&(Array.isArray(e)||("string"==typeof e&&e.indexOf("base64"))>=0)&&Array.isArray(e)&&(e=JSON.stringify(e)),e},s=i=>{("+"===i.key||i.altKey&&"ArrowDown"===i.key)&&t._openFileDialog(t._dialogFile?t._dialogFile.cell:e.true),"Escape"===i.key&&t.cancelEdit(),"Enter"===i.key&&t.endEdit()},c=function(){n.value="",t._dialogFile&&t._dialogFile.close(),n.removeEventListener("keydown",s)},u=function(){},m=function(){n.addEventListener("keydown",s)};t._cellEditors[i]={element:n,focus:a,blur:u,setValue:r,getValue:d,attach:m,detach:c}}return t._cellEditors[i]}_getImageCellEditor(e){const t=this,i=t._getEditorId(e);if(t._dialogFile&&(t._dialogFile.cell=e),!t._cellEditors[i]){const n=document.createElement("div");n.innerHTML=`\n                <div style="display: grid;"><div title="${t.localize("addImages")}" class="smart-grid-icon smart-icon-plus show"></div><div class="images"><div class="container"></div></div></div>\n            `,n.rightToLeft=t.rightToLeft,n.tabIndex=0,n.firstElementChild.style.gridTemplateColumns="25px 1fr",t.rightToLeft&&(n.style.direction="rtl");const l=n.querySelector(".smart-grid-icon"),o=n.querySelector(".images");l.onpointerdown=()=>{t._openFileDialog(t._dialogFile?t._dialogFile.cell:e)},o.onclick=e=>{"IMG"===e.target.nodeName&&t._openImagePreviewDialog(e.target)},n.ondrop=i=>{i.preventDefault(),t._openFileDialog(t._dialogFile?t._dialogFile.cell:e),t._dialogFile.dropZone.dropHere(i)},n.ondragover=e=>{e.preventDefault()},t._applyCellEditorUserSettings(n,e),n.classList.add("smart-grid-cell-editor");const a=function(){n.focus(),setTimeout((()=>{n.focus()}),50)},r=function(e){n.value=e,o.innerHTML=`<div class="container"><div style="justify-content: center; align-items: center; display: flex; margin-top: 3px;" class="smart-drop-image smart-micro smart-quiet">${t.localize("dropImages")}</div></div>`;const i=o.firstElementChild;if(t._findIsFile(e)){let t="";try{t=JSON.parse(e)}catch(e){console.log(e)}e=t}e&&"string"==typeof e&&e.indexOf("./")>=0&&(e=(e=e.split(",")).map((e=>({label:e,value:e})))),Array.isArray(e)&&(i.innerHTML="",e.forEach((e=>{if(e.label.indexOf(".mp4")>=0||e.label.indexOf(".avi")>=0||e.label.indexOf(".mov")>=0||e.label.indexOf(".mp4")>=0||e.label.indexOf(".mpeg")>=0||e.label.indexOf(".webm")>=0||e.value&&e.value.indexOf("youtube")>=0){const n=document.createElement("div");n.title=e.label,n.classList.add("item"),n.innerHTML="<div></div>",n.firstElementChild.classList.add("smart-grid-icon","show","attachment"),n.firstElementChild.classList.add("smart-icon-video"),i.appendChild(n),n.onclick=i=>{const n=document.createElement("a");if(e.value.indexOf(window.location.host)>=0)fetch(e.value).then((e=>e.blob())).then((t=>{const i=URL.createObjectURL(t);n.download=e.label,n.href=i,n.click()}));else{if(e.value.indexOf("base64")>=0){const i=t._getFileFromBase64(e.value);n.href=URL.createObjectURL(i)}else n.href=e.value;n.target="_blank",n.click()}i.stopPropagation(),i.preventDefault()}}else{const n=document.createElement("img");n.style.display="none";let l="";l=!!e.label&&e.label.indexOf(".gif")>=0?e.value:e.small?e.small:e.medium?e.medium:e.large?e.large:e.value,n.onload=()=>{n.style.display=""},l.indexOf("base64")>=0?n.src=l:(t._imagesCache||(t._imagesCache=[]),t._imagesCache[l]?t.uploadSettings.url?t._findUserFile(e)?(n.src=l,n.setAttribute("data-url",e.large||e.value),n.style.display=""):n.style.display="none":(n.src=l,n.setAttribute("data-url",e.large||e.value)):(t._imagesCache[l]=!0,n.style.display="none",t.uploadSettings.url?t._findUserFile(e)?(n.src=l,n.setAttribute("data-url",e.large||e.value),n.style.display=""):n.style.display="none":(n.src=l,n.style.display="")),n.onerror=()=>{n.style.display="none"}),i.appendChild(n)}})))},d=function(){let e=n.value;return e&&(Array.isArray(e)||("string"==typeof e&&e.indexOf("base64"))>=0)&&Array.isArray(e)&&(e=JSON.stringify(e)),e},s=i=>{("+"===i.key||i.altKey&&"ArrowDown"===i.key)&&t._openFileDialog(t._dialogFile?t._dialogFile.cell:e),"Escape"===i.key&&t.cancelEdit(),"Enter"===i.key&&t.endEdit()},c=function(){n.value="",t._dialogFile&&t._dialogFile.close(),t._dialogImagePreview&&t._dialogImagePreview.close(),n.removeEventListener("keydown",s)},u=function(){},m=function(){n.addEventListener("keydown",s)};t._cellEditors[i]={element:n,focus:a,blur:u,setValue:r,getValue:d,attach:m,detach:c}}return t._cellEditors[i]}_getPhoneCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-phone-input");n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const l=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-phone-input-cell-editor");const o=function(){Smart.Utilities.Core.isMobile||setTimeout((()=>{n.select()}),50)},a=function(e){n.value=e?t._fromHTMLEntities(e):"",e&&1===e.length&&(n.$.input.value=e,n.$.input.selectionStart=n.$.input.selectionEnd=n.$.input.value.indexOf(e)+1),t._phoneNumbers&&t._phoneNumbers[e]&&(n.selectedCountry=t._phoneNumbers[e])},r=function(){return t._phoneNumbers||(t._phoneNumbers=[]),n.value&&(t._phoneNumbers[n.value]=n.selectedCountry),n.value},d=function(){n.value="",n.removeEventListener("keydown",l)},s=function(){},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getPasswordCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-password-input");n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const l=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-password-input-cell-editor");const o=function(){Smart.Utilities.Core.isMobile||setTimeout((()=>{n.select()}),50)},a=function(e){n.value=e,1===e.length&&(n.$.input.selectionStart=n.$.input.selectionEnd=n.$.input.value.indexOf(e)+1)},r=function(){return n.value},d=function(){n.value="",n.removeEventListener("keydown",l)},s=function(){},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getMaskCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-masked-text-box");n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const l=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-masked-text-box-cell-editor");const o=function(){Smart.Utilities.Core.isMobile||setTimeout((()=>{n.select()}),50)},a=function(e){n.value=e,1===e.length&&(n.$.input.selectionStart=n.$.input.selectionEnd=n.$.input.value.indexOf(e)+1)},r=function(){return n.value},d=function(){n.value="",n.removeEventListener("keydown",l)},s=function(){},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:s,setValue:a,getValue:r,attach:c,detach:d}}return t._cellEditors[i]}_getNumberInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-number-input");if(e&&e.editor&&(void 0!==e.editor.min&&(e.editor.min=parseInt(e.editor.min)),void 0!==e.editor.max&&(e.editor.max=parseInt(e.editor.max))),t._applyCellEditorUserSettings(n,e),"{}"===JSON.stringify(n.numberFormat)){let i={};if(e.column.cellsFormat)if(e.column.cellsFormat.indexOf("c")>=0){i={style:"currency",currency:t.messages[t.locale].calendar.currency};let n=parseInt(e.column.cellsFormat.substring(1));isNaN(n)||(i.maximumFractionDigits=n)}else if(e.column.cellsFormat.indexOf("p")>=0){i={style:"percent"};let t=parseInt(e.column.cellsFormat.substring(1));isNaN(t)||(i.maximumFractionDigits=t,i.minimumFractionDigits=t)}else if(e.column.cellsFormat.indexOf("d")>=0){i={style:"decimal"};let t=parseInt(e.column.cellsFormat.substring(1));isNaN(t)||(i.maximumFractionDigits=t)}else if(e.column.cellsFormat.indexOf("f")>=0||e.column.cellsFormat.indexOf("n")>=0){i={};let t=parseInt(e.column.cellsFormat.substring(1));isNaN(t)||(i.minimumFractionDigits=t,i.maximumFractionDigits=t)}else e.column.Intl&&e.column.Intl.NumberFormat&&(i=e.column.Intl.NumberFormat);n.numberFormat=i}n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-number-input-cell-editor");const l=function(e){t._handleEditKeyDown(e)},o=function(){Smart.Utilities.Core.isMobile||setTimeout((function(){n.focus(),t.$.scrollView.scrollTop=0}),50)},a=function(){},r=function(e){n.isReady&&("string"==typeof e&&n.numberFormat&&n.numberFormat.style&&"percent"===n.numberFormat.style&&(e=parseFloat(e),e=""+(e/=100)),null!==e&&""!==e||(e=0),n.setValue(e))},d=function(){return n.getValue()},s=function(){n.removeEventListener("keydown",l)},c=function(){n.addEventListener("keydown",l)};t._cellEditors[i]={element:n,focus:o,blur:a,getValue:d,setValue:r,attach:c,detach:s}}return t._cellEditors[i]}_getRatingCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("div");n.classList.add("smart-input"),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-rating-cell-editor"),n.tabIndex=0;const l=e.column.editor.max?e.column.editor.max:5,o=e.value,a=o?parseInt(o):0;if(n.value=o,n.firstElementChild&&n.firstElementChild.hasAttribute("value")){if(a===n.firstElementChild.getAttribute("value"))return t.cell._setStyle(n),void t.setAttribute("template",t.cell.template)}let r='<div class="rating">';for(let e=0;e<l;e++){let t="";a>0&&a>e&&(t="value"),r+=`<div title="${e+1}" value="${e+1}" class="smart-grid-icon show smart-icon-star ${t}"></div>`}r+="</div>",n.innerHTML=r;const d=function(){},s=function(e){if(" "!==e.key){switch(e.key){case"ArrowLeft":case"ArrowDown":case"ArrowRight":case"ArrowUp":if(t.editing.dialog.enabled)return;t.endEdit()}t._handleEditKeyDown(e)}else d()},c=e=>{let t="";n.value===e&&(e=0);for(let i=0;i<l;i++){let n="";e>0&&e>i&&(n="value"),t+=`<div title="${i+1}" value="${i+1}" class="smart-grid-icon show smart-icon-star ${n}"></div>`}t+="",n.firstElementChild.innerHTML=t,n.value=e};n.firstElementChild.onpointerdown=e=>{if(e.target.hasAttribute("value")){const t=e.target.getAttribute("value");c(t)}},n.firstElementChild.onpointermove=e=>{if(e.target.hasAttribute("value")){const t=[...e.target.parentElement.children],i=t.indexOf(e.target);t.forEach(((e,t)=>{e.classList.remove("hover"),t<=i&&e.classList.add("hover")}))}},n.firstElementChild.onpointerleave=e=>{if(e.target.classList.contains("rating")){const t=[...e.target.children];t.indexOf(e.target);t.forEach(((e,t)=>{e.classList.remove("hover")}))}};const u=function(e){c(e)},m=function(){},g=function(){return n.value},p=function(){n.value=!1,n.removeEventListener("click",d),n.removeEventListener("keydown",s)},f=function(){},h=function(){n.addEventListener("keydown",s),n.addEventListener("click",d)};t._cellEditors[i]={getValue:g,setValue:u,focus:m,blur:f,element:n,detach:p,attach:h}}return t._cellEditors[i]}_getVoteCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("div");n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-vote-cell-editor"),n.tabIndex=0,n.value=e.value;const l=e=>{e=e?e.split():[];const i=t.users?t.users.length:1,n=e.length*(100/i)+"%;";return`<div vote-value class="smart-flex middle center smart-votes-cell-component">\n                <div class="smart-flex middle center smart-vote-button ${e.length>0?"voted":""}">\n                <span class="smart-icon smart-grid-icon show ${e.length>0?"smart-icon-check":""}"></span>\n                </div>\n                <div class="smart-votes-bar-container">\n                    <div class="smart-votes-bar-component">\n                        <div class="smart-votes-bar" style="width: ${n} opacity: 1;"></div>\n                        <div class="smart-votes-bar-frame" style="width: 100%;  opacity: 0.2;"></div>\n                    </div>\n                </div>\n                <div class="smart-voters-info">${e.length}</div>\n                </div>`},o=e.value;n.innerHTML=`<div value="${o}" class="vote">${l(o)}</div>`,n.style.setProperty("--smart-check-template-color","var(--smart-primary)"),n.style.setProperty("--smart-check-template-forecolor","#ffffff"),e.column.templateSettings&&e.column.templateSettings.color&&(n.style.setProperty("--smart-check-template-color",t.cell.column.templateSettings.color),n.setAttribute("color",""));const a=(e,i)=>{const n=e.firstElementChild.firstElementChild,l=t.users?t.users.length:1,o=i.length*(100/l)+"%",a=i.length>0?"voted":"",r=n.firstElementChild,d=r.children[0];n.children[1].children[0].classList.remove("smart-votes-bar-animate"),t.isScrolling||n.children[1].children[0].classList.add("smart-votes-bar-animate");const s=n.children[1].firstElementChild.children[0],c=n.children[2];r.classList.remove("voted"),d.classList.remove("smart-icon-check"),a&&(d.classList.add("smart-icon-check"),r.classList.add("voted")),c.textContent=i.length,s.style.width=o,e.value=""+i,e.firstElementChild.setAttribute("value",i)};n.firstElementChild.onpointerdown=e=>{t.editing.editRow.id;const i=n.value,l=i?(""+i).split(","):[],o=t._currentUser?""+t._currentUser.info.id:null;void 0!==o&&(l.indexOf(o)>=0?(l.splice(l.indexOf(o),1),a(n,l)):(l.push(o),a(n,l)))},n.firstElementChild.onpointerenter=i=>{let l=n.value;if(l){if(t.users){let e="";l=(""+l).split(","),t.users.forEach((t=>{(l.indexOf(""+t.id)>=0||l.indexOf(""+t.value)>=0)&&(e+=t.name||t.label)})),e&&(l=t.localize("votes",{value:e}))}}else l=t.localize("noVotes");e.element._createTooltip(i,l,n,"top")},n.firstElementChild.onpointerleave=()=>{grid._cellTooltip&&(grid._cellTooltip.style.visibility="hidden")};const r=function(){},d=function(e){if(" "!==e.key){switch(e.key){case"ArrowLeft":case"ArrowDown":case"ArrowRight":case"ArrowUp":if(t.editing.dialog.enabled)return;t.endEdit()}t._handleEditKeyDown(e)}else r()},s=function(e){n.value=""+e},c=function(){Smart.Utilities.Core.isMobile||(n.focus(),setTimeout((function(){n.focus()}),25))},u=function(){return""+n.value},m=function(){n.value=!1,n.removeEventListener("click",r),n.removeEventListener("keydown",d)},g=function(){},p=function(){n.addEventListener("keydown",d),n.addEventListener("click",r)};t._cellEditors[i]={getValue:u,setValue:s,focus:c,blur:g,element:n,detach:m,attach:p}}return t._cellEditors[i]}_getCheckBoxCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const e=document.createElement("div");e.classList.add("smart-input"),e.classList.add("smart-grid-cell-editor"),e.classList.add("smart-grid-check-box-cell-editor"),e.tabIndex=0;const n=function(){!0!==e.value&&!1!==e.value&&null!==e.value&&(e.value=!1),null===e.value?e.value=!1:e.value=!e.value,!1===e.value?e.removeAttribute("checked"):e.setAttribute("checked",e.value?"":"indeterminate")},l=function(e){if(" "!==e.key){switch(e.key){case"ArrowLeft":case"ArrowDown":case"ArrowRight":case"ArrowUp":if(t.editing.dialog.enabled)return;t.endEdit()}t._handleEditKeyDown(e)}else n()},o=function(t){e.value="string"==typeof t?"false"!==t&&"0"!==t&&"null"!==t&&"undefined"!==t:t,!1===e.value?e.removeAttribute("checked"):e.setAttribute("checked",e.value?"":"indeterminate")},a=function(){Smart.Utilities.Core.isMobile||(e.focus(),setTimeout((function(){e.focus()}),25))},r=function(){return e.value},d=function(){e.value=!1,e.removeEventListener("click",n),e.removeEventListener("keydown",l)},s=function(){},c=function(){e.addEventListener("keydown",l),e.addEventListener("click",n)};t._cellEditors[i]={getValue:r,setValue:o,focus:a,blur:s,element:e,detach:d,attach:c}}return t._cellEditors[i]}_unescapeString(e){if(null==e)return e;if("string"!=typeof e)return e;const t=[{regex:"&",entity:"&amp;"},{regex:">",entity:"&gt;"},{regex:"<",entity:"&lt;"},{regex:'"',entity:"&quot;"},{regex:"'",entity:"&#39;"},{regex:"=",entity:"&#x3D;"},{regex:"/",entity:"&#x2F;"},{regex:"`",entity:"&#x60;"}];let i;for(let n in t)i=new RegExp(t[n].entity,"g"),e=e.replace(i,t[n].regex);return e}_fromHTMLEntities(e){const t=this,i=t._textArea?t._textArea:document.createElement("textarea");return i.innerHTML=e,t._textArea=i,i.value}_toHtmlEntities(e){return e.replace(/[^a-z0-9\s]/gmu,(e=>"&#"+e.codePointAt(0)+";"))}_getEditorValue(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors)return;const n=t._cellEditors[i];if(!n)return;const l=function(t){switch(e.column.dataType){case"string":null==t?t="":void 0!==t&&"number"==typeof t?t=parseFloat(t):t&&"object"==typeof t&&t[0]&&t[0].label?t=t[0].label.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/[\r\n]+/g," ").replace(/\p{Extended_Pictographic}/gu,(e=>"&#"+e.codePointAt(0)+";")):t&&"object"==typeof t&&t instanceof Date?t=t.toLocaleString():"richText"===e.column.template?t=t.replace(/<script/g,"&lt;script").replace(/script>/g,"&gt;script"):"textarea"===e.column.editor.template?t=(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/\p{Extended_Pictographic}/gu,(e=>"&#"+e.codePointAt(0)+";"))).replaceAll("\t"," "):t.replace&&(t=(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/[\r\n]+/g," ").replace(/\p{Extended_Pictographic}/gu,(e=>"&#"+e.codePointAt(0)+";"))).replaceAll("\t"," "));break;case"float":case"int":case"number":t&&"object"==typeof t&&void 0!==t.value?t.value="int"===e.column.dataType?parseInt(t.value):parseFloat(t.value):(t="int"===e.column.dataType?parseInt(t):parseFloat(t),isNaN(t)&&(t=0));break;case"bool":case"boolean":"true"!==t&&"1"!==t||(t=!0),"false"!==t&&"0"!==t||(t=!1);break;case"date":if(t instanceof Date)return t;"string"==typeof t&&(t=new Date(t));break;case"dateTime":t=new Smart.Utilities.DateTime(t)}return t};let o=null;switch(e.editor.template){case"dateRangeInput":try{o=n.getValue()}catch(t){o=e.value}if(e.editor.getValue){const t=e.editor.getValue(e,o);void 0!==t&&(o=t)}break;case"input":case"autoComplete":case"dropDownList":case"list":case"comboBox":case"numberInput":case"slider":case"dateInput":case"timeInput":case"deteTimePicker":case"checkBox":try{o=l(n.getValue())}catch(t){o=e.value}if(e.editor.getValue){const t=e.editor.getValue(e,o);void 0!==t&&(o=t)}break;case"multiComboInput":case"attachment":case"image":o=n.getValue();break;default:o=l(n.getValue())}let a=!0,r=!1,d=!1;if(e.column.validator)a=e.column.validator.evaluate(o,e.row.data);else if("string"==typeof o){const t=e.editor.minLength||e.editor.min||0,i=e.editor.maxLength||e.editor.max||999999;(o.length<t||o>i)&&(a=!1),o.length<t&&(r=!0),o.length>i&&(d=!0),e.editor.required&&0===o.length&&(a=!1),e.editor.instance.element&&e.editor.instance.element.checkValidity&&(a=e.editor.instance.element.checkValidity())}if(a)return o;let s=null;const c=e.editor.instance.element;return c&&(s=c.validity,s&&(s.custom&&delete s.custom,r&&(s.custom={minLength:!0,value:e.editor.min}),d&&(s.custom={maxLength:!0,value:e.editor.max}),s.message=c.validationMessage)),{error:!0,validity:s,value:o}}_beginRowEdit(e,t){const i=this;if(e===i.editing.editRow)return!1;if(i.editing.editRow){if(!i.endEdit())return!1}const n=e.cells;i.editing.editRow=e,i.editing.commandColumn.visible&&(i.editing.isEditing=!1,i.refresh(),i.editing.isEditing=!0),e.isEditing=!0;let l=!1;for(let e=0;e<n.length;e++){const o=n[e],a=o.column;if(!a.allowEdit||!1===a._visible)continue;const r=i._beginCellEdit(o);if(r){if(!0!==i.editing.recordNavigation&&i.editing.enabled){if(Smart.Utilities.Core.isMobile)continue;let e=!0;switch(o.editor.template){case"textarea":case"slider":e=!1}e&&(t?o===t&&o.editor.instance.focus():r&&!l&&(l=!0,o.editor.instance.focus()))}i.editing.commandColumn.visible&&o.column.commandColumn&&o.render()}}return!0}_beginCellEdit(e,t){const i=this;if(e.isEditing&&"checkBox"!==e.column.template&&"vote"!==e.column.template)return!1;if(i._isUpdating)return!1;if(i.onCellBeginEdit){if(!i.onCellBeginEdit(e.row.id,e.column.dataField,e.value,i))return!1}if(i._deleteCopyRects(),e.column.allowEdit&&("tags"===e.column.template||"list"===e.column.template)&&!i.editing.allowListOpenOnContentClick&&e.element){const n=e.element.offsetWidth,l=(e.element.offsetHeight,i.offset(e.element));let o=!1;if(t&&(t.pageX>l.left+n-20&&t.pageX<l.left+n&&(o=!0),!1===o))return!1}if(e.column.allowEdit&&("image"===e.column.template||"attachment"===e.column.template)&&e.element){e.element.offsetWidth,e.element.offsetHeight;const n=i.offset(e.element);let l=!1;if(t&&(t.pageX>n.left&&t.pageX<n.left+20&&(l=!0),l)){e.element.querySelector(".smart-icon-plus")&&setTimeout((()=>{i._openFileDialog(i._dialogFile?i._dialogFile.cell:e)}),50)}}if(e.column.allowEdit&&"vote"===e.column.template&&!i.editing.dialog.enabled)return!1;if(e.column.allowEdit&&"function"==typeof e.column.allowEdit){if(!e.column.allowEdit(e.row.id,e.column.dataField,e.value,e.row.data,i))return!1}let n=!1;if(e.column.autoGenerated&&e.column.rowHeaderColumn&&i.editing.allowRowHeaderEdit&&new Date-i._clickTime<i.behavior.doubleClickTimingDelay&&i._clickedCell===e.element&&(n=!0),(!e.column.allowEdit||e.column.autoGenerated||e.readonly)&&!n)return!1;if(i.editing.editCell&&!i.editing.editRow){i._fireEndEdit=!0;if(!1===i._endCellEdit())return!1}if(i._cellEditors||(i._cellEditors=[]),i.editing.editRow||(i.editing.editCell=e),i.editing.commandColumn.visible&&!i.editing.editRow&&(i.editing.isEditing=!1,i.refresh(),i.editing.isEditing=!0),!e.row.element)return!1;e.row.element.setAttribute("edit",""),i.editing.isEditing=!0,i._selection.selectionRect&&i._selection.selectionRect.classList.add("smart-visibility-hidden");const l=t=>{const n=t.element;i.editing.dialog.enabled?(i._settingsDialogRowId=e.row.id,i._openEditDialog(e,t)):(e.element||e.createElement(),e.element.setAttribute("editor","string"==typeof e.editor.template?e.editor.template:"template"),e.element.content.innerHTML="",e.element.content.appendChild(n),e.column.cellsWrap||e.element.content.classList.add("nowrap"),i.editing.editRow&&e.element.setAttribute("row-editor","")),t.attach(),e.editor.row=e.row,e.editor.column=e.column,e.editor.cell=e,e.editor.instance=t,e.isEditing=!0},o=i._cellsUpdatedValues?i._cellsUpdatedValues[e.row.id+"_"+e.column.dataField]:void 0;let a=void 0!==o?o:e.value;if(void 0===a){a="";const t=e.column;"number"===t.dataType||"int"===t.dataType||"float"===t.dataType?a=0:"date"===t.dataType&&(a=new Date,a.setHours(0,0,0))}switch(e.editor||(e.editor="input"),"string"==typeof e.editor&&(e.canNotify=!1,e.editor={template:e.editor,autoFocus:!0},e.canNotify=!0),e.editor.template){default:case"custom":{const t=i._getCustomCellEditor(e);l(t),t.setValue(a);break}case"attachment":{const t=i._getAttachmentCellEditor(e);l(t),t.setValue(a);break}case"image":{const t=i._getImageCellEditor(e);l(t),t.setValue(a);break}case"rating":{const t=i._getRatingCellEditor(e);l(t);let n=parseInt(a);isNaN(n)&&(n=0),t.setValue(n);break}case"checkBox":{const n=i._getCheckBoxCellEditor(e);l(n);const o=!0===a||1===a;if("checkBox"===e.template&&t){(i.enableShadowDOM?i.shadowRoot:i.getRootNode()).elementsFromPoint(t.clientX,t.clientY)[0].classList.contains("smart-input")?n.setValue(!o):n.setValue(o)}else n.setValue(o);break}case"vote":{const t=i._getVoteCellEditor(e);l(t),t.setValue(a);break}case"grid":{const t=i._getGridCellEditor(e);l(t),t.setValue(a);break}case"autoComplete":{const t=i._getAutoCompleteCellEditor(e);l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&t.element.open();break}case"list":case"dropDownList":{e.editor.autoOpen=!0,e.editor.readonly=!0,e.editor.dropDownButtonPosition="right";const t=i._getAutoCompleteCellEditor(e);l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&t.element.open();break}case"comboBox":{e.editor.readonly=!1,e.editor.dropDownButtonPosition="right";const t=i._getAutoCompleteCellEditor(e);l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&t.element.open();break}case"password":{const t=i._getPasswordCellEditor(e);l(t),t.setValue(a);break}case"phone":{const t=i._getPhoneCellEditor(e);l(t),t.setValue(a);break}case"maskedTextBox":{const t=i._getMaskCellEditor(e);l(t),t.setValue(a);break}case"multiInput":{const t=i._getAutoCompleteCellEditor(e,"smart-multi-input");l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&t.element.open();break}case"checkInput":{const t=i._getAutoCompleteCellEditor(e,"smart-check-input");l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&t.element.open();break}case"tags":case"multiComboInput":{e.editor.readonly=!0,e.editor.autoOpen=!0;const t=i._getMultiComboInputCellEditor(e);l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&setTimeout((()=>{t.element.open()}),100);break}case"timeInput":{const t=i._getTimeInputCellEditor(e);l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&t.element.open();break}case"dateInput":{const t=i._getDateInputCellEditor(e);l(t),t.setValue(a);break}case"dateRangeInput":{const t=i._getDateRangeInputCellEditor(e);l(t),t.setValue(a),e.editor.autoOpen&&!i.editing.editRow&&setTimeout((()=>{t.element.open()}),100);break}case"dateTimePicker":{const t=i._getDateTimePickerCellEditor(e);l(t),t.setValue(a);break}case"slider":{const t=i._getSliderCellEditor(e);l(t),t.setValue(a);break}case"colorInput":{const t=i._getColorInputCellEditor(e);l(t),t.setValue(a);break}case"textarea":case"textArea":{const t=i._getTextAreaCellEditor(e);l(t),e.formula?t.setValue(e.formula):t.setValue(a);break}case"numberInput":case"text":case"input":{const t="numberInput"===e.editor.template?i._getNumberInputCellEditor(e):i._getInputCellEditor(e);l(t),e.formula?t.setValue(e.formula):t.setValue(a);break}}if(!e.editor.isInitialized&&(e.editor.isInitialized=!0,e.editor.onInit)){const t=e.editor.onInit(e.row.index,e.column.dataField,e.editor.instance.element,e.row.data);if(t&&t instanceof Promise)t.then((t=>{const i="custom"===e.editor.template?e.editor.instance.element.firstElementChild:e.editor.instance.element;for(let e in t)i[e]=t[e]}));else if(t){const i=t,n="custom"===e.editor.template?e.editor.instance.element.firstElementChild:e.editor.instance.element;for(let e in i)n[e]=i[e]}}if(e.editor.onRender){const t=e.editor.onRender(e.row.index,e.column.dataField,e.editor.instance.element,e.row.data);if(t&&t instanceof Promise)t.then((t=>{const i="custom"===e.editor.template?e.editor.instance.element.firstElementChild:e.editor.instance.element;for(let e in t)i[e]=t[e]}));else if(t){const i=t,n="custom"===e.editor.template?e.editor.instance.element.firstElementChild:e.editor.instance.element;for(let e in i)n[e]=i[e]}}return i.editing.editCell&&setTimeout((function(){e.editor.instance.focus()}),25),"checkBox"===e.editor.template&&(i._fireEndEdit=!0,i._endCellEdit()),!0}_onColumnDoubleClick(e){this._beginColumnEdit(e)}_beginColumnEdit(e){const t=this;if(t.editing.enabled&&t.editing.allowColumnHeaderEdit&&e.allowHeaderEdit){t.editing.isEditing&&t.endEdit(),t.editing.editColumn=e,t._cellEditors||(t._cellEditors=[]);const i=t._getInputCellEditor({column:e,row:t.rows[0],editor:{template:"input"}});i.element.value=e.label,i.focus(),e.headerEditor=i,e.element.setAttribute("edit",""),e.element.label.appendChild(i.element),i.attach(),t.editing.isEditing=!0;t.$.fireEvent("beginEdit",{id:null,dataField:e.dataField,row:null,column:e,cell:null,data:null,value:null}).defaultPrevented&&t.cancelEdit()}}_endColumnEdit(e){const t=this;if(!1===t.editing.isEditing||t.editing.isEditing&&null===t.editing.editColumn)return!1;const i=t.editing.editColumn;return i.canNotify=!1,i.headerEditor.detach(),i.headerEditor.element.parentNode.removeChild(i.headerEditor.element),!0!==e&&(i.label=i.headerEditor.getValue()),i.headerEditor=null,t.editing.isEditing=!1,i.element.removeAttribute("edit"),i.element.scrollLeft=0,t.editing.editColumn=null,i.canNotify=!0,i.refresh(),t._recycle(),!0}_cancelColumnEdit(){this._endColumnEdit(!0)}_onCellClick(e,t){const i=this;if(e.row.addNewRow)e.row.inline?i._addNewGridRow():"far"===e.row.freeze?i._insertNewRowAfter():i._insertNewRowBefore();else if(!e.row.filterRow&&i.editing.enabled)if(i.editing.editColumn)i.endEdit();else{if(delete i._beginEditKey,i.editing.commandColumn.visible)if(e.column.commandColumn){const n=(i.enableShadowDOM?i.shadowRoot:i.getRootNode()).elementsFromPoint(t.clientX,t.clientY);let l=null;for(let e=0;e<n.length;e++)if(n[e].classList.contains("smart-grid-command-item")){l=n[e];break}if(l||(l=e.element.querySelector(".smart-grid-command-item")),l&&!l.classList.contains("smart-hidden")){const n=l.getAttribute("command");return void i._applyCommand(n,[e.row,t])}}else if(i.editing.commandColumn.inline){const e=(i.enableShadowDOM?i.shadowRoot:i.getRootNode()).elementsFromPoint(t.pageX,t.pageY);for(let t=0;t<e.length;t++)if(e[t].classList.contains("smart-grid-command-item"))return}if("none"===i.editing.action&&i.editing.isEditing){let t=!1;i.editing.editCell&&i.editing.editCell.row!==e.row&&(t=!0),i.editing.editRow&&i.editing.editRow!==e.row&&(t=!0),i.editing.editColumn&&(t=!0),t&&i.endEdit()}if(e.column.autoGenerated){if(i.editing.allowRowHeaderEdit&&e.column.rowHeaderColumn){if(i.editing.isEditing&&i.endEdit(),void 0!==e.row.label)return;i._beginCellEdit(e,t),i.editing.isEditing&&i.$.fireEvent("beginEdit",{id:e.row.id,dataField:e.column.dataField,row:e.row,column:e.column,cell:e,data:e.row.data,value:e.value})}}else if("click"===i.editing.action&&(!i.selection.enabled||e.selected||"extended"!==i.selection.mode))if("cell"===i.editing.mode){const n=e.parent();if(void 0!==e.row.label)return;if("rating"===e.column.template)return void(i._handleRatingClick&&i._ratingElement&&i._handleRatingClick(i._ratingElement));if("vote"===e.column.template)return void(i._handleVoteClick&&i._voteElement&&i._handleVoteClick(i._voteElement));!i._autoHeight&&i.ensureVisible(e.row.id,e.column.dataField),setTimeout((function(){if(n)i._beginCellEdit(n,t),i.$.fireEvent("beginEdit",{id:n.row.id,dataField:n.column.dataField,row:n.row,column:n.column,cell:n,data:n.row.data,value:n.value});else{i._beginCellEdit(e,t);i.$.fireEvent("beginEdit",{id:e.row.id,dataField:e.column.dataField,row:e.row,column:e.column,cell:e,data:e.row.data,value:e.value}).defaultPrevented&&i.cancelEdit()}}),25)}else if("row"===i.editing.mode){if(void 0!==e.row.label)return;i._beginRowEdit(e.row,e,t);i.$.fireEvent("beginEdit",{id:e.row.id,dataField:e.column.dataField,row:e.row,column:e.column,cell:e,data:e.row.data,value:e.value}).defaultPrevented&&i.cancelEdit()}}}_onCellDoubleClick(e,t){const i=this;i.editing.enabled&&("doubleClick"!==i.editing.action||i.editing.isEditing||e.column.autoGenerated||("cell"===i.editing.mode?i._beginCellEdit(e,t):"row"===i.editing.mode&&i._beginRowEdit(e.row,e,t)))}_onRowClick(){}_onRowDoubleClick(){}beginEdit(e,t){const i=this,n=i.rowById[e];n&&i._beginEdit(n,t)}cancelEdit(){const e=this;if(e.editing.isEditing){if(e.__selectionStarted&&e._dragSelectionEnd(),e._errorOverlay){if(e._errorOverlay.remove(),e._errorMessage&&e._errorMessage.remove(),e.editing.editCell&&(e.editing.editCell.error=""),e.editing.editRow){const t=e.editing.editRow.cells;for(let e=0;e<t.length;e++){t[e].error=""}e.editing.editRow.element.removeAttribute("error"),e.editing.editRow.error=null}e._isUpdating=!1}if(e.editing.editRow){const t=e.editing.editRow.cells;for(let e=0;e<t.length;e++){const i=t[e],n=i.element;0===e&&i.row.element.removeAttribute("edit"),n&&(n.removeAttribute("editor"),n.removeAttribute("error"),n.content.innerHTML=""),i.isEditing=!1}e.editing.editRow=null}else if(e.editing.editCell){const t=e._getEditorId(e.editing.editCell);e._cellEditors[t].detach(),e.editing.editCell.row.element.removeAttribute("edit"),e.editing.editCell.row.element.removeAttribute("error"),e.editing.editCell.element.removeAttribute("editor"),e.editing.editCell.element.removeAttribute("error"),e.editing.editCell.element.content.innerHTML="",e.editing.editCell.isEditing=!1,e.editing.editCell=null}else e.editing.editColumn&&e._cancelColumnEdit();e.editing.dialog.visible&&e.editing.dialog.enabled&&e._dialogEdit.close(),e.editing.isEditing=!1,e._recycle(!1),e.editing.commandColumn.visible&&e.refresh(),e.$.fireEvent("cancelEdit"),e.focus()}}deleteColumn(e){const t=this,i=this.columns.findIndex((t=>t.dataField===e));i>=0&&t.columns.splice(i,1)}removeRow(e,t){return this.deleteRow(e,t)}deleteSelectedRows(){const e=that.getSelectedRows().map((e=>e[0]));this.removeRow(e)}getHierarchicalIds(e,t){const i=this;if(t.push(e.$.id),e.children)for(const n of e.children)i.getHierarchicalIds(n,t)}deleteRow(e,t){const i=this,n=i.hasAttribute("tree");if(e&&Array.isArray(e)){if(i.onRowRemove){if(!1===i.onRowRemove(e,i))return}i.beginUpdate();const n=i.dataSource.canNotify,l=i.rows.canNotify;i.rows.canNotify=!1,i.dataSource.canNotify=!1;const o=i.onRowRemoved;i.onRowRemoved=null;let a=[];for(let n in e){const l=i.rowById[e[n]];let o=l&&l.data&&l.data.$?l.data.$.index:l.index;a.push(o),i.deleteRow(e[n],t),i.dataSource.removeAt(o)}return i.rows.canNotify=l,i.dataSource.canNotify=n,i.onRowRemoved=o,i.endUpdate(),i._refreshSummary(),void(o&&o(e,a,i))}const l=i.rowById[e];if(!l)return!1;const o=function(e){if(!0===i.editing.batch||i.editing.batch&&i.editing.batch.indexOf("delete")>=0)i._batchDeleteRow(e);else{if(i.dataSource&&i.dataSource.virtualDataSource)return i._editInfo={row:e.data},void i._virtualDataRequest("remove",(function(n){if(n){const n=i.rows.indexOf(e);i.rows.splice(n,1),delete i.rowById[e.id],t&&t(e)}}));const n=i.rows.indexOf(e);i._removeAt(n)}t&&t(e)};if(i.editing.deleteDialog.enabled)i._openDeleteRowDialog(l,o);else if(n){const e=[];i.getHierarchicalIds(l.data,e),e.forEach((function(e){const t=i.rowById[e];o(t)}))}else o(l);return!0}addRow(e,t,i){const n=this;e||(e={});for(let t=0;t<n.columns.length;t++){const i=n.columns[t];void 0!==i.defaultValue&&void 0===e[i.dataField]?e[i.dataField]=i.defaultValue:"uuid"===i.template&&(e[i.dataField]=n._generateUUID())}if(void 0===t&&(t=!0),n.dataSource&&n.dataSource.virtualDataSource)n._editInfo={row:e},n._virtualDataRequest("add",(l=>{l&&(n._add(e,t?n.rows.length:0),i&&i(t?n.rows[n.rows.length-1]:n.rows[0]))}));else{if(n.editing.batch)return void(t?n._insertNewRowAfter(i):n._insertNewRowBefore(i));"number"==typeof t?n._add(e,t,i):n._add(e,t?n.rows.length:0,i)}}insertRow(e,t,i){this.addRow(e,t,i)}flashCell(e,t){const i=this;i._flashTimer&&clearTimeout(i._flastTimer),i.highlightedCells&&i.highlightedCells[e]&&(i.highlightedCells[e][t]="off_smart-flash-cell"),i.highlightCell(e,t,"smart-flash-cell"),i._flashTimer=setTimeout((()=>{i.highlightedCells&&i.highlightedCells[e]&&(i.highlightedCells[e][t]="off_smart-flash-cell",delete i.highlightedCells[e][t])}),2e3)}highlightCell(e,t,i){const n=this,l=n.rowById[e],o=n.columnByDataField[t];l&&o&&(n.highlightedCells||(n.highlightedCells=[]),n.highlightedCells[e]||(n.highlightedCells[e]=[]),void 0!==n.highlightedCells[e][t]?i?n.highlightedCells[e][t].startsWith("off")?n.highlightedCells[e][t]=i||"":n.highlightedCells[e][t]="off_"+i:delete n.highlightedCells[e][t]:n.highlightedCells[e][t]=i||"",n._recycle(!1))}highlightRow(e,t){const i=this;i.rowById[e]&&(i.highlightedRows||(i.highlightedRows=[]),void 0!==i.highlightedRows[e]?t?i.highlightedRows[e].startsWith("off")?i.highlightedRows[e]=t||"":i.highlightedRows[e]="off_"+t:delete i.highlightedRows[e]:i.highlightedRows[e]=t||"",i._recycle(!1))}highlightColumn(e,t){const i=this.columnByDataField[e];i.highlight=!i.highlight,i._highlightCSS=t,this._recycle(!1)}setRowProperty(e,t,i){const n=this.rowById[e];n&&(n[t]=i)}getRowProperty(e,t){const i=this.rowById[e];if(i)return i[t]}getColumn(e){if(!this.columnByDataField)return null;const t=this.columnByDataField[e];return t||null}getColumnProperty(e,t){if(!this.columnByDataField)return null;const i=this.columnByDataField[e];return i?i[t]:void 0}setColumnProperty(e,t,i){const n=this.columnByDataField[e];n&&(n[t]=i)}getCellValue(e,t){const i=this.rowById[e],n=this.columnByDataField[t];if(!i||!n)return;return i.getCell(t).value}setCellValue(e,t,n,l){const o=this,a=o.rowById[e],r=o.columnByDataField[t];if(!a||!r)return!1;if(o.formulas&&n&&"string"==typeof n){const e=a.getCell(t);if(e){if(e.formula!==n){const t=e.canNotify;e.canNotify=!1,n.startsWith("=")?e.formula=o._unescapeString(n):e.formula=null,e.canNotify=t}if(n.startsWith("=")&&e.formula){const t=o._formulaParser;if(t){let i=t.parse(e.formula.slice(1));n=isNaN(i)?"#VALUE!"===n?0:"#ERROR!"===n?"#ERROR!":i:i}}}}let d=[];if(r.validationRules&&r.validationRules.length>0&&(d=((e,t)=>{let n=[];for(let l of e){switch(l.type){case"min":n.min=i.min(t,l.value);break;case"max":n.max=i.max(t,l.value);break;case"minLength":n.minLength=i.minLength(t,l.value);break;case"maxLength":n.maxLength=i.maxLength(t,l.value);break;case"minDate":n.minDate=i.minDate(t,l.value);break;case"maxDate":n.maxDate=i.maxDate(t,l.value);break;case"required":n.required=i.required(t);break;case"requiredTrue":n.requiredTrue=i.requiredTrue(t);break;case"pattern":n.pattern=i.pattern(t,l.value);break;case"email":n.email=i.email(t);break;case"null":n.null=i.null(t)}null===n[l.type]&&delete n[l.type]}return n})(r.validationRules,n),Object.keys(d).length>0))return!1;const s=()=>{if(!0===o.editing.batch||o.editing.batch&&o.editing.batch.indexOf("update")>=0){const e=a.getCell(t);return o._batchUpdateCell(e.row,e.column,n,e.value),l&&l(a),void o._recycle()}o.beginUpdate();const e=a.getCell(t);o._setCellUndoRedo(e,e.value,n),e.value=n,o.endUpdate(),l&&l(a)};if(o.dataSource&&o.dataSource.virtualDataSource){o.dataSource.id?a[o.dataSource.id]=e:a.id||(a.id=e);const i={};for(let e=0;e<o.columns.length;e++){const l=o.columns[e],r=a.getCell(l.dataField);i[l.dataField]=r.value,l.dataField===t&&(i[l.dataField]=n)}o._editInfo={row:i},o._virtualDataRequest("update",(function(e){e&&s(),o.appearance.displayLoadingIndicator=!1,o._setLoadingIndicatorVisibility()}))}else s()}setRowData(e,t){this.updateRow(e,t,null)}getRowData(e){const t=this.rowById[e];if(!t)return null;const i=JSON.parse(JSON.stringify((e=>{const t={};for(let i in e)"leaf"!==i&&"data"!==i&&"settings"!==i&&"row_id"!==i&&"comments"!==i&&"$"!==i&&"children"!==i&&"parent"!==i&&"history"!==i&&"comments"!==i&&"style"!==i&&(t[i]=e[i]);return t})(t.data)));return delete i.$,i}getRow(e){const t=this.rowById[e];return t||null}forEachRow(e){const t=this;if(e)for(let i=0;i<t.rows.length;i++)e(t.rows[i])}forEachRowAfterFilterAndSort(e){const t=this;if(e)for(let i=0;i<t._recyclingRows.length;i++)e(t._recyclingRows[i])}getRowById(e){return this.rowById[e]}getRowByIndex(e){const t=this.rows[e];return t||null}getRowId(e){const t=this.rows[e];if(!t)return null;return t.id}validateRow(e,t){const n=this;if(!n.rowById[e])return!1;const l=(e,t)=>{let n={};for(let l of e)switch(l.type){case"min":n.min=i.min(t,l.value);break;case"max":n.max=i.max(t,l.value);break;case"minLength":n.minLength=i.minLength(t,l.value);break;case"maxLength":n.maxLength=i.maxLength(t,l.value);break;case"minDate":n.minDate=i.minDate(t,l.value);break;case"maxDate":n.maxDate=i.maxDate(t,l.value);break;case"required":n.required=i.required(t);break;case"requiredTrue":n.requiredTrue=i.requiredTrue(t);break;case"pattern":n.pattern=i.pattern(t,l.value);break;case"email":n.email=i.email(t);break;case"null":n.null=i.null(t)}let l={};return Object.keys(n).forEach((e=>{const t=n[e];t&&(l[e]=t)})),l},o=[];for(let e=0;e<n.columns.length;e++){const i=n.columns[e];let a=[];if(void 0!==t[i.dataField])if(i.validationRules&&i.validationRules.length>0){let e=t[i.dataField];e&&e.error&&(e=e.value),a=l(i.validationRules,e),Object.keys(a).length>0&&(o[i.dataField]=a)}else if(i.editor&&i.editor.onValidate){const e=i.editor.onValidate(t[i.dataField],t);"string"==typeof e&&(a.custom={message:e}),Object.keys(a).length>0&&(o[i.dataField]=a)}else{let e=null,n=t[i.dataField];n&&n.error&&(e=n.validity,n=n.value);for(let t in e)e[t]&&"valid"!==t&&"message"!==t&&(a[t]=!0),("custom"===t&&e[t].minLength||"custom"===t&&e[t].maxLength)&&(a[t]=!0);Object.keys(a).length>0&&(o[i.dataField]=a)}}return o}_getGroupAncestorSignature(e){const t=[];let i=e.parent;for(;i;)t.push({groupDataField:i.groupDataField,label:i.label}),i=i.parent;return JSON.stringify(t)}_getExpandedGroups(e){const t=this,i=[];if(!e)return[];return function e(n){n.forEach((n=>{n.expanded&&i.push({groupDataField:n.groupDataField,label:n.label,ancestorSignature:t._getGroupAncestorSignature(n)}),n.children&&n.children.length>0&&!1===n.children[0].leaf&&e(n.children)}))}(e),i}_updateRow(e,t,i){const n=this,l=n.rowById?n.rowById[e]:n.dataSource.dataItemById[e];if(!l)return;if(void 0===t)return;let o=[];n.dataSource&&n.dataSource.groupBy&&n.dataSource.groupBy.toArray&&(o=n.dataSource.groupBy.toArray().slice(0));const a=n.dataSource.boundSource.canNotify;n.dataSource.boundSource.canNotify=!1;const r=e=>{if(l.data[e]=t[e],n.dataSource.id&&l&&l.data&&l.data.$&&(l.data.$.id=t[n.dataSource.id]),l&&l.data.$&&void 0!==l.data.$.index){const i=l.data.$.index,a=n.dataSource.dataSource,r=()=>{const i=t[e];if(null==i){const t=n.columnByDataField[e];return t?"number"===t.dataType?0:"boolean"!==t.dataType&&("date"===t.dataType?new Date:""):""}return i};if(a&&a[i]&&(a[i][e]=r()),n.dataSource[i]){if(o.length>0&&!n._dirtyHierarchy){if(n.dataSource[i][e]!==r()&&o.indexOf(e)>=0){const e=n._getExpandedGroups(n.dataSource.boundHierarchy);n._dirtyHierarchy=e}}n.dataSource[i][e]=r()}}};let d=[];for(let e=0;e<n.columns.length;e++){const i=n.columns[e];void 0!==t&&(void 0!==t[i.dataField]&&(d[i.dataField]=!0,r(i.dataField)))}if(i){const e=n.dataSource.dataFields;if(e)for(let t=0;t<e.length;t++)d[e[t].name]||(e[t].map?r(e[t].map):r(e[t].name))}n.dataSource.boundSource.canNotify=a,n.__updating||n.dataSource.refreshHierarchy()}updateRow(e,t,i,n){const l=this,o=l.rowById[e];if(!o)return!1;let a=!1;if(null===t){a=!0;const e={};for(let t=0;t<l.columns.length;t++){if(n&&!1===l.columns[t].allowEdit)continue;let i=null;const o=l.columns[t].dataType;"int"!==o&&"number"!==o||(i=0),"string"===o&&(i=""),"boolean"!==o&&"bool"!==o||(i=!1),"date"===o&&(i=new Date),l.columns[t].allowNull&&(i=null),e[l.columns[t].dataField]=i}t=e}const r=l.validateRow(e,t);if(Object.keys(r).length>0&&!a)return!1;const d=()=>{if(!0===l.editing.batch||l.editing.batch&&l.editing.batch.indexOf("update")>=0){for(let e in t){if("$"===e)continue;const i=o.getCell(e);if(i){if(n){if(!1===l.columnByDataField[e].allowEdit)continue}o.data[e]&&(o.data[e]=t[e])}else l._batchUpdateCell(i.row,i.column,t[e],i.value),l._recycle()}i&&i(o)}else{l.beginUpdate();for(let e in t){if("$"===e)continue;const i=o.getCell(e);if(i){if(n){if(!1===l.columnByDataField[e].allowEdit)continue}i.value=t[e]}else o.data[e]&&(o.data[e]=t[e])}l.endUpdate(),i&&i(o)}};l.dataSource&&l.dataSource.virtualDataSource?(l.dataSource.id?t[l.dataSource.id]=e:t.id||(t.id=e),l._editInfo={row:t},l._virtualDataRequest("update",(function(e){e&&d(),l.appearance.displayLoadingIndicator=!1,l._setLoadingIndicatorVisibility()}))):l.onRowUpdate?l.onRowUpdate([e],[o],[o.data],[t],(e=>{e&&d()}),l):d()}addUnboundRow(e,t){const i=this;void 0===e&&(e=1),void 0===t&&(t="far"),i._nearRowsAdded||(i._nearRowsAdded=[],i._farRowsAdded=[]),i._unboundRows||(i._unboundRows=[]),i.beginUpdate();for(let n=0;n<e;n++){const e=Smart.Utilities.Core.createGUID().replace(/-/gi,""),n=new Smart.Grid.Row({index:-1,unbound:!0,id:e,grid:i});i.rowById[n.id]=n,"far"===t?i._farRowsAdded.push(n):i._nearRowsAdded.push(n),i._unboundRows.push(n)}i.endUpdate()}addNewRow(e){const t=this;"near"===e?t._insertNewRowBefore():t._insertNewRowAfter()}_updateRowHistory(e,t,i){const n=this;if(!n._currentUser||n._currentUser&&(!n._currentUser.info||"guest"===n._currentUser.info))return;const l="taskChecklist",o="taskColor",a="taskDueDate",r="taskPriority",d="taskProgress",s="taskStartDate",c="taskStatus",u="taskTags",m="taskText",g="taskDescription",p="taskUserId",f=()=>({user:n._currentUser.info.id,date:e.updatedDate}),h=[];if(i[p]!==t[p]){const n=f();n.action="user";let l=!0;t[p]||i[p]||(l=!1),l&&(n.details={oldValue:t[p],value:i[p]},e.addHistory(n)),h.push(p)}if(""+i[a]!=""+t[a]){const n=f();n.action="deadline",n.details={oldValue:t[a]?new Date(t[a]).toLocaleDateString():"",value:new Date(i[a]).toLocaleDateString()},e.addHistory(n),h.push(a)}if(""+i[s]!=""+t[s]){const n=f();n.action="deadline",n.details={oldValue:t[s]?new Date(t[s]).toLocaleDateString():"",value:new Date(i[s]).toLocaleDateString()},e.addHistory(n),h.push(s)}if(i[o]!==t[o]){const n=f();n.action="color",n.details={oldValue:t[o],value:i[o]},e.addHistory(n),h.push(c)}if(i[c]!==t[c]){const n=f();n.action="status",n.details={oldValue:t[c],value:i[c]},e.addHistory(n),h.push(c)}if(JSON.stringify(i[l])!==JSON.stringify(t[l])){const n=f();n.action="subtasks";let o=t[l],a=i[l];const r=e=>{let t=[];if(!e)return"";for(let i=0;i<e.length;i++)t.push(e[i].text+": "+(e[i].completed?"Y":"N"));return t.toString()};o=r(o),a=r(a),n.details={oldValue:o,value:a},e.addHistory(n),h.push(l)}else h.push(l);if(void 0!==i[d]&&parseFloat(i[d])!==parseFloat(t[d])){let n=!0;if(null===t[d]&&0===parseFloat(i[d])&&(n=!1),null===(null===t[d]&&i[d])&&(n=!1),n){const n=f();n.action="progress",n.details={oldValue:t[d]?100*t[d]+"%":"0%",value:100*i[d]+"%"},e.addHistory(n)}h.push(d)}if(i[g]!==t[g]){const n=f();n.action="description",n.details={oldValue:t[g],value:i[g]},e.addHistory(n),h.push(g)}if(i[r]!==t[r]){const n=f();n.action="priority",n.details={oldValue:t[r],value:i[r]},e.addHistory(n),h.push(r)}if(i[u]!==t[u]){const n=f();n.action="tags",n.details={oldValue:t[u],value:i[u]},e.addHistory(n),h.push(u)}if(i[m]!==t[m]){const n=f();n.action="text",n.details={oldValue:t[m],value:i[m]},e.addHistory(n),h.push(m)}for(let l=0;l<n.columns.length;l++){const o=n.columns[l].dataField;let a=t[o],r=i[o];if("image"===n.columns[l].template&&(a&&"string"==typeof a&&(a.indexOf("[{")>=0?(a=JSON.parse(a),a=a.map((e=>e.label)),a=a.toString()):a=""),null==a&&(a=""),r&&"string"==typeof r&&(r.indexOf("[{")>=0?(r=JSON.parse(r),r=r.map((e=>e.label)),r=r.toString()):r=""),null==r&&(r="")),-1===h.indexOf(o)&&a!==r){const t=f();"date"===n.columns[l].dataType?(r&&"string"==typeof r&&(r=new Date(r)),a&&"string"==typeof a&&(a=new Date(a))):"string"==typeof r&&(r=r.replaceAll("\\"," ").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/[\r\n]+/g," ").replace(/\p{Emoji}/gu,(e=>"&#"+e.codePointAt(0)+";"))),t.action=o,t.details={oldValue:a,value:r},e.addHistory(t)}}n.onRowHistory&&(n._tempRowHistory||(n._tempRowHistory=[]),n._tempRowHistory[e.index]={index:e.index,row:e,history:e.history},n._tempRowHistoryTimer&&clearTimeout(n._tempRowHistoryTimer),n._tempRowHistoryTimer=setTimeout((()=>{const e=[],t=[],i=[];for(let l in n._tempRowHistory)t.push(l),e.push(n._tempRowHistory[l].row),i.push(n._tempRowHistory[l].history);n.onRowHistory(t,e,i,n),delete n._tempRowHistory}),50))}_stringifyRow(e){const t=this;let i={};for(let n=0;n<t.columns.length;n++){const l=t.columns[n];i[l.dataField]=e.data[l.dataField]}return i=JSON.parse(JSON.stringify(i)),i}endEdit(){const e=this;let t=!1,i=null;e.editing.dialog.enabled&&e.editing.dialog.visible&&e._dialogEdit&&e._dialogEdit.close();let n=null,l=null,o=null;e._fireEndEdit=!0;let a=null,r=null,d=null;if(e._hasRichTextEditor=!1,e.editing.editRow){l=e.editing.editRow,i=e.editing.editRow.id;let n=null;if(e.storeHistory&&(n=e._stringifyRow(l)),t=e._endRowEdit(),a=n,t&&!e.onRowUpdate&&(l.updatedDate=new Date,l.updatedBy=e.currentUser,e.storeHistory)){const t=e._stringifyRow(l);e._updateRowHistory(l,n,t)}}else if(e.editing.editCell){l=e.editing.editCell.row,o=e.editing.editCell.column,n=e.editing.editCell,i=e.editing.editCell.row.id,d=!0;let s=null;e.storeHistory&&(s=e._stringifyRow(l));const c=void 0!==n.value?n.value:"";r=c,a=s;let u=!1;const m=t=>{if(t!==c){if(l.updatedDate=new Date,l.updatedBy=e.currentUser,e.storeHistory){const i=e._stringifyRow(l);i[n.column.dataField]=t,e._updateRowHistory(l,s,i)}u=!0}};if(e.onCellUpdate&&e.onRowHistory){const t=e.onRowHistory;e.onRowHistory=null;m(e._getEditorValue(n)),setTimeout((()=>{e.onRowHistory=t}),100)}e._getEditorValue(n)!==c&&(l.updatedDate=new Date,l.updatedBy=e.currentUser),t=e._endCellEdit(),t&&!u&&n&&m(n.value)}else e.editing.editColumn&&(i=null,o=e.editing.editColumn,t=e._endColumnEdit());if(e._saveUnboundRows(i),e._selection.selectionRect&&e._selection.selectionRect.classList.remove("smart-visibility-hidden"),e.$.scrollView.scrollTop=0,e._fireEndEdit){e.$.fireEvent("endEdit",{id:l?l.id:null,dataField:o?o.dataField:null,row:l,column:o,cell:n,data:l?l.data:null,value:n?n.value:o?o.label:null}).defaultPrevented&&(d?e.setCellValue(l.id,o.dataField,r):e.setRowData(l.id,a))}return e._conditionalColors&&e._conditionalColors.update&&e._conditionalColors.update(l),e.summaryRow.visible&&t&&(e.editing.isEditing=!1,e._calculateSummary(),e._recycle(!1)),e._refreshDataFilters(),e._renderConditionalFormatting(),t}getEditCells(){const e=this;return e.editing.editRow?e.editing.editRow.cells:e.editing.editCell?[e.editing.editCell]:[]}getBatchEditChanges(){const e=this,t=[],i=[],n=[];for(let i in e._cellsUpdatedValues){const n=e._cellsUpdatedValues[i],l=i.substring(0,i.indexOf("_")),o=i.substring(i.indexOf("_")+1),a=e.rowById[l].getCell(o);t.push({id:l,dataField:o,oldValue:a.value,newValue:n})}if(e._rowsDeleted&&e._rowsDeleted.length>0)for(let t=0;t<e._rowsDeleted.length;t++){const n=e._rowsDeleted[t],l=e.rowById[n];i.push({id:l.id,data:l.data})}if(e._rowsAdded&&e._rowsAdded.length>0)for(let t=0;t<e._rowsAdded.length;t++){const i=e._rowsAdded[t],l=e.rowById[i];n.push({id:l.id,data:l.data})}return{updated:t,deleted:i,added:n}}saveBatchEdit(){this._saveBatchEdit()}revertBatchEdit(){this._clearBatchEdit(!0)}});const e=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;function t(e){return null==e||0===e.length}class i{static null(e){return null===e}static email(i){return t(i)||e.test(i)?null:{email:!0}}static min(e,i){return(e=>{if(t(e)||t(i))return null;const n=parseFloat(e);return!isNaN(n)&&n<i?{min:{min:i,actual:n}}:null})(e)}static max(e,i){return(e=>{if(t(e)||t(i))return null;const n=parseFloat(e);return!isNaN(n)&&n>i?{max:{max:i,actual:n}}:null})(e)}static minDate(e,i){return(e=>{if(t(e)||t(i))return null;let n=e;return e&&e instanceof Smart.Utilities.DateTime&&(n=e.toDate()),!isNaN(n)&&n<i?{min:{min:i,actual:n}}:null})(e)}static maxDate(e,i){return(e=>{if(t(e)||t(i))return null;let n=e;return e&&e instanceof Smart.Utilities.DateTime&&(n=e.toDate()),!isNaN(n)&&n>i?{max:{max:i,actual:n}}:null})(e)}static required(e){return t(e)?{required:!0}:null}static requiredTrue(e){return!0===e?null:{required:!0}}static minLength(e,i){return(e=>{if(t(e)&&0===i)return null;const n=e?e.length:0;return n<i?{minlength:{requiredLength:i,actualLength:n}}:null})(e)}static maxLength(e,t){return(e=>{const i=e?e.length:0;return i>t?{maxlength:{requiredLength:t,actualLength:i}}:null})(e)}static url(e){return/^(ftp|http|https):\/\/[^ "]+$/.test(e)?null:{pattern:{requiredPattern:'^(ftp|http|https)://[^ "]+$',actualValue:e}}}static pattern(e,n){if(!n)return i.null;let l,o;return"string"==typeof n?(o="","^"!==n.charAt(0)&&(o+="^"),o+=n,"$"!==n.charAt(n.length-1)&&(o+="$"),l=new RegExp(o)):(o=n.toString(),l=n),(e=>t(e)||l.test(e)?null:{pattern:{requiredPattern:o,actualValue:e}})(e)}}window.Smart.Validator=i})();